<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>SYLLA ‚Äî Retrait</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@300;400;500;600;700&family=Outfit:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{
  --green:#00D166;--green-l:#4ADE80;--green-d:#009948;
  --teal:#00C9C0;--teal-l:#00EDDE;
  --orange:#FF7A35;--gold:#F5C842;--red:#FF3B4E;
  --amber:#FFB830;
  --bg:#060E0A;--bg2:#0A1A10;
  --text:#F0FFF5;--text2:#6BA885;--text3:#2E5A40;
  --nav-h:70px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;padding-bottom:calc(var(--nav-h)+20px);}

.bg-mesh{position:fixed;inset:0;z-index:0;pointer-events:none;
  background:
    radial-gradient(ellipse 60% 55% at 80% 5%, rgba(0,209,102,.10) 0%,transparent 60%),
    radial-gradient(ellipse 50% 60% at 5% 85%, rgba(0,201,192,.07) 0%,transparent 55%),
    linear-gradient(160deg,#060E0A 0%,#0A1A10 55%,#081209 100%);}
.bg-grid{position:fixed;inset:0;z-index:0;pointer-events:none;
  background-image:linear-gradient(rgba(0,209,102,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(0,209,102,.04) 1px,transparent 1px);
  background-size:50px 50px;}

/* LOADING */
.loading-screen{position:fixed;inset:0;z-index:999;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;transition:opacity .5s,visibility .5s;}
.loading-screen.hide{opacity:0;visibility:hidden;pointer-events:none;}
.load-logo{font-family:'Bebas Neue',cursive;font-size:52px;letter-spacing:8px;background:linear-gradient(135deg,var(--green),var(--teal-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:pulse 1.5s ease-in-out infinite;}
.load-bar{width:120px;height:2px;background:rgba(0,209,102,.15);border-radius:2px;overflow:hidden;}
.load-fill{height:100%;background:linear-gradient(90deg,var(--green-d),var(--green));border-radius:2px;animation:lf 1.5s ease-in-out infinite;}
@keyframes lf{0%{width:0%;margin-left:0;}50%{width:100%;margin-left:0;}100%{width:0%;margin-left:100%;}}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.4;}}
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}

.page{position:relative;z-index:2;padding:0 16px 20px;}

/* TOPBAR */
.topbar{display:flex;align-items:center;justify-content:space-between;padding:14px 16px 12px;position:sticky;top:0;z-index:50;background:rgba(6,14,10,.94);backdrop-filter:blur(20px);border-bottom:1px solid rgba(0,209,102,.1);margin:0 -16px 20px;}
.back-btn{display:flex;align-items:center;gap:8px;font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--green);text-decoration:none;padding:8px 14px;border:1px solid rgba(0,209,102,.3);border-radius:20px;transition:all .2s;}
.back-btn:hover{background:rgba(0,209,102,.08);}
.page-title{font-family:'Bebas Neue',cursive;font-size:22px;letter-spacing:4px;background:linear-gradient(135deg,var(--green),var(--teal-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.clock-pill{display:flex;align-items:center;gap:6px;background:rgba(0,209,102,.08);border:1px solid rgba(0,209,102,.2);border-radius:20px;padding:7px 14px;font-family:'Bebas Neue',cursive;font-size:14px;letter-spacing:2px;color:var(--green);}

/* ‚ïê‚ïê WINDOW STATUS BANNER ‚ïê‚ïê */
.window-banner{
  border-radius:20px;padding:18px 20px;margin-bottom:20px;
  position:relative;overflow:hidden;
  animation:fadeUp .5s ease both;
}
.wb-open{
  background:linear-gradient(135deg,rgba(0,209,102,.12),rgba(0,201,192,.06));
  border:1.5px solid rgba(0,209,102,.3);
}
.wb-closed{
  background:linear-gradient(135deg,rgba(255,59,78,.1),rgba(255,122,53,.06));
  border:1.5px solid rgba(255,59,78,.25);
}
.wb-top{display:flex;align-items:center;gap:14px;}
.wb-ico{font-size:36px;flex-shrink:0;}
.wb-info h2{font-family:'Bebas Neue',cursive;font-size:24px;letter-spacing:3px;}
.wb-info p{font-size:13px;font-weight:300;margin-top:3px;line-height:1.5;}
.wb-open .wb-info h2{color:var(--green);}
.wb-open .wb-info p{color:var(--text2);}
.wb-closed .wb-info h2{color:var(--red);}
.wb-closed .wb-info p{color:rgba(255,130,100,.7);}

/* Progress bar for window */
.window-prog{margin-top:14px;}
.wp-bar{height:6px;background:rgba(255,255,255,.07);border-radius:4px;overflow:hidden;margin-bottom:6px;}
.wp-fill{height:100%;border-radius:4px;transition:width .5s ease;}
.wb-open .wp-fill{background:linear-gradient(90deg,var(--green-d),var(--green),var(--teal));}
.wb-closed .wp-fill{background:linear-gradient(90deg,rgba(255,59,78,.4),rgba(255,59,78,.2));}
.wp-labels{display:flex;justify-content:space-between;}
.wp-lbl{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);}

/* Countdown to next window */
.next-window{
  display:flex;align-items:center;gap:10px;
  background:rgba(255,184,48,.06);border:1px solid rgba(255,184,48,.18);
  border-radius:12px;padding:11px 16px;margin-bottom:20px;
  animation:fadeUp .5s .05s ease both;
}
.nw-lbl{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--amber);flex:1;}
.nw-timer{font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:3px;color:var(--gold);}

/* ‚ïê‚ïê BALANCE CARD ‚ïê‚ïê */
.balance-card{
  background:linear-gradient(135deg,rgba(0,209,102,.1),rgba(0,201,192,.05));
  border:1.5px solid rgba(0,209,102,.2);
  border-radius:20px;padding:18px 20px;margin-bottom:20px;
  animation:fadeUp .5s .1s ease both;
}
.bc-label{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:rgba(0,209,102,.6);margin-bottom:6px;}
.bc-amount{font-family:'Bebas Neue',cursive;font-size:46px;letter-spacing:3px;line-height:1;background:linear-gradient(135deg,#fff,var(--green-l),var(--teal));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 4px 16px rgba(0,209,102,.25));}
.bc-currency{font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:500;color:var(--green);margin-left:4px;vertical-align:bottom;}
.bc-sub{display:flex;gap:0;margin-top:14px;background:rgba(0,0,0,.2);border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,.05);}
.bcs-item{flex:1;padding:10px 8px;text-align:center;border-right:1px solid rgba(255,255,255,.05);}
.bcs-item:last-child{border-right:none;}
.bcs-val{font-family:'Bebas Neue',cursive;font-size:18px;letter-spacing:1px;}
.bcs-lbl{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-top:3px;}

/* ‚ïê‚ïê FORM ‚ïê‚ïê */
.form-card{
  background:rgba(255,255,255,.03);
  border:1px solid rgba(0,209,102,.1);
  border-radius:22px;padding:20px;
  margin-bottom:18px;
  animation:fadeUp .5s .15s ease both;
}
.fc-title{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--text3);margin-bottom:16px;display:flex;align-items:center;gap:10px;}
.fc-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(0,209,102,.2),transparent);}

.field-lbl{display:block;font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:rgba(0,209,102,.7);margin-bottom:8px;}

/* Amount input */
.amount-wrap{position:relative;margin-bottom:14px;}
.amount-inp{
  width:100%;
  background:rgba(0,209,102,.04);
  border:1.5px solid rgba(0,209,102,.18);
  border-radius:14px;
  padding:16px 80px 16px 18px;
  font-family:'Bebas Neue',cursive;font-size:32px;letter-spacing:2px;
  color:var(--green);outline:none;transition:all .25s;
}
.amount-inp::placeholder{color:rgba(0,209,102,.2);font-size:26px;}
.amount-inp:focus{border-color:var(--green);background:rgba(0,209,102,.08);box-shadow:0 0 0 4px rgba(0,209,102,.08);}
.amount-inp:disabled{opacity:.4;cursor:not-allowed;}
.cur-tag{position:absolute;right:18px;top:50%;transform:translateY(-50%);font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;letter-spacing:2px;color:rgba(0,209,102,.4);}
.min-hint{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:600;letter-spacing:1px;color:var(--text3);margin-bottom:12px;display:flex;align-items:center;gap:6px;}

/* Quick amounts */
.quick-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;}
.qb{padding:9px 14px;border-radius:10px;border:1px solid rgba(0,209,102,.2);background:rgba(0,209,102,.05);color:var(--green);font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;letter-spacing:1.5px;cursor:pointer;transition:all .2s;}
.qb:hover{background:rgba(0,209,102,.12);border-color:var(--green);}
.qb:disabled{opacity:.3;cursor:not-allowed;}
.qb.max{background:rgba(245,200,66,.08);border-color:rgba(245,200,66,.25);color:var(--gold);}
.qb.max:hover{background:rgba(245,200,66,.15);}

/* Method selector */
.method-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;}
.method-opt{
  background:rgba(255,255,255,.03);border:1.5px solid rgba(255,255,255,.08);
  border-radius:14px;padding:14px 12px;cursor:pointer;
  text-align:center;transition:all .25s;position:relative;
}
.method-opt:hover{border-color:rgba(0,209,102,.3);background:rgba(0,209,102,.04);}
.method-opt.selected{border-color:var(--green);background:rgba(0,209,102,.08);box-shadow:0 0 16px rgba(0,209,102,.08);}
.method-opt.selected::before{content:'‚úì';position:absolute;top:6px;right:10px;font-size:11px;color:var(--green);font-weight:700;}
.mo-ico{font-size:26px;margin-bottom:6px;}
.mo-name{font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;letter-spacing:1px;color:var(--text);}
.mo-sub{font-size:10px;font-weight:300;color:var(--text3);margin-top:2px;}

/* Phone field */
.phone-wrap{margin-bottom:16px;}
.phone-inp{
  width:100%;
  background:rgba(0,209,102,.04);
  border:1.5px solid rgba(0,209,102,.15);
  border-radius:12px;padding:13px 16px;
  font-family:'Outfit',sans-serif;font-size:15px;font-weight:300;
  color:var(--text);outline:none;transition:all .25s;
  letter-spacing:.5px;
}
.phone-inp::placeholder{color:rgba(107,168,133,.3);font-size:13px;}
.phone-inp:focus{border-color:var(--green);background:rgba(0,209,102,.07);box-shadow:0 0 0 4px rgba(0,209,102,.08);}
.phone-inp:disabled{opacity:.4;}

/* Fee info */
.fee-box{
  display:flex;align-items:center;justify-content:space-between;
  background:rgba(0,0,0,.2);border-radius:12px;border:1px solid rgba(255,255,255,.05);
  padding:12px 16px;margin-bottom:16px;
}
.fb-row{text-align:center;}
.fb-val{font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:1px;}
.fb-lbl{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-top:3px;}
.fb-div{width:1px;height:32px;background:rgba(255,255,255,.07);}

/* SUBMIT BTN */
.submit-btn{
  width:100%;padding:16px;border:none;border-radius:14px;
  font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:4px;text-transform:uppercase;
  color:#fff;position:relative;overflow:hidden;transition:all .3s;
  background:linear-gradient(135deg,var(--green-d),var(--green));
  box-shadow:0 8px 30px rgba(0,209,102,.35);
  cursor:pointer;
}
.submit-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s;}
.submit-btn:hover::before{left:100%;}
.submit-btn:hover{transform:translateY(-2px);box-shadow:0 14px 40px rgba(0,209,102,.45);}
.submit-btn:disabled{opacity:.45;cursor:not-allowed;transform:none;box-shadow:none;}

.ld{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;vertical-align:middle;margin-right:8px;}

/* RULES BOX */
.rules-box{
  background:rgba(255,184,48,.06);border:1px solid rgba(255,184,48,.18);
  border-radius:16px;padding:16px;margin-bottom:18px;
  animation:fadeUp .5s .2s ease both;
}
.rules-title{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--amber);margin-bottom:12px;display:flex;align-items:center;gap:8px;}
.rules-list{display:flex;flex-direction:column;gap:8px;}
.rule-item{display:flex;align-items:flex-start;gap:10px;font-size:12px;font-weight:300;color:rgba(255,200,100,.75);line-height:1.5;}
.rule-ico{font-size:14px;flex-shrink:0;margin-top:1px;}

/* HISTORY */
.sec-title{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--text3);margin:4px 0 12px;display:flex;align-items:center;gap:10px;}
.sec-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(0,209,102,.2),transparent);}

.history-list{display:flex;flex-direction:column;gap:8px;animation:fadeUp .5s .25s ease both;}
.hist-item{display:flex;align-items:center;gap:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.05);border-radius:14px;padding:13px 15px;transition:all .2s;}
.hi-ico{width:38px;height:38px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;}
.hi-info{flex:1;min-width:0;}
.hi-type{font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:.5px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.hi-date{font-size:11px;font-weight:300;color:var(--text3);margin-top:2px;}
.hi-right{text-align:right;flex-shrink:0;}
.hi-amount{font-family:'Bebas Neue',cursive;font-size:19px;letter-spacing:1px;}
.hi-status{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;margin-top:2px;}
.st-ok{color:rgba(74,222,128,.7);}
.st-pend{color:rgba(255,184,48,.7);}
.st-rej{color:rgba(255,59,78,.7);}

/* ALERTS */
.al{display:none;align-items:center;gap:10px;padding:12px 15px;border-radius:12px;font-size:13px;margin-bottom:16px;animation:sld .3s ease;}
.al.show{display:flex;}
.al-ok{background:rgba(0,209,102,.1);border:1px solid rgba(0,209,102,.3);color:var(--green-l);}
.al-err{background:rgba(255,59,78,.08);border:1px solid rgba(255,59,78,.25);color:#FF6B7A;}
@keyframes sld{from{opacity:0;transform:translateY(-8px);}to{opacity:1;transform:translateY(0);}}

/* ‚ïê‚ïê CONFIRM MODAL ‚ïê‚ïê */
.modal-overlay{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.88);backdrop-filter:blur(16px);display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity .35s;}
.modal-overlay.show{opacity:1;pointer-events:all;}
.modal{width:100%;max-width:480px;background:linear-gradient(160deg,#091A0E 0%,#050E08 100%);border:1.5px solid rgba(0,209,102,.2);border-radius:28px 28px 0 0;padding:10px 20px 36px;transform:translateY(100%);transition:transform .4s cubic-bezier(.34,1.4,.64,1);}
.modal-overlay.show .modal{transform:translateY(0);}
.modal-handle{width:40px;height:4px;border-radius:2px;background:rgba(255,255,255,.15);margin:14px auto 20px;}
.modal-title{font-family:'Bebas Neue',cursive;font-size:28px;letter-spacing:3px;color:var(--green);margin-bottom:4px;}
.modal-sub{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin-bottom:20px;}
.modal-recap{background:rgba(0,0,0,.4);border-radius:16px;border:1px solid rgba(255,255,255,.06);overflow:hidden;margin-bottom:18px;}
.recap-row{display:flex;align-items:center;justify-content:space-between;padding:13px 16px;border-bottom:1px solid rgba(255,255,255,.04);}
.recap-row:last-child{border-bottom:none;}
.recap-lbl{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);}
.recap-val{font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:1px;}
.modal-note{display:flex;align-items:flex-start;gap:10px;background:rgba(0,209,102,.07);border:1px solid rgba(0,209,102,.18);border-radius:12px;padding:12px 14px;margin-bottom:18px;font-size:12px;font-weight:300;color:rgba(150,255,200,.8);line-height:1.5;}
.modal-err{display:none;background:rgba(255,59,78,.1);border:1px solid rgba(255,59,78,.3);border-radius:12px;padding:12px 14px;margin-bottom:14px;font-size:13px;color:#FF6B7A;}
.modal-btns{display:grid;grid-template-columns:1fr 1.6fr;gap:10px;}
.btn-cancel{padding:14px;border-radius:14px;border:1.5px solid rgba(255,255,255,.1);background:transparent;color:var(--text3);cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:2px;text-transform:uppercase;transition:all .2s;}
.btn-cancel:hover{background:rgba(255,255,255,.05);}
.btn-confirm-m{padding:14px;border-radius:14px;border:none;cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#fff;background:linear-gradient(135deg,var(--green-d),var(--green));box-shadow:0 8px 24px rgba(0,209,102,.3);transition:all .3s;}
.btn-confirm-m:hover{transform:translateY(-2px);}
.btn-confirm-m:disabled{opacity:.6;cursor:not-allowed;transform:none;}

.modal-success{display:none;text-align:center;padding:20px 0;}
.modal-success.show{display:block;}
.ms-ico{font-size:60px;margin-bottom:14px;}
.ms-title{font-family:'Bebas Neue',cursive;font-size:36px;letter-spacing:3px;color:var(--green);}
.ms-msg{font-size:14px;font-weight:300;color:var(--text2);margin-top:8px;line-height:1.6;max-width:300px;margin-inline:auto;}
.ms-btn{margin-top:22px;padding:13px 32px;border-radius:14px;border:none;cursor:pointer;background:linear-gradient(135deg,var(--green-d),var(--green));font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#fff;box-shadow:0 8px 24px rgba(0,209,102,.3);}

/* TOAST */
.toast{position:fixed;top:80px;left:50%;transform:translateX(-50%) translateY(-20px);background:rgba(0,209,102,.9);backdrop-filter:blur(12px);color:#fff;padding:10px 22px;border-radius:100px;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:1.5px;z-index:500;opacity:0;transition:all .3s;pointer-events:none;white-space:nowrap;max-width:90vw;text-align:center;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.toast.err{background:rgba(255,59,78,.92);}

/* BOT NAV */
.bot-nav{position:fixed;bottom:0;left:0;right:0;z-index:100;height:var(--nav-h);background:rgba(6,14,10,.95);backdrop-filter:blur(24px);border-top:1px solid rgba(0,209,102,.1);display:grid;grid-template-columns:repeat(4,1fr);box-shadow:0 -8px 32px rgba(0,0,0,.5);}
.nav-item{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;cursor:pointer;text-decoration:none;transition:all .2s;padding:8px 4px;position:relative;}
.nav-item::before{content:'';position:absolute;top:0;left:20%;right:20%;height:2px;border-radius:0 0 4px 4px;background:linear-gradient(90deg,var(--green),var(--teal));transform:scaleX(0);transition:transform .3s;}
.nav-item.active::before{transform:scaleX(1);}
.nav-item.active .nav-ico,.nav-item.active .nav-lbl{color:var(--green);}
.nav-ico{font-size:20px;color:var(--text3);transition:color .2s;}
.nav-lbl{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);transition:color .2s;}
</style>
</head>
<body>

<div class="loading-screen" id="loader">
  <div class="load-logo">üí∏ RETRAIT</div>
  <div class="load-bar"><div class="load-fill"></div></div>
</div>

<div class="bg-mesh"></div>
<div class="bg-grid"></div>
<div class="toast" id="toast"></div>

<!-- CONFIRM MODAL -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
  <div class="modal">
    <div class="modal-handle"></div>
    <div id="modal-main">
      <div class="modal-title">üí∏ Confirmer le retrait</div>
      <div class="modal-sub" id="modal-sub-txt">V√©rifiez les d√©tails ci-dessous</div>
      <div class="modal-recap">
        <div class="recap-row"><div class="recap-lbl">Montant demand√©</div><div class="recap-val" id="m-amount" style="color:var(--green)">‚Äî</div></div>
        <div class="recap-row"><div class="recap-lbl">M√©thode</div><div class="recap-val" id="m-method" style="color:var(--teal)">‚Äî</div></div>
        <div class="recap-row"><div class="recap-lbl">Num√©ro / Compte</div><div class="recap-val" id="m-phone" style="color:var(--text)">‚Äî</div></div>
        <div class="recap-row"><div class="recap-lbl">D√©lai de traitement</div><div class="recap-val" id="m-delay" style="color:var(--amber)">‚Äî</div></div>
        <div class="recap-row"><div class="recap-lbl">Solde restant apr√®s</div><div class="recap-val" id="m-after" style="color:var(--text2)">‚Äî</div></div>
      </div>
      <div class="modal-note">‚úÖ <span>Votre demande sera trait√©e <strong>aujourd'hui</strong> entre 8h et 18h. Un SMS de confirmation vous sera envoy√© d√®s le traitement.</span></div>
      <div class="modal-err" id="modal-err"></div>
      <div class="modal-btns">
        <button class="btn-cancel" onclick="closeModal()">Annuler</button>
        <button class="btn-confirm-m" id="btn-confirm" onclick="confirmWithdraw()">‚úÖ Confirmer</button>
      </div>
    </div>
    <div class="modal-success" id="modal-success">
      <div class="ms-ico">üéâ</div>
      <div class="ms-title">Demande Envoy√©e !</div>
      <div class="ms-msg" id="ms-msg">Votre retrait est en cours de traitement. Vous recevrez votre argent tr√®s prochainement.</div>
      <button class="ms-btn" onclick="window.location.href='dashboard.html'">Retour au Dashboard ‚Üí</button>
    </div>
  </div>
</div>

<!-- PAGE -->
<div class="page">

  <!-- TOPBAR -->
  <div class="topbar">
    <a href="dashboard.html" class="back-btn">‚Üê Accueil</a>
    <div class="page-title">üí∏ RETRAIT</div>
    <div class="clock-pill" id="live-clock">00:00</div>
  </div>

  <!-- WINDOW STATUS BANNER -->
  <div id="window-banner"></div>

  <!-- NEXT WINDOW COUNTDOWN -->
  <div class="next-window" id="next-window" style="display:none">
    <div class="nw-lbl">üïê Fen√™tre s'ouvre dans</div>
    <div class="nw-timer" id="next-timer">‚Äî</div>
  </div>

  <!-- BALANCE -->
  <div class="balance-card">
    <div class="bc-label">üí∞ Solde disponible pour retrait</div>
    <div>
      <span class="bc-amount" id="bal-display">0</span>
      <span class="bc-currency">FCFA</span>
    </div>
    <div class="bc-sub">
      <div class="bcs-item"><div class="bcs-val" style="color:var(--green)" id="stat-total-withdrawn">0</div><div class="bcs-lbl">Total retir√©</div></div>
      <div class="bcs-item"><div class="bcs-val" style="color:var(--amber)" id="stat-pending">0</div><div class="bcs-lbl">En attente (F)</div></div>
      <div class="bcs-item"><div class="bcs-val" style="color:var(--teal)" id="stat-count">0</div><div class="bcs-lbl">Retraits effectu√©s</div></div>
    </div>
  </div>

  <!-- ALERTS -->
  <div class="al al-ok" id="al-ok"><span>‚úì</span> Demande de retrait envoy√©e avec succ√®s !</div>
  <div class="al al-err" id="al-err"><span>‚úï</span><span id="err-msg">Erreur.</span></div>

  <!-- FORM CARD -->
  <div class="form-card" id="form-card">
    <div class="fc-title">Nouvelle demande de retrait</div>

    <label class="field-lbl">Montant √† retirer</label>
    <div class="amount-wrap">
      <input class="amount-inp" type="number" id="amount" placeholder="2 000" min="2000" oninput="updateFee()" id="amount-inp">
      <span class="cur-tag">FCFA</span>
    </div>
    <div class="min-hint">‚ö° Minimum : <strong style="color:var(--green);margin-left:4px">2 000 FCFA</strong></div>

    <div class="quick-row">
      <button class="qb" onclick="setAmt(2000)">2 000</button>
      <button class="qb" onclick="setAmt(5000)">5 000</button>
      <button class="qb" onclick="setAmt(10000)">10 000</button>
      <button class="qb" onclick="setAmt(25000)">25 000</button>
      <button class="qb max" onclick="setMax()">MAX üí∞</button>
    </div>

    <label class="field-lbl" style="margin-top:4px;">M√©thode de retrait</label>
    <div class="method-grid">
      <div class="method-opt selected" onclick="selectMethod('wave',this)">
        <div class="mo-ico">üåä</div>
        <div class="mo-name">Wave</div>
        <div class="mo-sub">Instantan√© ¬∑ Gratuit</div>
      </div>
      <div class="method-opt" onclick="selectMethod('orange',this)">
        <div class="mo-ico">üü†</div>
        <div class="mo-name">Orange Money</div>
        <div class="mo-sub">Instantan√© ¬∑ Gratuit</div>
      </div>
      <div class="method-opt" onclick="selectMethod('mtn',this)">
        <div class="mo-ico">üíõ</div>
        <div class="mo-name">MTN MoMo</div>
        <div class="mo-sub">Instantan√© ¬∑ Gratuit</div>
      </div>
      <div class="method-opt" onclick="selectMethod('moov',this)">
        <div class="mo-ico">üîµ</div>
        <div class="mo-name">Moov Money</div>
        <div class="mo-sub">Instantan√© ¬∑ Gratuit</div>
      </div>
    </div>

    <div class="phone-wrap">
      <label class="field-lbl">Num√©ro de r√©ception</label>
      <input class="phone-inp" type="tel" id="phone-inp" placeholder="Ex: +225 07 00 00 00 00">
    </div>

    <div class="fee-box" id="fee-box" style="display:none">
      <div class="fb-row"><div class="fb-val" style="color:var(--green)" id="fee-amount">0</div><div class="fb-lbl">Montant net</div></div>
      <div class="fb-div"></div>
      <div class="fb-row"><div class="fb-val" style="color:var(--text2)" id="fee-frais">0</div><div class="fb-lbl">Frais (0%)</div></div>
      <div class="fb-div"></div>
      <div class="fb-row"><div class="fb-val" style="color:var(--gold)" id="fee-after">0</div><div class="fb-lbl">Solde apr√®s</div></div>
    </div>

    <button class="submit-btn" id="submit-btn" onclick="openModal()">
      üí∏ Demander le retrait
    </button>
  </div>

  <!-- RULES -->
  <div class="rules-box">
    <div class="rules-title">üìã R√®gles de retrait</div>
    <div class="rules-list">
      <div class="rule-item"><span class="rule-ico">üïê</span><span>Les retraits sont trait√©s uniquement de <strong>8h00 √† 18h00</strong> du lundi au vendredi.</span></div>
      <div class="rule-item"><span class="rule-ico">üí∞</span><span>Montant minimum de retrait : <strong>2 000 FCFA</strong>. Pas de maximum.</span></div>
      <div class="rule-item"><span class="rule-ico">‚ö°</span><span>Traitement <strong>imm√©diat</strong> durant la fen√™tre horaire. En dehors : traitement le jour ouvrable suivant √† 8h.</span></div>
      <div class="rule-item"><span class="rule-ico">üì±</span><span>V√©rifiez bien votre num√©ro de t√©l√©phone. SYLLA n'est pas responsable des erreurs de num√©ro.</span></div>
      <div class="rule-item"><span class="rule-ico">üîí</span><span>Le bonus de bienvenue (1 000 FCFA) est retirable uniquement apr√®s avoir investi dans un plan.</span></div>
    </div>
  </div>

  <!-- HISTORY -->
  <div class="sec-title">Historique des retraits</div>
  <div class="history-list" id="history-list">
    <div style="text-align:center;padding:20px;color:var(--text3);font-size:13px;">Chargement‚Ä¶</div>
  </div>

</div>

<!-- BOT NAV -->
<nav class="bot-nav">
  <a href="dashboard.html" class="nav-item"><span class="nav-ico">üè†</span><span class="nav-lbl">Accueil</span></a>
  <a href="plan.html" class="nav-item"><span class="nav-ico">üöÄ</span><span class="nav-lbl">Plans</span></a>
  <a href="retrait.html" class="nav-item active"><span class="nav-ico">üí∏</span><span class="nav-lbl">Retrait</span></a>
  <a href="profil.html" class="nav-item"><span class="nav-ico">üë§</span><span class="nav-lbl">Profil</span></a>
</nav>

<script>
const{createClient}=supabase;
const sb=createClient(
  'https://fqiotqrraobmsrcyewsi.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZxaW90cXJyYW9ibXNyY3lld3NpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MjA3NzUsImV4cCI6MjA4NzM5Njc3NX0.pmvaQikEDEj705o7kBBWwkLwAoZ62D-GoxjFm5HEHNc'
);

/* ‚îÄ‚îÄ STATE ‚îÄ‚îÄ */
let currentUser=null, userBalance=0, selectedMethod='wave', toastTimer=null;
const OPEN_HOUR=8, CLOSE_HOUR=18, MIN_AMOUNT=2000;

/* ‚îÄ‚îÄ INIT ‚îÄ‚îÄ */
async function init(){
  const{data:{session}}=await sb.auth.getSession();
  if(!session){window.location.href='index.html';return;}
  currentUser=session.user;
  await loadBalance();
  await loadHistory();
  startClock();
  renderWindowBanner();
  document.getElementById('loader').classList.add('hide');

  // Pre-fill phone from profile
  try{
    const{data}=await sb.from('profiles').select('phone').eq('id',currentUser.id).single();
    if(data?.phone) document.getElementById('phone-inp').value=data.phone;
  }catch(e){}
}

/* ‚îÄ‚îÄ WINDOW CHECK ‚îÄ‚îÄ */
function isWindowOpen(){
  const now=new Date();
  const h=now.getHours();
  const d=now.getDay(); // 0=Sun, 6=Sat
  const isWeekday=d>=1&&d<=5;
  return isWeekday && h>=OPEN_HOUR && h<CLOSE_HOUR;
}

function renderWindowBanner(){
  const open=isWindowOpen();
  const now=new Date();
  const h=now.getHours(), m=now.getMinutes();
  const totalMins=h*60+m;
  const openMins=OPEN_HOUR*60, closeMins=CLOSE_HOUR*60;
  const windowLen=closeMins-openMins;
  let pct=0;

  if(open){
    pct=Math.round(((totalMins-openMins)/windowLen)*100);
    document.getElementById('next-window').style.display='none';
  }else{
    document.getElementById('next-window').style.display='flex';
  }

  const banner=document.getElementById('window-banner');
  if(open){
    banner.innerHTML=`
      <div class="window-banner wb-open">
        <div class="wb-top">
          <div class="wb-ico">üü¢</div>
          <div class="wb-info">
            <h2>Fen√™tre ouverte</h2>
            <p>Retraits actifs jusqu'√† <strong>18h00</strong> aujourd'hui. Votre demande sera trait√©e imm√©diatement.</p>
          </div>
        </div>
        <div class="window-prog">
          <div class="wp-bar"><div class="wp-fill" style="width:${pct}%"></div></div>
          <div class="wp-labels"><div class="wp-lbl">08h00</div><div class="wp-lbl">Maintenant (${pct}%)</div><div class="wp-lbl">18h00</div></div>
        </div>
      </div>`;
  }else{
    let msg='';
    const d=now.getDay();
    if(d===0||d===6) msg='Retraits disponibles lundi √† 8h00.';
    else if(h<OPEN_HOUR) msg=`La fen√™tre s'ouvre aujourd'hui √† 08h00.`;
    else msg='La fen√™tre reprend demain √† 08h00.';
    banner.innerHTML=`
      <div class="window-banner wb-closed">
        <div class="wb-top">
          <div class="wb-ico">üî¥</div>
          <div class="wb-info">
            <h2>Fen√™tre ferm√©e</h2>
            <p>${msg} Les demandes soumises maintenant seront trait√©es √† la prochaine ouverture.</p>
          </div>
        </div>
      </div>`;
  }

  // Lock/unlock form based on window
  const btn=document.getElementById('submit-btn');
  const amtInp=document.getElementById('amount');
  if(open){
    btn.style.opacity='1';
    btn.style.cursor='pointer';
  }
}

/* ‚îÄ‚îÄ CLOCK ‚îÄ‚îÄ */
function startClock(){
  function tick(){
    const n=new Date();
    const h=String(n.getHours()).padStart(2,'0');
    const m=String(n.getMinutes()).padStart(2,'0');
    const s=String(n.getSeconds()).padStart(2,'0');
    document.getElementById('live-clock').textContent=h+':'+m+':'+s;

    // Update countdown to next window
    const isOpen=isWindowOpen();
    const nwEl=document.getElementById('next-timer');
    if(!isOpen&&nwEl){
      const now=new Date();
      const nextOpen=new Date(now);
      const d=now.getDay();
      const ho=now.getHours();

      if(d===0){nextOpen.setDate(nextOpen.getDate()+1);nextOpen.setHours(OPEN_HOUR,0,0,0);}
      else if(d===6){nextOpen.setDate(nextOpen.getDate()+2);nextOpen.setHours(OPEN_HOUR,0,0,0);}
      else if(ho<OPEN_HOUR){nextOpen.setHours(OPEN_HOUR,0,0,0);}
      else{
        nextOpen.setDate(nextOpen.getDate()+1);
        if(nextOpen.getDay()===6)nextOpen.setDate(nextOpen.getDate()+2);
        else if(nextOpen.getDay()===0)nextOpen.setDate(nextOpen.getDate()+1);
        nextOpen.setHours(OPEN_HOUR,0,0,0);
      }

      const diff=nextOpen-now;
      const rh=Math.floor(diff/(1000*60*60));
      const rm=Math.floor((diff%(1000*60*60))/(1000*60));
      const rs=Math.floor((diff%(1000*60))/1000);
      nwEl.textContent=`${pad(rh)}:${pad(rm)}:${pad(rs)}`;
    }
  }
  tick();setInterval(tick,1000);
}

/* ‚îÄ‚îÄ LOAD BALANCE ‚îÄ‚îÄ */
async function loadBalance(){
  let total=1000,withdrawn=0,pending=0,count=0;
  try{
    const{data}=await sb.from('transactions').select('*').eq('user_id',currentUser.id);
    if(data&&data.length){
      total=0;
      data.forEach(t=>{
        if(['bonus_bienvenue','depot','gain','referral'].includes(t.type))total+=Number(t.amount);
        if(t.type==='retrait'){
          if(t.status==='pending')pending+=Number(t.amount);
          else{total-=Number(t.amount);withdrawn+=Number(t.amount);count++;}
        }
        if(t.type==='investissement')total-=Number(t.amount);
        if(t.type==='coffre_depot')total-=Number(t.amount);
        if(t.type==='coffre_retrait')total+=Number(t.amount);
      });
    }
  }catch(e){}
  userBalance=Math.max(0,total);
  document.getElementById('bal-display').textContent=fmt(userBalance);
  document.getElementById('stat-total-withdrawn').textContent=fmt(withdrawn);
  document.getElementById('stat-pending').textContent=fmt(pending);
  document.getElementById('stat-count').textContent=count;
}

/* ‚îÄ‚îÄ LOAD HISTORY ‚îÄ‚îÄ */
async function loadHistory(){
  const list=document.getElementById('history-list');
  try{
    const{data}=await sb.from('transactions').select('*').eq('user_id',currentUser.id).eq('type','retrait').order('created_at',{ascending:false}).limit(15);
    if(!data||!data.length){list.innerHTML='<div style="text-align:center;padding:20px;color:var(--text3);font-size:13px;">üí∏ Aucun retrait effectu√©</div>';return;}
    list.innerHTML=data.map(t=>{
      const stCls=t.status==='pending'?'st-pend':t.status==='rejected'?'st-rej':'st-ok';
      const stTxt=t.status==='pending'?'En attente':t.status==='rejected'?'Rejet√©':'Trait√© ‚úì';
      const d=new Date(t.created_at);
      const ds=d.toLocaleDateString('fr-FR',{day:'2-digit',month:'short',year:'numeric',hour:'2-digit',minute:'2-digit'});
      const method=t.label?.match(/(Wave|Orange|MTN|Moov)/i)?.[0]||'Mobile';
      const methodIcos={'Wave':'üåä','Orange':'üü†','MTN':'üíõ','Moov':'üîµ','Mobile':'üì±'};
      return `<div class="hist-item">
        <div class="hi-ico" style="background:rgba(0,209,102,.08)">${methodIcos[method]||'üí∏'}</div>
        <div class="hi-info"><div class="hi-type">${t.label||'Retrait'}</div><div class="hi-date">${ds}</div></div>
        <div class="hi-right"><div class="hi-amount" style="color:var(--orange)">-${fmt(t.amount)} F</div><div class="hi-status ${stCls}">${stTxt}</div></div>
      </div>`;
    }).join('');
  }catch(e){list.innerHTML='<div style="text-align:center;padding:20px;color:var(--text3)">Historique indisponible</div>';}
}

/* ‚îÄ‚îÄ AMOUNT HELPERS ‚îÄ‚îÄ */
function setAmt(v){document.getElementById('amount').value=v;updateFee();}
function setMax(){document.getElementById('amount').value=Math.floor(userBalance);updateFee();}

function updateFee(){
  const v=Number(document.getElementById('amount').value)||0;
  const box=document.getElementById('fee-box');
  if(v<=0){box.style.display='none';return;}
  box.style.display='flex';
  document.getElementById('fee-amount').textContent=fmt(v)+' F';
  document.getElementById('fee-frais').textContent='0 F';
  document.getElementById('fee-after').textContent=fmt(Math.max(0,userBalance-v))+' F';
}

/* ‚îÄ‚îÄ METHOD ‚îÄ‚îÄ */
const methodLabels={wave:'üåä Wave',orange:'üü† Orange Money',mtn:'üíõ MTN MoMo',moov:'üîµ Moov Money'};
function selectMethod(m,el){
  selectedMethod=m;
  document.querySelectorAll('.method-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');
}

/* ‚îÄ‚îÄ OPEN MODAL ‚îÄ‚îÄ */
function openModal(){
  const amount=Number(document.getElementById('amount').value)||0;
  const phone=document.getElementById('phone-inp').value.trim();

  // Validations
  if(amount<MIN_AMOUNT){showToast('Minimum '+fmt(MIN_AMOUNT)+' FCFA requis',true);return;}
  if(amount>userBalance){showToast('Solde insuffisant',true);return;}
  if(!phone){showToast('Entrez un num√©ro de r√©ception',true);return;}
  if(phone.replace(/\s/g,'').length<8){showToast('Num√©ro invalide',true);return;}

  const after=userBalance-amount;
  const isOpen=isWindowOpen();
  const delay=isOpen?'Traitement imm√©diat':'Prochaine ouverture (8h)';

  document.getElementById('m-amount').textContent=fmt(amount)+' FCFA';
  document.getElementById('m-method').textContent=methodLabels[selectedMethod]||selectedMethod;
  document.getElementById('m-phone').textContent=phone;
  document.getElementById('m-delay').textContent=delay;
  document.getElementById('m-after').textContent=fmt(after)+' FCFA';
  document.getElementById('modal-sub-txt').textContent=`${methodLabels[selectedMethod]} ¬∑ ${fmt(amount)} FCFA`;
  document.getElementById('modal-err').style.display='none';
  document.getElementById('modal-main').style.display='block';
  document.getElementById('modal-success').classList.remove('show');
  document.getElementById('btn-confirm').disabled=false;
  document.getElementById('btn-confirm').innerHTML='‚úÖ Confirmer';
  document.getElementById('modal-overlay').classList.add('show');
  document.body.style.overflow='hidden';
}

function closeModal(e){
  if(e&&e.target!==document.getElementById('modal-overlay'))return;
  document.getElementById('modal-overlay').classList.remove('show');
  document.body.style.overflow='';
}

/* ‚îÄ‚îÄ CONFIRM WITHDRAW ‚îÄ‚îÄ */
async function confirmWithdraw(){
  const amount=Number(document.getElementById('amount').value)||0;
  const phone=document.getElementById('phone-inp').value.trim();
  const btn=document.getElementById('btn-confirm');
  const errEl=document.getElementById('modal-err');
  errEl.style.display='none';

  if(amount<MIN_AMOUNT||amount>userBalance){
    errEl.style.display='block';errEl.textContent='Montant invalide.';return;
  }

  btn.disabled=true;btn.innerHTML='<span class="ld"></span>Traitement‚Ä¶';

  try{
    const isOpen=isWindowOpen();
    const status=isOpen?'pending':'pending';
    const now=new Date().toISOString();
    const methodName=methodLabels[selectedMethod]||selectedMethod;

    const{error}=await sb.from('transactions').insert({
      user_id:currentUser.id,
      type:'retrait',
      label:`Retrait ${methodName} ‚Üí ${phone}`,
      amount:amount,
      status:status,
      created_at:now
    });
    if(error)throw error;

    // Show success
    document.getElementById('modal-main').style.display='none';
    document.getElementById('modal-success').classList.add('show');
    const isOpen2=isWindowOpen();
    document.getElementById('ms-msg').textContent=isOpen2
      ?`${fmt(amount)} FCFA en cours de transfert vers ${phone} via ${methodName}. Vous recevrez un SMS de confirmation.`
      :`Demande enregistr√©e. Traitement √† l'ouverture suivante (8h00). Montant : ${fmt(amount)} FCFA ‚Üí ${phone}.`;

    // Update UI
    userBalance-=amount;
    document.getElementById('bal-display').textContent=fmt(userBalance);
    document.getElementById('amount').value='';
    document.getElementById('fee-box').style.display='none';

    await loadHistory();
    await loadBalance();

  }catch(err){
    btn.disabled=false;btn.innerHTML='‚úÖ Confirmer';
    errEl.style.display='block';
    errEl.textContent='‚ùå Erreur : '+(err.message||'R√©essayez.');
  }
}

/* ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ */
function fmt(n){return Number(n).toLocaleString('fr-FR');}
function pad(n){return String(Math.max(0,n)).padStart(2,'0');}

let toastT=null;
function showToast(msg,err=false){
  const t=document.getElementById('toast');
  t.textContent=msg;
  err?t.classList.add('err'):t.classList.remove('err');
  t.classList.add('show');
  clearTimeout(toastT);
  toastT=setTimeout(()=>t.classList.remove('show'),3200);
}

init();
</script>
</body>
</html>
