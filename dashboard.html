<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SYLLA ‚Äì Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{
  --gold:#C9A84C;--gold-l:#F0D078;--gold-d:#8A6520;
  --deep:#080C12;--surf:#0F1620;--card:#141E2B;--card2:#1A2535;
  --bord:rgba(201,168,76,.14);--bord2:rgba(255,255,255,.06);
  --txt:#EEE8DC;--muted:#6B7F96;--muted2:#4A5A6E;
  --green:#2ECC8F;--red:#E8585A;--blue:#3A9BD5;
  --r:18px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:var(--deep);color:var(--txt);font-family:'Outfit',sans-serif;min-height:100vh;overflow-x:hidden}

/* ‚îÄ‚îÄ BG ‚îÄ‚îÄ */
.bg-fx{position:fixed;inset:0;z-index:0;pointer-events:none}
.orb{position:absolute;border-radius:50%;filter:blur(110px);animation:float 14s ease-in-out infinite alternate}
.o1{width:600px;height:600px;background:radial-gradient(circle,rgba(201,168,76,.15),transparent);top:-200px;left:-150px;animation-delay:0s}
.o2{width:450px;height:450px;background:radial-gradient(circle,rgba(30,80,140,.18),transparent);bottom:-100px;right:-100px;animation-delay:-6s}
.o3{width:350px;height:350px;background:radial-gradient(circle,rgba(80,30,120,.14),transparent);top:40%;left:45%;animation-delay:-3s}
@keyframes float{from{transform:translate(0,0) scale(1)}to{transform:translate(25px,18px) scale(1.06)}}
.grid-bg{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:linear-gradient(rgba(201,168,76,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(201,168,76,.03) 1px,transparent 1px);background-size:64px 64px}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.shell{position:relative;z-index:1;max-width:1440px;margin:0 auto;padding:0 24px 60px}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:20px 0 0;gap:16px;
}
.logo-row{display:flex;align-items:center;gap:12px}
.logo-mark{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,var(--gold),var(--gold-d));display:flex;align-items:center;justify-content:center;font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;color:#0a0700;box-shadow:0 0 20px rgba(201,168,76,.4)}
.logo-name{font-family:'Cormorant Garamond',serif;font-size:24px;font-weight:600;letter-spacing:3px;background:linear-gradient(90deg,var(--gold-l),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent}

.top-nav{display:flex;align-items:center;gap:8px}
.nav-btn{display:flex;align-items:center;gap:8px;padding:9px 18px;border-radius:100px;border:1px solid var(--bord);background:rgba(255,255,255,.03);color:var(--muted);font-family:'Outfit',sans-serif;font-size:13px;font-weight:500;cursor:pointer;transition:all .25s;text-decoration:none}
.nav-btn:hover,.nav-btn.active{border-color:var(--gold);color:var(--gold);background:rgba(201,168,76,.07)}
.nav-btn svg{flex-shrink:0}

.profile-pill{
  display:flex;align-items:center;gap:10px;
  padding:6px 16px 6px 6px;
  border-radius:100px;border:1px solid var(--bord);
  background:var(--card);cursor:pointer;transition:border-color .25s;
}
.profile-pill:hover{border-color:var(--gold)}
.avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold-d));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;color:var(--deep);flex-shrink:0}
.profile-info{line-height:1.2}
.profile-name{font-size:13px;font-weight:600}
.profile-rank{font-size:11px;color:var(--gold);font-weight:500}

/* ‚îÄ‚îÄ WELCOME BANNER ‚îÄ‚îÄ */
.welcome{
  margin:32px 0 28px;
  background:linear-gradient(135deg,var(--card) 0%,rgba(25,40,60,.9) 100%);
  border:1px solid var(--bord);border-radius:24px;
  padding:32px 40px;display:flex;align-items:center;justify-content:space-between;
  overflow:hidden;position:relative;
}
.welcome::before{content:'';position:absolute;top:-60px;right:-40px;width:220px;height:220px;border-radius:50%;background:radial-gradient(circle,rgba(201,168,76,.12),transparent);pointer-events:none}
.welcome-left h1{font-family:'Cormorant Garamond',serif;font-size:clamp(24px,2.5vw,38px);font-weight:300;line-height:1.2;margin-bottom:8px}
.welcome-left h1 em{font-style:italic;background:linear-gradient(90deg,var(--gold-l),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.welcome-sub{font-size:14px;color:var(--muted);line-height:1.6}
.welcome-time{text-align:right}
.time-val{font-family:'Cormorant Garamond',serif;font-size:42px;font-weight:300;color:var(--gold-l);line-height:1}
.time-date{font-size:13px;color:var(--muted);margin-top:4px}

/* ‚îÄ‚îÄ SECTION LABEL ‚îÄ‚îÄ */
.sec-label{font-size:11px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--muted2);margin-bottom:16px;display:flex;align-items:center;gap:10px}
.sec-label::after{content:'';flex:1;height:1px;background:var(--bord)}

/* ‚îÄ‚îÄ CARDS GRID (2 rows √ó 3) ‚îÄ‚îÄ */
.cards-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-bottom:18px}

.action-card{
  border-radius:var(--r);border:1px solid var(--bord);
  padding:28px 24px;cursor:pointer;position:relative;overflow:hidden;
  transition:transform .3s,box-shadow .3s,border-color .3s;
  animation:fadeUp .6s ease both;
}
.action-card:hover{transform:translateY(-4px);box-shadow:0 16px 40px rgba(0,0,0,.4)}
.action-card::after{content:'';position:absolute;inset:0;opacity:0;transition:opacity .3s}
.action-card:hover::after{opacity:1}

/* Card Plan */
.card-plan{background:linear-gradient(145deg,#1A2535,#0F1A28);border-color:rgba(201,168,76,.2)}
.card-plan:hover{border-color:var(--gold);box-shadow:0 16px 50px rgba(201,168,76,.15)}
/* Card Recharge */
.card-recharge{background:linear-gradient(145deg,#0F1E2A,#091822);border-color:rgba(46,204,143,.15)}
.card-recharge:hover{border-color:var(--green);box-shadow:0 16px 50px rgba(46,204,143,.12)}
/* Card Retrait */
.card-retrait{background:linear-gradient(145deg,#1E1220,#120D1A);border-color:rgba(232,88,90,.15)}
.card-retrait:hover{border-color:var(--red);box-shadow:0 16px 50px rgba(232,88,90,.12)}
/* Card Portefeuille */
.card-wallet{background:linear-gradient(145deg,#101E30,#0A1520);border-color:rgba(58,155,213,.15)}
.card-wallet:hover{border-color:var(--blue);box-shadow:0 16px 50px rgba(58,155,213,.12)}
/* Card Parrainage */
.card-parrain{background:linear-gradient(145deg,#1A1530,#100D22);border-color:rgba(160,100,220,.15)}
.card-parrain:hover{border-color:#A064DC;box-shadow:0 16px 50px rgba(160,100,220,.12)}
/* Card Historique */
.card-history{background:linear-gradient(145deg,#1A1E28,#0F1418);border-color:rgba(201,168,76,.1)}
.card-history:hover{border-color:rgba(201,168,76,.4)}

.card-icon{
  width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;margin-bottom:20px;
}
.card-plan .card-icon{background:rgba(201,168,76,.12);color:var(--gold)}
.card-recharge .card-icon{background:rgba(46,204,143,.12);color:var(--green)}
.card-retrait .card-icon{background:rgba(232,88,90,.12);color:var(--red)}
.card-wallet .card-icon{background:rgba(58,155,213,.12);color:var(--blue)}
.card-parrain .card-icon{background:rgba(160,100,220,.12);color:#A064DC}
.card-history .card-icon{background:rgba(201,168,76,.08);color:var(--gold)}

.card-label{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:600;margin-bottom:6px}
.card-sub{font-size:13px;color:var(--muted);line-height:1.5;margin-bottom:18px}
.card-val{font-family:'Cormorant Garamond',serif;font-size:32px;font-weight:700}
.card-plan .card-val{color:var(--gold)}
.card-recharge .card-val{color:var(--green)}
.card-retrait .card-val{color:var(--red)}
.card-wallet .card-val{color:var(--blue)}
.card-parrain .card-val{color:#A064DC}
.card-history .card-val{color:var(--gold)}
.card-badge{display:inline-flex;align-items:center;gap:6px;font-size:11px;font-weight:600;letter-spacing:.8px;text-transform:uppercase;padding:5px 12px;border-radius:100px;margin-top:12px}
.badge-gold{background:rgba(201,168,76,.12);color:var(--gold);border:1px solid rgba(201,168,76,.25)}
.badge-green{background:rgba(46,204,143,.1);color:var(--green);border:1px solid rgba(46,204,143,.2)}
.badge-red{background:rgba(232,88,90,.1);color:var(--red);border:1px solid rgba(232,88,90,.2)}
.badge-blue{background:rgba(58,155,213,.1);color:var(--blue);border:1px solid rgba(58,155,213,.2)}
.badge-purple{background:rgba(160,100,220,.1);color:#A064DC;border:1px solid rgba(160,100,220,.2)}

.card-arrow{position:absolute;bottom:22px;right:22px;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.05);transition:background .25s,transform .25s}
.action-card:hover .card-arrow{background:rgba(255,255,255,.1);transform:translate(2px,-2px)}

@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.action-card:nth-child(1){animation-delay:.05s}
.action-card:nth-child(2){animation-delay:.1s}
.action-card:nth-child(3){animation-delay:.15s}
.action-card:nth-child(4){animation-delay:.2s}
.action-card:nth-child(5){animation-delay:.25s}
.action-card:nth-child(6){animation-delay:.3s}

/* ‚îÄ‚îÄ BOTTOM SECTION ‚îÄ‚îÄ */
.bottom-grid{display:grid;grid-template-columns:1fr 1fr;gap:22px;margin-top:28px}

/* Top Investors */
.investors-panel{background:var(--card);border:1px solid var(--bord);border-radius:var(--r);padding:28px}
.investors-list{margin-top:16px;display:flex;flex-direction:column;gap:12px}
.investor-row{
  display:flex;align-items:center;gap:14px;
  padding:14px 16px;border-radius:14px;
  background:var(--card2);border:1px solid var(--bord2);
  transition:border-color .25s,transform .2s;
}
.investor-row:hover{border-color:var(--bord);transform:translateX(4px)}
.inv-rank{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0}
.rank-1{background:linear-gradient(135deg,#FFD700,#B8860B);color:#000}
.rank-2{background:linear-gradient(135deg,#C0C0C0,#808080);color:#000}
.rank-3{background:linear-gradient(135deg,#CD7F32,#8B4513);color:#fff}
.rank-n{background:rgba(255,255,255,.06);color:var(--muted)}
.inv-avatar{width:38px;height:38px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold-d));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;color:var(--deep);flex-shrink:0}
.inv-info{flex:1}
.inv-name{font-size:14px;font-weight:600}
.inv-sub{font-size:12px;color:var(--muted)}
.inv-badge{font-size:10px;font-weight:700;padding:3px 10px;border-radius:100px;letter-spacing:.5px}
.b-plat{background:rgba(200,200,220,.12);color:#C8C8DC;border:1px solid rgba(200,200,220,.2)}
.b-gold{background:rgba(201,168,76,.12);color:var(--gold);border:1px solid rgba(201,168,76,.2)}
.b-silv{background:rgba(192,192,192,.1);color:#C0C0C0;border:1px solid rgba(192,192,192,.2)}
.inv-gains{text-align:right}
.inv-gain-val{font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:600;color:var(--green)}
.inv-gain-lbl{font-size:11px;color:var(--muted)}

/* Investment info panel */
.info-panel{background:var(--card);border:1px solid var(--bord);border-radius:var(--r);padding:28px;display:flex;flex-direction:column;gap:18px}
.info-section{}
.info-title{font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.info-text{font-size:13.5px;color:var(--muted);line-height:1.75}
.risk-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:14px}
.risk-card{border-radius:12px;padding:14px;text-align:center}
.risk-low{background:rgba(46,204,143,.08);border:1px solid rgba(46,204,143,.18)}
.risk-med{background:rgba(255,165,0,.08);border:1px solid rgba(255,165,0,.18)}
.risk-high{background:rgba(232,88,90,.08);border:1px solid rgba(232,88,90,.18)}
.risk-emoji{font-size:22px;margin-bottom:6px}
.risk-lbl{font-size:12px;font-weight:600;margin-bottom:4px}
.risk-low .risk-lbl{color:var(--green)}
.risk-med .risk-lbl{color:orange}
.risk-high .risk-lbl{color:var(--red)}
.risk-desc{font-size:11px;color:var(--muted)}
.tip-box{background:rgba(201,168,76,.06);border:1px solid rgba(201,168,76,.15);border-radius:12px;padding:14px 16px;font-size:13px;color:var(--muted);line-height:1.6;display:flex;gap:10px;align-items:flex-start}
.tip-icon{color:var(--gold);flex-shrink:0;margin-top:2px}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-bg{position:fixed;inset:0;z-index:100;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;padding:20px}
.modal-bg.open{display:flex}
.modal{background:var(--card);border:1px solid var(--bord);border-radius:24px;width:100%;max-width:480px;padding:36px;animation:modalIn .35s cubic-bezier(.34,1.56,.64,1)}
@keyframes modalIn{from{opacity:0;transform:scale(.9) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px}
.modal-title{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:600}
.modal-close{width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,.06);border:none;color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .2s}
.modal-close:hover{background:rgba(255,255,255,.12)}
.m-group{margin-bottom:16px}
.m-label{font-size:13px;color:var(--muted);margin-bottom:8px;display:block;font-weight:500}
.m-input{width:100%;padding:12px 14px;background:var(--surf);border:1px solid var(--bord);border-radius:12px;color:var(--txt);font-family:'Outfit',sans-serif;font-size:14px;outline:none;transition:border-color .2s}
.m-input:focus{border-color:var(--gold)}
.m-select{appearance:none;cursor:pointer}
.m-btn{width:100%;padding:14px;border:none;border-radius:14px;font-family:'Outfit',sans-serif;font-size:15px;font-weight:700;cursor:pointer;transition:all .3s;margin-top:8px;position:relative;overflow:hidden}
.m-btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold-d));color:var(--deep);box-shadow:0 6px 24px rgba(201,168,76,.3)}
.m-btn-green{background:linear-gradient(135deg,#2ECC8F,#1A9B6A);color:#fff;box-shadow:0 6px 24px rgba(46,204,143,.25)}
.m-btn-red{background:linear-gradient(135deg,#E8585A,#B03030);color:#fff;box-shadow:0 6px 24px rgba(232,88,90,.25)}
.m-btn:hover{transform:translateY(-1px)}
.m-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
.plan-options{display:flex;flex-direction:column;gap:10px}
.plan-opt{padding:14px 16px;border-radius:12px;border:1.5px solid var(--bord);background:var(--surf);cursor:pointer;transition:all .25s;display:flex;justify-content:space-between;align-items:center}
.plan-opt:hover,.plan-opt.selected{border-color:var(--gold);background:rgba(201,168,76,.07)}
.plan-opt-name{font-weight:600;font-size:14px}
.plan-opt-detail{font-size:12px;color:var(--muted);margin-top:3px}
.plan-opt-ret{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;color:var(--gold)}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{position:fixed;bottom:28px;right:28px;z-index:200;padding:14px 22px;border-radius:14px;font-size:14px;font-weight:500;backdrop-filter:blur(20px);transform:translateY(80px);opacity:0;transition:all .35s cubic-bezier(.34,1.56,.64,1);display:flex;align-items:center;gap:10px}
.toast.show{transform:translateY(0);opacity:1}
.toast.success{background:rgba(46,204,143,.15);border:1px solid rgba(46,204,143,.3);color:var(--green)}
.toast.error{background:rgba(232,88,90,.15);border:1px solid rgba(232,88,90,.3);color:var(--red)}
.toast.info{background:rgba(58,155,213,.15);border:1px solid rgba(58,155,213,.3);color:var(--blue)}

/* spinner */
.spin{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spi .7s linear infinite;display:inline-block}
@keyframes spi{to{transform:rotate(360deg)}}

/* ‚îÄ‚îÄ LOGOUT ‚îÄ‚îÄ */
.logout-btn{display:flex;align-items:center;gap:8px;padding:9px 18px;border-radius:100px;border:1px solid rgba(232,88,90,.25);background:rgba(232,88,90,.06);color:var(--red);font-family:'Outfit',sans-serif;font-size:13px;font-weight:500;cursor:pointer;transition:all .25s}
.logout-btn:hover{border-color:var(--red);background:rgba(232,88,90,.12)}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:1024px){.cards-grid{grid-template-columns:repeat(2,1fr)}.bottom-grid{grid-template-columns:1fr}}
@media(max-width:600px){.cards-grid{grid-template-columns:1fr}.welcome{flex-direction:column;gap:20px;text-align:center}.welcome-time{text-align:center}.topbar{flex-wrap:wrap}.top-nav{display:none}}
</style>
</head>
<body>

<div class="bg-fx">
  <div class="orb o1"></div><div class="orb o2"></div><div class="orb o3"></div>
</div>
<div class="grid-bg"></div>

<div class="shell">

  <!-- ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ -->
  <div class="topbar">
    <div class="logo-row">
      <div class="logo-mark">S</div>
      <div class="logo-name">SYLLA</div>
    </div>

    <div class="top-nav">
      <a href="#" class="nav-btn active">
        <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        Tableau de bord
      </a>
      <a href="#" class="nav-btn" onclick="openModal('modal-plan')">
        <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        Investir
      </a>
      <a href="#" class="nav-btn">
        <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
        Historique
      </a>
    </div>

    <div style="display:flex;align-items:center;gap:10px">
      <div class="profile-pill" id="profile-pill">
        <div class="avatar" id="topbar-avatar">?</div>
        <div class="profile-info">
          <div class="profile-name" id="topbar-name">Chargement...</div>
          <div class="profile-rank" id="topbar-rank">Bronze</div>
        </div>
      </div>
      <button class="logout-btn" onclick="handleLogout()">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        D√©connexion
      </button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ WELCOME ‚îÄ‚îÄ -->
  <div class="welcome">
    <div class="welcome-left">
      <h1>Bonjour, <em id="welcome-name">Investisseur</em> üëã</h1>
      <p class="welcome-sub">Votre portefeuille SYLLA performe. Continuez √† faire fructifier votre capital avec intelligence.</p>
    </div>
    <div class="welcome-time">
      <div class="time-val" id="clock">--:--</div>
      <div class="time-date" id="dateval">--</div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ ROW 1 ‚îÄ‚îÄ -->
  <div class="sec-label">Actions rapides</div>
  <div class="cards-grid">

    <!-- Plan -->
    <div class="action-card card-plan" onclick="openModal('modal-plan')">
      <div class="card-icon">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      </div>
      <div class="card-label">Plan</div>
      <div class="card-sub">Choisissez un plan d'investissement adapt√© √† vos objectifs</div>
      <div class="card-val" id="active-plans">0</div>
      <div class="card-badge badge-gold">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        Plans actifs
      </div>
      <div class="card-arrow">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/></svg>
      </div>
    </div>

    <!-- Recharge -->
    <div class="action-card card-recharge" onclick="openModal('modal-recharge')">
      <div class="card-icon">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 5v14m-7-7h14"/></svg>
      </div>
      <div class="card-label">Recharge</div>
      <div class="card-sub">D√©posez des fonds pour commencer ou augmenter vos investissements</div>
      <div class="card-val" id="balance-val">0 GNF</div>
      <div class="card-badge badge-green">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
        Solde disponible
      </div>
      <div class="card-arrow">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/></svg>
      </div>
    </div>

    <!-- Retrait -->
    <div class="action-card card-retrait" onclick="openModal('modal-retrait')">
      <div class="card-icon">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 19V5m7 7-7-7-7 7"/></svg>
      </div>
      <div class="card-label">Retrait</div>
      <div class="card-sub">Retirez vos gains et b√©n√©fices accumul√©s √† tout moment</div>
      <div class="card-val" id="gains-val">0 GNF</div>
      <div class="card-badge badge-red">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>
        Gains cumul√©s
      </div>
      <div class="card-arrow">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/></svg>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ ROW 2 ‚îÄ‚îÄ -->
  <div class="cards-grid">

    <!-- Portefeuille -->
    <div class="action-card card-wallet">
      <div class="card-icon">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M2 8a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8z"/><path d="M16 12h.01"/></svg>
      </div>
      <div class="card-label">Portefeuille</div>
      <div class="card-sub">Total de vos investissements actifs en cours</div>
      <div class="card-val" id="invested-val">0 GNF</div>
      <div class="card-badge badge-blue">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/></svg>
        Montant investi
      </div>
      <div class="card-arrow">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/></svg>
      </div>
    </div>

    <!-- Parrainage -->
    <div class="action-card card-parrain" onclick="copyRefCode()">
      <div class="card-icon">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      </div>
      <div class="card-label">Parrainage</div>
      <div class="card-sub">Partagez votre code et gagnez des bonus sur chaque filleul</div>
      <div class="card-val" style="font-size:20px;font-family:'Outfit';letter-spacing:2px" id="ref-code-display">SYL-XXXXXX</div>
      <div class="card-badge badge-purple">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        Cliquez pour copier
      </div>
      <div class="card-arrow">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/></svg>
      </div>
    </div>

    <!-- Historique -->
    <div class="action-card card-history">
      <div class="card-icon">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
      </div>
      <div class="card-label">Historique</div>
      <div class="card-sub">Consultez toutes vos transactions et op√©rations pass√©es</div>
      <div class="card-val" id="tx-count">0</div>
      <div class="card-badge badge-gold">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        Transactions
      </div>
      <div class="card-arrow">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/></svg>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ BOTTOM ‚îÄ‚îÄ -->
  <div class="bottom-grid" style="margin-top:32px">

    <!-- Top Investisseurs -->
    <div class="investors-panel">
      <div class="sec-label">üèÜ Meilleurs Investisseurs</div>
      <div class="investors-list" id="investors-list">
        <!-- Populated by JS -->
      </div>
    </div>

    <!-- Info Investissement -->
    <div class="info-panel">
      <div class="sec-label">üìö Guide d'Investissement</div>

      <div class="info-section">
        <div class="info-title">
          <svg width="18" height="18" fill="none" stroke="var(--gold)" stroke-width="2" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
          Comment √ßa fonctionne ?
        </div>
        <p class="info-text">
          SYLLA vous permet de faire fructifier votre capital en choisissant parmi plusieurs plans d'investissement. 
          Chaque plan g√©n√®re des <strong style="color:var(--gold)">rendements journaliers</strong> sur votre mise initiale.
          Vos gains s'accumulent automatiquement et sont disponibles pour retrait √† tout moment.
        </p>
      </div>

      <div class="info-section">
        <div class="info-title">
          <svg width="18" height="18" fill="none" stroke="var(--gold)" stroke-width="2" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          Comprendre les Risques
        </div>
        <div class="risk-cards">
          <div class="risk-card risk-low">
            <div class="risk-emoji">üõ°Ô∏è</div>
            <div class="risk-lbl">Faible</div>
            <div class="risk-desc">Rendement stable, capital plus s√©curis√©. Id√©al pour d√©buter.</div>
          </div>
          <div class="risk-card risk-med">
            <div class="risk-emoji">‚öñÔ∏è</div>
            <div class="risk-lbl">Moyen</div>
            <div class="risk-desc">Bon √©quilibre entre rentabilit√© et risque. Pour investisseurs confirm√©s.</div>
          </div>
          <div class="risk-card risk-high">
            <div class="risk-emoji">üöÄ</div>
            <div class="risk-lbl">√âlev√©</div>
            <div class="risk-desc">Rendement maximal mais volatilit√© plus importante. R√©serv√© aux experts.</div>
          </div>
        </div>
      </div>

      <div class="tip-box">
        <div class="tip-icon">
          <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        </div>
        <span>
          <strong style="color:var(--gold)">Conseil SYLLA :</strong> Ne misez que ce que vous pouvez vous permettre d'investir. 
          Diversifiez vos plans pour optimiser vos rendements tout en minimisant les risques. 
          Le parrainage vous offre des bonus suppl√©mentaires sur chaque filleul actif.
        </span>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê -->

<!-- Plan Modal -->
<div class="modal-bg" id="modal-plan">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">Choisir un Plan</div>
      <button class="modal-close" onclick="closeModal('modal-plan')">‚úï</button>
    </div>
    <div class="plan-options" id="plan-options">
      <!-- Populated by JS -->
    </div>
    <div class="m-group" style="margin-top:18px">
      <label class="m-label">Montant √† investir (GNF)</label>
      <input class="m-input" type="number" id="plan-amount" placeholder="Ex: 100000"/>
    </div>
    <button class="m-btn m-btn-gold" id="plan-btn" onclick="submitPlan()">
      <span id="plan-btn-label">Confirmer l'investissement</span>
    </button>
  </div>
</div>

<!-- Recharge Modal -->
<div class="modal-bg" id="modal-recharge">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">Recharger mon compte</div>
      <button class="modal-close" onclick="closeModal('modal-recharge')">‚úï</button>
    </div>
    <div class="m-group">
      <label class="m-label">Montant (GNF)</label>
      <input class="m-input" type="number" id="dep-amount" placeholder="Ex: 500000"/>
    </div>
    <div class="m-group">
      <label class="m-label">M√©thode de paiement</label>
      <select class="m-input m-select" id="dep-method">
        <option value="mobile_money">Orange Money / MTN</option>
        <option value="bank_transfer">Virement Bancaire</option>
        <option value="crypto">Crypto-monnaie</option>
      </select>
    </div>
    <div class="m-group">
      <label class="m-label">R√©f√©rence de transaction</label>
      <input class="m-input" type="text" id="dep-ref" placeholder="Num√©ro de transaction"/>
    </div>
    <button class="m-btn m-btn-green" id="dep-btn" onclick="submitDeposit()">
      <span id="dep-btn-label">Soumettre la recharge</span>
    </button>
  </div>
</div>

<!-- Retrait Modal -->
<div class="modal-bg" id="modal-retrait">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">Effectuer un retrait</div>
      <button class="modal-close" onclick="closeModal('modal-retrait')">‚úï</button>
    </div>
    <div class="m-group">
      <label class="m-label">Montant √† retirer (GNF)</label>
      <input class="m-input" type="number" id="wd-amount" placeholder="Ex: 200000"/>
    </div>
    <div class="m-group">
      <label class="m-label">M√©thode de retrait</label>
      <select class="m-input m-select" id="wd-method">
        <option value="mobile_money">Orange Money / MTN</option>
        <option value="bank">Compte Bancaire</option>
        <option value="crypto">Crypto-monnaie</option>
      </select>
    </div>
    <div class="m-group">
      <label class="m-label">Num√©ro / Compte destinataire</label>
      <input class="m-input" type="text" id="wd-account" placeholder="Ex: +224 620 000 000"/>
    </div>
    <button class="m-btn m-btn-red" id="wd-btn" onclick="submitWithdrawal()">
      <span id="wd-btn-label">Confirmer le retrait</span>
    </button>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast">
  <span id="t-icon"></span>
  <span id="t-msg"></span>
</div>

<script>
// ‚îÄ‚îÄ Supabase ‚îÄ‚îÄ
const { createClient } = supabase;
const sb = createClient(
  'https://fqiotqrraobmsrcyewsi.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZxaW90cXJyYW9ibXNyY3lld3NpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MjA3NzUsImV4cCI6MjA4NzM5Njc3NX0.pmvaQikEDEj705o7kBBWwkLwAoZ62D-GoxjFm5HEHNc'
);

let currentUser = null;
let profile = null;
let plans = [];
let selectedPlan = null;

// ‚îÄ‚îÄ Auth check ‚îÄ‚îÄ
async function init() {
  const { data: { session } } = await sb.auth.getSession();
  if (!session) { window.location.href = 'index.html'; return; }
  currentUser = session.user;
  await loadProfile();
  await loadPlans();
  await loadTopInvestors();
  await loadStats();
  startClock();
}

// ‚îÄ‚îÄ Load profile ‚îÄ‚îÄ
async function loadProfile() {
  const { data } = await sb.from('profiles').select('*').eq('id', currentUser.id).single();
  profile = data;

  const firstName = (data?.full_name || currentUser.email || 'Investisseur').split(' ')[0];
  document.getElementById('welcome-name').textContent = firstName;
  document.getElementById('topbar-name').textContent = data?.full_name || currentUser.email;
  document.getElementById('topbar-rank').textContent = data?.rank || 'Bronze';
  document.getElementById('topbar-avatar').textContent = firstName.charAt(0).toUpperCase();
  document.getElementById('ref-code-display').textContent = data?.referral_code || 'SYL-XXXXXX';

  if (data?.balance !== undefined)
    document.getElementById('balance-val').textContent = fmt(data.balance) + ' GNF';
  if (data?.total_gains !== undefined)
    document.getElementById('gains-val').textContent = fmt(data.total_gains) + ' GNF';
  if (data?.total_invested !== undefined)
    document.getElementById('invested-val').textContent = fmt(data.total_invested) + ' GNF';
}

// ‚îÄ‚îÄ Load stats ‚îÄ‚îÄ
async function loadStats() {
  // Active investments count
  const { count: invCount } = await sb.from('investments')
    .select('*', { count: 'exact', head: true })
    .eq('user_id', currentUser.id).eq('status', 'active');
  document.getElementById('active-plans').textContent = invCount || 0;

  // Transaction count
  const { count: txCount } = await sb.from('transactions')
    .select('*', { count: 'exact', head: true })
    .eq('user_id', currentUser.id);
  document.getElementById('tx-count').textContent = txCount || 0;
}

// ‚îÄ‚îÄ Load plans ‚îÄ‚îÄ
async function loadPlans() {
  const { data } = await sb.from('investment_plans').select('*').eq('is_active', true).order('min_amount');
  plans = data || [];
  renderPlanOptions();
}

function renderPlanOptions() {
  const el = document.getElementById('plan-options');
  el.innerHTML = plans.map(p => `
    <div class="plan-opt" id="po-${p.id}" onclick="selectPlan('${p.id}')">
      <div>
        <div class="plan-opt-name">${p.name}
          <span style="font-size:11px;padding:2px 8px;border-radius:20px;margin-left:8px;background:${riskColor(p.risk_level,true)};color:${riskColor(p.risk_level)};font-weight:600">${p.risk_level}</span>
        </div>
        <div class="plan-opt-detail">Min: ${fmt(p.min_amount)} GNF ¬∑ ${p.duration_days} jours</div>
      </div>
      <div class="plan-opt-ret">${p.daily_return}%<span style="font-size:12px;color:var(--muted)">/j</span></div>
    </div>
  `).join('');
}

function riskColor(r, bg=false) {
  if(r==='Faible')  return bg ? 'rgba(46,204,143,.1)' : 'var(--green)';
  if(r==='Moyen')   return bg ? 'rgba(255,165,0,.1)'  : 'orange';
  return bg ? 'rgba(232,88,90,.1)' : 'var(--red)';
}

function selectPlan(id) {
  selectedPlan = plans.find(p => p.id === id);
  document.querySelectorAll('.plan-opt').forEach(el => el.classList.remove('selected'));
  document.getElementById('po-' + id).classList.add('selected');
  if (selectedPlan?.min_amount)
    document.getElementById('plan-amount').placeholder = `Min: ${fmt(selectedPlan.min_amount)} GNF`;
}

// ‚îÄ‚îÄ Load top investors ‚îÄ‚îÄ
async function loadTopInvestors() {
  const { data } = await sb.from('top_investors').select('*').order('rank_position').limit(5);
  const list = document.getElementById('investors-list');
  if (!data || !data.length) {
    list.innerHTML = '<p style="color:var(--muted);font-size:14px;text-align:center;padding:20px">Aucune donn√©e disponible</p>';
    return;
  }
  const badgeMap = { Platinum:'b-plat', Gold:'b-gold', Silver:'b-silv', Bronze:'b-silv' };
  const rankCls = ['rank-1','rank-2','rank-3','rank-n','rank-n'];
  list.innerHTML = data.map((inv, i) => `
    <div class="investor-row">
      <div class="inv-rank ${rankCls[i] || 'rank-n'}">${i+1}</div>
      <div class="inv-avatar">${(inv.display_name||'?').charAt(0)}</div>
      <div class="inv-info">
        <div class="inv-name">${inv.display_name || 'Anonyme'}</div>
        <div class="inv-sub">Investi: ${fmt(inv.total_invested)} GNF</div>
      </div>
      <span class="inv-badge ${badgeMap[inv.badge]||'b-silv'}">${inv.badge||'Bronze'}</span>
      <div class="inv-gains">
        <div class="inv-gain-val">+${fmt(inv.total_gains)}</div>
        <div class="inv-gain-lbl">GNF gains</div>
      </div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ Submit Plan ‚îÄ‚îÄ
async function submitPlan() {
  if (!selectedPlan) { toast('Veuillez s√©lectionner un plan', 'error'); return; }
  const amount = parseFloat(document.getElementById('plan-amount').value);
  if (!amount || amount < selectedPlan.min_amount) {
    toast(`Montant minimum: ${fmt(selectedPlan.min_amount)} GNF`, 'error'); return;
  }
  setLoading('plan-btn','plan-btn-label', true);
  try {
    const ends = new Date();
    ends.setDate(ends.getDate() + selectedPlan.duration_days);
    const { error } = await sb.from('investments').insert({
      user_id: currentUser.id,
      plan_id: selectedPlan.id,
      amount,
      daily_return: selectedPlan.daily_return,
      duration_days: selectedPlan.duration_days,
      ends_at: ends.toISOString(),
      status: 'active'
    });
    if (error) throw error;
    // Deduct from balance (update profile)
    await sb.from('profiles').update({
      total_invested: (profile?.total_invested || 0) + amount,
      balance: Math.max(0, (profile?.balance || 0) - amount)
    }).eq('id', currentUser.id);

    closeModal('modal-plan');
    toast('Investissement lanc√© avec succ√®s ! üöÄ', 'success');
    await loadProfile(); await loadStats();
  } catch(e) {
    toast(e.message || 'Erreur', 'error');
  }
  setLoading('plan-btn','plan-btn-label', false, 'Confirmer l\'investissement');
}

// ‚îÄ‚îÄ Submit Deposit ‚îÄ‚îÄ
async function submitDeposit() {
  const amount = parseFloat(document.getElementById('dep-amount').value);
  const method = document.getElementById('dep-method').value;
  const ref = document.getElementById('dep-ref').value.trim();
  if (!amount || amount <= 0) { toast('Entrez un montant valide', 'error'); return; }
  setLoading('dep-btn','dep-btn-label', true);
  try {
    const { error } = await sb.from('transactions').insert({
      user_id: currentUser.id,
      type: 'deposit',
      amount,
      method,
      reference: ref,
      status: 'pending'
    });
    if (error) throw error;
    closeModal('modal-recharge');
    toast('Demande de recharge soumise ! En attente de validation ‚úÖ', 'success');
  } catch(e) {
    toast(e.message || 'Erreur', 'error');
  }
  setLoading('dep-btn','dep-btn-label', false, 'Soumettre la recharge');
}

// ‚îÄ‚îÄ Submit Withdrawal ‚îÄ‚îÄ
async function submitWithdrawal() {
  const amount = parseFloat(document.getElementById('wd-amount').value);
  const method = document.getElementById('wd-method').value;
  const account = document.getElementById('wd-account').value.trim();
  if (!amount || amount <= 0) { toast('Entrez un montant valide', 'error'); return; }
  if (!account) { toast('Entrez le num√©ro destinataire', 'error'); return; }
  if (amount > (profile?.balance || 0)) { toast('Solde insuffisant', 'error'); return; }
  setLoading('wd-btn','wd-btn-label', true);
  try {
    const { error } = await sb.from('withdrawals').insert({
      user_id: currentUser.id,
      amount,
      method,
      account_details: { account },
      status: 'pending'
    });
    if (error) throw error;
    closeModal('modal-retrait');
    toast('Demande de retrait soumise ! Traitement sous 24h üí∏', 'info');
  } catch(e) {
    toast(e.message || 'Erreur', 'error');
  }
  setLoading('wd-btn','wd-btn-label', false, 'Confirmer le retrait');
}

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
function fmt(n) {
  return (n||0).toLocaleString('fr-FR');
}

function setLoading(btnId, labelId, loading, text='') {
  const btn = document.getElementById(btnId);
  const lbl = document.getElementById(labelId);
  btn.disabled = loading;
  lbl.innerHTML = loading ? '<span class="spin"></span>' : text;
}

function openModal(id) {
  document.getElementById(id).classList.add('open');
}
function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}
document.querySelectorAll('.modal-bg').forEach(m => {
  m.addEventListener('click', e => { if(e.target === m) m.classList.remove('open'); });
});

function copyRefCode() {
  const code = profile?.referral_code || 'SYL-XXXXXX';
  navigator.clipboard.writeText(code).then(() => toast('Code copi√© : ' + code + ' üìã', 'info'));
}

function toast(msg, type='success') {
  const icons = {
    success: '<svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>',
    error:   '<svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>',
    info:    '<svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>'
  };
  const t = document.getElementById('toast');
  document.getElementById('t-icon').innerHTML = icons[type] || icons.info;
  document.getElementById('t-msg').textContent = msg;
  t.className = `toast ${type} show`;
  setTimeout(() => t.classList.remove('show'), 4000);
}

function startClock() {
  const update = () => {
    const now = new Date();
    document.getElementById('clock').textContent =
      now.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
    document.getElementById('dateval').textContent =
      now.toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
  };
  update(); setInterval(update, 1000);
}

async function handleLogout() {
  await sb.auth.signOut();
  window.location.href = 'index.html';
}

// ‚îÄ‚îÄ Start ‚îÄ‚îÄ
init();
</script>
</body>
</html>
