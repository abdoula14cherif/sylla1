<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>SYLLA ‚Äî Retrait</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@300;400;500;600;700&family=Outfit:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{
  --green:#00D166;--green-l:#4ADE80;--green-d:#009948;
  --teal:#00C9C0;--teal-l:#00EDDE;
  --orange:#FF7A35;--gold:#F5C842;--red:#FF3B4E;
  --amber:#FFB830;--purple:#A064FF;
  --bg:#060E0A;--bg2:#0A1A10;
  --text:#F0FFF5;--text2:#6BA885;--text3:#2E5A40;
  --nav-h:70px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;padding-bottom:calc(var(--nav-h)+24px);}
.bg-mesh{position:fixed;inset:0;z-index:0;pointer-events:none;background:radial-gradient(ellipse 60% 55% at 80% 5%,rgba(0,209,102,.10) 0%,transparent 60%),radial-gradient(ellipse 50% 60% at 5% 85%,rgba(0,201,192,.07) 0%,transparent 55%),linear-gradient(160deg,#060E0A 0%,#0A1A10 55%,#081209 100%);}
.bg-grid{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:linear-gradient(rgba(0,209,102,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(0,209,102,.04) 1px,transparent 1px);background-size:50px 50px;}

.loading-screen{position:fixed;inset:0;z-index:999;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;transition:opacity .5s,visibility .5s;}
.loading-screen.hide{opacity:0;visibility:hidden;pointer-events:none;}
.load-logo{font-family:'Bebas Neue',cursive;font-size:52px;letter-spacing:8px;background:linear-gradient(135deg,var(--green),var(--teal-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:pulse 1.5s ease-in-out infinite;}
.load-bar{width:120px;height:2px;background:rgba(0,209,102,.15);border-radius:2px;overflow:hidden;}
.load-fill{height:100%;background:linear-gradient(90deg,var(--green-d),var(--green));border-radius:2px;animation:lf 1.5s ease-in-out infinite;}
@keyframes lf{0%{width:0%;margin-left:0}50%{width:100%;margin-left:0}100%{width:0%;margin-left:100%}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
@keyframes bounceIn{0%{transform:scale(0);opacity:0}60%{transform:scale(1.15)}100%{transform:scale(1);opacity:1}}

.page{position:relative;z-index:2;padding:0 16px 20px;}

.topbar{display:flex;align-items:center;justify-content:space-between;padding:14px 16px 12px;position:sticky;top:0;z-index:50;background:rgba(6,14,10,.94);backdrop-filter:blur(20px);border-bottom:1px solid rgba(0,209,102,.1);margin:0 -16px 20px;}
.back-btn{display:flex;align-items:center;gap:8px;font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--green);text-decoration:none;padding:8px 14px;border:1px solid rgba(0,209,102,.3);border-radius:20px;transition:all .2s;}
.back-btn:hover{background:rgba(0,209,102,.08);}
.page-title{font-family:'Bebas Neue',cursive;font-size:22px;letter-spacing:4px;background:linear-gradient(135deg,var(--green),var(--teal-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.clock-pill{font-family:'Bebas Neue',cursive;font-size:13px;letter-spacing:2px;color:var(--green);background:rgba(0,209,102,.08);border:1px solid rgba(0,209,102,.2);border-radius:20px;padding:7px 12px;}

.window-banner{border-radius:20px;padding:16px 18px;margin-bottom:16px;animation:fadeUp .4s ease both;}
.wb-open{background:linear-gradient(135deg,rgba(0,209,102,.1),rgba(0,201,192,.05));border:1.5px solid rgba(0,209,102,.28);}
.wb-closed{background:linear-gradient(135deg,rgba(255,59,78,.08),rgba(255,122,53,.04));border:1.5px solid rgba(255,59,78,.22);}
.wb-row{display:flex;align-items:center;gap:12px;}
.wb-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;}
.wb-open .wb-dot{background:var(--green);box-shadow:0 0 12px var(--green);animation:pulse 1.5s ease-in-out infinite;}
.wb-closed .wb-dot{background:var(--red);box-shadow:0 0 10px var(--red);}
.wb-title{font-family:'Bebas Neue',cursive;font-size:19px;letter-spacing:2px;}
.wb-open .wb-title{color:var(--green);}
.wb-closed .wb-title{color:var(--red);}
.wb-desc{font-size:12px;font-weight:300;margin-top:3px;line-height:1.5;}
.wb-open .wb-desc{color:var(--text2);}
.wb-closed .wb-desc{color:rgba(255,130,100,.7);}

.balance-card{background:linear-gradient(135deg,rgba(0,209,102,.09),rgba(0,201,192,.04));border:1.5px solid rgba(0,209,102,.18);border-radius:20px;padding:18px 20px;margin-bottom:20px;animation:fadeUp .4s .05s ease both;}
.bc-lbl{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:rgba(0,209,102,.55);margin-bottom:5px;}
.bc-amount{font-family:'Bebas Neue',cursive;font-size:48px;letter-spacing:3px;line-height:1;background:linear-gradient(135deg,#fff,var(--green-l),var(--teal));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.bc-cur{font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:600;color:var(--green);margin-left:4px;}
.bc-stats{display:flex;gap:0;margin-top:14px;background:rgba(0,0,0,.2);border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,.04);}
.bcs{flex:1;padding:10px 6px;text-align:center;border-right:1px solid rgba(255,255,255,.05);}
.bcs:last-child{border-right:none;}
.bcs-v{font-family:'Bebas Neue',cursive;font-size:17px;letter-spacing:1px;}
.bcs-l{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-top:3px;}

.steps-bar{display:flex;gap:0;background:rgba(0,0,0,.25);border-radius:14px;padding:4px;margin-bottom:20px;border:1px solid rgba(255,255,255,.05);animation:fadeUp .4s .1s ease both;}
.step-tab{flex:1;padding:10px 4px;border-radius:10px;text-align:center;cursor:pointer;transition:all .25s;}
.step-tab.active{background:rgba(0,209,102,.12);border:1px solid rgba(0,209,102,.25);}
.step-num{font-family:'Bebas Neue',cursive;font-size:18px;letter-spacing:1px;}
.step-tab.active .step-num{color:var(--green);}
.step-tab:not(.active) .step-num{color:var(--text3);}
.step-lbl{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-top:2px;}
.step-tab.active .step-lbl{color:var(--green);}

.step-panel{display:none;animation:fadeUp .3s ease both;}
.step-panel.active{display:block;}

.card{background:rgba(255,255,255,.03);border:1px solid rgba(0,209,102,.1);border-radius:20px;padding:18px;margin-bottom:14px;}
.field-lbl{display:block;font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:rgba(0,209,102,.65);margin-bottom:8px;}
.amount-wrap{position:relative;margin-bottom:10px;}
.amount-inp{width:100%;background:rgba(0,209,102,.04);border:1.5px solid rgba(0,209,102,.18);border-radius:14px;padding:16px 80px 16px 18px;font-family:'Bebas Neue',cursive;font-size:34px;letter-spacing:2px;color:var(--green);outline:none;transition:all .25s;}
.amount-inp::placeholder{color:rgba(0,209,102,.18);font-size:26px;}
.amount-inp:focus{border-color:var(--green);background:rgba(0,209,102,.08);box-shadow:0 0 0 4px rgba(0,209,102,.07);}
.cur-tag{position:absolute;right:18px;top:50%;transform:translateY(-50%);font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;letter-spacing:2px;color:rgba(0,209,102,.35);}
.min-hint{font-size:11px;font-weight:300;color:var(--text3);margin-bottom:12px;}
.quick-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;}
.qb{padding:9px 13px;border-radius:10px;border:1px solid rgba(0,209,102,.18);background:rgba(0,209,102,.04);color:var(--green);font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;letter-spacing:1.5px;cursor:pointer;transition:all .2s;}
.qb:hover{background:rgba(0,209,102,.12);border-color:var(--green);}
.qb.max-btn{background:rgba(245,200,66,.07);border-color:rgba(245,200,66,.22);color:var(--gold);}
.qb.max-btn:hover{background:rgba(245,200,66,.14);}

.fee-card{background:linear-gradient(135deg,rgba(255,122,53,.07),rgba(0,0,0,.2));border:1px solid rgba(255,122,53,.18);border-radius:16px;padding:14px 16px;margin-bottom:16px;}
.fee-title{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:rgba(255,122,53,.7);margin-bottom:10px;}
.fee-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.04);}
.fee-row:last-child{border-bottom:none;margin-top:4px;padding-top:10px;}
.fee-lbl{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:var(--text3);}
.fee-val{font-family:'Bebas Neue',cursive;font-size:19px;letter-spacing:1px;}

.next-btn{width:100%;padding:15px;border:none;border-radius:14px;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:4px;text-transform:uppercase;color:#fff;background:linear-gradient(135deg,var(--green-d),var(--green));box-shadow:0 8px 28px rgba(0,209,102,.3);cursor:pointer;transition:all .3s;position:relative;overflow:hidden;}
.next-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s;}
.next-btn:hover::before{left:100%;}
.next-btn:hover{transform:translateY(-2px);}
.next-btn:disabled{opacity:.4;cursor:not-allowed;transform:none;box-shadow:none;}

.cat-title{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin:14px 0 10px;display:flex;align-items:center;gap:8px;}
.method-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:4px;}
.method-opt{background:rgba(255,255,255,.03);border:1.5px solid rgba(255,255,255,.07);border-radius:16px;padding:16px 10px;cursor:pointer;text-align:center;transition:all .25s;position:relative;}
.method-opt:hover{border-color:rgba(0,209,102,.3);background:rgba(0,209,102,.04);transform:translateY(-2px);}
.method-opt.selected{border-color:var(--green);background:rgba(0,209,102,.08);box-shadow:0 4px 20px rgba(0,209,102,.12);}
.method-opt.selected::before{content:'‚úì';position:absolute;top:7px;right:10px;font-size:11px;color:var(--green);font-weight:900;}
.mo-ico{font-size:28px;margin-bottom:6px;}
.mo-name{font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;letter-spacing:.5px;color:var(--text);}
.mo-tag{display:inline-block;margin-top:5px;font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;padding:3px 8px;border-radius:5px;}
.tag-m{background:rgba(0,209,102,.1);color:var(--green);}
.tag-b{background:rgba(255,184,48,.1);color:var(--amber);}
.tag-c{background:rgba(160,100,255,.1);color:var(--purple);}

.input-field{width:100%;background:rgba(0,209,102,.04);border:1.5px solid rgba(0,209,102,.14);border-radius:13px;padding:14px 16px;font-family:'Outfit',sans-serif;font-size:15px;font-weight:300;color:var(--text);outline:none;transition:all .25s;margin-bottom:6px;}
.input-field::placeholder{color:rgba(107,168,133,.3);font-size:13px;}
.input-field:focus{border-color:var(--green);background:rgba(0,209,102,.07);box-shadow:0 0 0 4px rgba(0,209,102,.07);}
.inp-hint{font-size:11px;font-weight:300;color:var(--text3);margin-bottom:16px;}

.row-btns{display:grid;grid-template-columns:1fr 1.6fr;gap:10px;}
.back-step{padding:14px;border-radius:14px;border:1.5px solid rgba(255,255,255,.1);background:transparent;color:var(--text3);cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:2px;text-transform:uppercase;transition:all .2s;}
.back-step:hover{background:rgba(255,255,255,.05);}

.confirm-card{background:rgba(0,0,0,.3);border:1px solid rgba(0,209,102,.12);border-radius:20px;overflow:hidden;margin-bottom:16px;}
.cc-head{padding:16px 18px;border-bottom:1px solid rgba(255,255,255,.05);display:flex;align-items:center;gap:12px;}
.cc-head-ico{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;background:rgba(0,209,102,.08);flex-shrink:0;}
.cc-head-name{font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:2px;color:var(--green);}
.cc-head-sub{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-top:2px;}
.conf-row{display:flex;justify-content:space-between;align-items:center;padding:13px 18px;border-bottom:1px solid rgba(255,255,255,.04);}
.conf-row:last-child{border-bottom:none;}
.conf-lbl{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);}
.conf-val{font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:1px;}

.proc-badge{display:flex;align-items:center;gap:12px;background:rgba(255,184,48,.07);border:1px solid rgba(255,184,48,.2);border-radius:14px;padding:14px;margin-bottom:16px;}
.proc-ico{font-size:24px;flex-shrink:0;}
.proc-title{font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:1px;color:var(--amber);}
.proc-sub{font-size:12px;font-weight:300;color:rgba(255,200,100,.65);margin-top:3px;line-height:1.5;}

.err-box{display:none;background:rgba(255,59,78,.08);border:1px solid rgba(255,59,78,.25);border-radius:12px;padding:12px 14px;margin-bottom:14px;font-size:13px;color:#FF6B7A;}

.submit-btn{width:100%;padding:16px;border:none;border-radius:14px;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:4px;text-transform:uppercase;color:#fff;background:linear-gradient(135deg,var(--green-d),var(--green));box-shadow:0 8px 30px rgba(0,209,102,.32);cursor:pointer;transition:all .3s;position:relative;overflow:hidden;}
.submit-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s;}
.submit-btn:hover::before{left:100%;}
.submit-btn:hover{transform:translateY(-2px);box-shadow:0 14px 40px rgba(0,209,102,.42);}
.submit-btn:disabled{opacity:.45;cursor:not-allowed;transform:none;box-shadow:none;}
.ld{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;vertical-align:middle;margin-right:8px;}

.rules-card{background:rgba(255,184,48,.05);border:1px solid rgba(255,184,48,.15);border-radius:18px;padding:16px;margin-bottom:20px;animation:fadeUp .4s .2s ease both;}
.rules-title{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--amber);margin-bottom:12px;}
.rule{display:flex;align-items:flex-start;gap:10px;padding:7px 0;border-bottom:1px solid rgba(255,255,255,.03);font-size:12px;font-weight:300;color:rgba(255,200,100,.7);line-height:1.55;}
.rule:last-child{border-bottom:none;}
.ri{font-size:14px;flex-shrink:0;margin-top:1px;}

.sec-title{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--text3);margin:4px 0 12px;display:flex;align-items:center;gap:10px;}
.sec-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(0,209,102,.2),transparent);}
.hist-list{display:flex;flex-direction:column;gap:8px;animation:fadeUp .4s .25s ease both;}
.hi{display:flex;align-items:center;gap:12px;background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.05);border-radius:14px;padding:13px 14px;}
.hi-ico{width:38px;height:38px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.hi-info{flex:1;min-width:0;}
.hi-name{font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;color:var(--text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.hi-date{font-size:10px;font-weight:300;color:var(--text3);margin-top:2px;}
.hi-right{text-align:right;flex-shrink:0;}
.hi-amt{font-family:'Bebas Neue',cursive;font-size:19px;letter-spacing:1px;color:var(--orange);}
.hi-st{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-top:2px;}
.st-ok{color:var(--green-l);}
.st-pend{color:var(--amber);}
.st-rej{color:var(--red);}

.suc-overlay{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.94);backdrop-filter:blur(20px);display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .4s;padding:28px;text-align:center;}
.suc-overlay.show{opacity:1;pointer-events:all;}
.suc-ico{font-size:80px;margin-bottom:20px;animation:bounceIn .6s ease both .1s;}
.suc-title{font-family:'Bebas Neue',cursive;font-size:42px;letter-spacing:4px;background:linear-gradient(135deg,var(--green-l),var(--teal-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:10px;}
.suc-msg{font-size:13px;font-weight:300;color:var(--text2);line-height:1.7;max-width:320px;margin-bottom:8px;}
.suc-ref{font-family:'Bebas Neue',cursive;font-size:15px;letter-spacing:3px;color:var(--gold);margin-bottom:24px;}
.suc-badge{display:flex;align-items:center;gap:10px;background:rgba(255,184,48,.08);border:1px solid rgba(255,184,48,.22);border-radius:14px;padding:14px 18px;margin-bottom:24px;width:100%;max-width:320px;}
.suc-badge-txt{font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:600;letter-spacing:1px;color:var(--amber);line-height:1.5;text-align:left;}
.suc-btn{padding:15px 40px;border-radius:14px;border:none;cursor:pointer;background:linear-gradient(135deg,var(--green-d),var(--green));font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#fff;box-shadow:0 8px 24px rgba(0,209,102,.3);}

.toast{position:fixed;top:80px;left:50%;transform:translateX(-50%) translateY(-20px);backdrop-filter:blur(12px);color:#fff;padding:10px 22px;border-radius:100px;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:1.5px;z-index:500;opacity:0;transition:all .3s;pointer-events:none;white-space:nowrap;max-width:90vw;text-align:center;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

.bot-nav{position:fixed;bottom:0;left:0;right:0;z-index:100;height:var(--nav-h);background:rgba(6,14,10,.96);backdrop-filter:blur(24px);border-top:1px solid rgba(0,209,102,.1);display:grid;grid-template-columns:repeat(4,1fr);box-shadow:0 -8px 32px rgba(0,0,0,.5);}
.nav-item{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;cursor:pointer;text-decoration:none;transition:all .2s;padding:8px 4px;position:relative;}
.nav-item::before{content:'';position:absolute;top:0;left:20%;right:20%;height:2px;border-radius:0 0 4px 4px;background:linear-gradient(90deg,var(--green),var(--teal));transform:scaleX(0);transition:transform .3s;}
.nav-item.active::before{transform:scaleX(1);}
.nav-item.active .nav-ico,.nav-item.active .nav-lbl{color:var(--green);}
.nav-ico{font-size:20px;color:var(--text3);transition:color .2s;}
.nav-lbl{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);transition:color .2s;}
</style>
</head>
<body>

<div class="loading-screen" id="loader">
  <div class="load-logo">üí∏ RETRAIT</div>
  <div class="load-bar"><div class="load-fill"></div></div>
</div>

<div class="bg-mesh"></div>
<div class="bg-grid"></div>
<div class="toast" id="toast"></div>

<!-- SUCCESS OVERLAY -->
<div class="suc-overlay" id="suc-overlay">
  <div class="suc-ico">üéâ</div>
  <div class="suc-title">Demande Envoy√©e !</div>
  <div class="suc-msg" id="suc-msg">Votre demande a √©t√© enregistr√©e.</div>
  <div class="suc-ref" id="suc-ref">REF: ‚Äî</div>
  <div class="suc-badge">
    <span style="font-size:22px">‚è±</span>
    <div class="suc-badge-txt">Traitement sous <strong>24 heures</strong>.<br>Vous serez notifi√© d√®s le paiement effectu√©.</div>
  </div>
  <button class="suc-btn" onclick="window.location.href='dashboard.html'">Retour au Dashboard ‚Üí</button>
</div>

<div class="page">

  <!-- TOPBAR -->
  <div class="topbar">
    <a href="dashboard.html" class="back-btn">‚Üê Accueil</a>
    <div class="page-title">üí∏ RETRAIT</div>
    <div class="clock-pill" id="live-clock">00:00:00</div>
  </div>

  <!-- BANNER -->
  <div id="window-banner"></div>

  <!-- BALANCE -->
  <div class="balance-card">
    <div class="bc-lbl">üí∞ Solde disponible pour retrait</div>
    <div><span class="bc-amount" id="bal-display">0</span><span class="bc-cur">FCFA</span></div>
    <div class="bc-stats">
      <div class="bcs"><div class="bcs-v" style="color:var(--orange)" id="s-wd">0</div><div class="bcs-l">Total retir√©</div></div>
      <div class="bcs"><div class="bcs-v" style="color:var(--amber)" id="s-pend">0</div><div class="bcs-l">En attente</div></div>
      <div class="bcs"><div class="bcs-v" style="color:var(--teal)" id="s-cnt">0</div><div class="bcs-l">Nb retraits</div></div>
    </div>
  </div>

  <!-- STEPS BAR -->
  <div class="steps-bar">
    <div class="step-tab active" id="tab-1"><div class="step-num">1</div><div class="step-lbl">Montant</div></div>
    <div class="step-tab" id="tab-2"><div class="step-num">2</div><div class="step-lbl">M√©thode</div></div>
    <div class="step-tab" id="tab-3"><div class="step-num">3</div><div class="step-lbl">Confirmer</div></div>
  </div>

  <!-- ‚ïê‚ïê STEP 1 ‚ïê‚ïê -->
  <div class="step-panel active" id="panel-1">
    <div class="card">
      <label class="field-lbl">Montant √† retirer</label>
      <div class="amount-wrap">
        <input class="amount-inp" type="number" id="amount-inp" placeholder="2 000" min="1000" oninput="calcFee()">
        <span class="cur-tag">FCFA</span>
      </div>
      <div class="min-hint">‚ö° Minimum <strong style="color:var(--green)">1 000 FCFA</strong> ¬∑ Frais <strong style="color:var(--orange)">10%</strong> pr√©lev√©s</div>
      <div class="quick-row">
        <button class="qb" onclick="setAmt(2000)">2 000</button>
        <button class="qb" onclick="setAmt(5000)">5 000</button>
        <button class="qb" onclick="setAmt(10000)">10 000</button>
        <button class="qb" onclick="setAmt(25000)">25 000</button>
        <button class="qb max-btn" onclick="setMax()">MAX üí∞</button>
      </div>
    </div>

    <div class="fee-card" id="fee-card" style="display:none">
      <div class="fee-title">üìä D√©tail du retrait</div>
      <div class="fee-row"><div class="fee-lbl">Montant demand√©</div><div class="fee-val" style="color:var(--green)" id="f-brut">‚Äî</div></div>
      <div class="fee-row"><div class="fee-lbl">Frais de service (10%)</div><div class="fee-val" style="color:var(--orange)" id="f-frais">‚Äî</div></div>
      <div class="fee-row"><div class="fee-lbl" style="color:var(--gold)">Vous recevez</div><div class="fee-val" style="color:var(--gold);font-size:24px" id="f-net">‚Äî</div></div>
      <div class="fee-row"><div class="fee-lbl">Solde restant apr√®s</div><div class="fee-val" style="color:var(--text2);font-size:17px" id="f-after">‚Äî</div></div>
    </div>

    <button class="next-btn" id="btn-next1" onclick="goStep(2)" disabled>Choisir la m√©thode ‚Üí</button>
  </div>

  <!-- ‚ïê‚ïê STEP 2 ‚ïê‚ïê -->
  <div class="step-panel" id="panel-2">

    <div class="cat-title"><span>üì±</span> Mobile Money</div>
    <div class="method-grid">
      <div class="method-opt selected" onclick="selectMethod('wave',this)">
        <div class="mo-ico">üåä</div><div class="mo-name">Wave</div><div class="mo-tag tag-m">Sous 24h</div>
      </div>
      <div class="method-opt" onclick="selectMethod('orange',this)">
        <div class="mo-ico">üü†</div><div class="mo-name">Orange Money</div><div class="mo-tag tag-m">Sous 24h</div>
      </div>
      <div class="method-opt" onclick="selectMethod('mtn',this)">
        <div class="mo-ico">üíõ</div><div class="mo-name">MTN MoMo</div><div class="mo-tag tag-m">Sous 24h</div>
      </div>
      <div class="method-opt" onclick="selectMethod('moov',this)">
        <div class="mo-ico">üîµ</div><div class="mo-name">Moov Money</div><div class="mo-tag tag-m">Sous 24h</div>
      </div>
    </div>

    <div class="cat-title" style="margin-top:16px"><span>üí≥</span> Carte Bancaire</div>
    <div class="method-grid">
      <div class="method-opt" onclick="selectMethod('visa',this)">
        <div class="mo-ico">üí≥</div><div class="mo-name">Visa / Mastercard</div><div class="mo-tag tag-b">Sous 24h</div>
      </div>
      <div class="method-opt" onclick="selectMethod('bank',this)">
        <div class="mo-ico">üè¶</div><div class="mo-name">Virement Banque</div><div class="mo-tag tag-b">Sous 24h</div>
      </div>
    </div>

    <div class="cat-title" style="margin-top:16px"><span>‚Çø</span> Crypto-monnaie</div>
    <div class="method-grid">
      <div class="method-opt" onclick="selectMethod('usdt',this)">
        <div class="mo-ico">‚ÇÆ</div><div class="mo-name">USDT TRC-20</div><div class="mo-tag tag-c">Sous 24h</div>
      </div>
      <div class="method-opt" onclick="selectMethod('btc',this)">
        <div class="mo-ico">‚Çø</div><div class="mo-name">Bitcoin</div><div class="mo-tag tag-c">Sous 24h</div>
      </div>
    </div>

    <div style="margin-top:18px">
      <label class="field-lbl" id="acct-lbl">Num√©ro de t√©l√©phone</label>
      <input class="input-field" type="text" id="acct-inp" placeholder="+225 07 00 00 00 00">
      <div class="inp-hint" id="acct-hint">Entrez le num√©ro enregistr√© sur Wave</div>
    </div>

    <div class="row-btns">
      <button class="back-step" onclick="goStep(1)">‚Üê Retour</button>
      <button class="next-btn" style="margin:0" onclick="goStep(3)">V√©rifier ‚Üí</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê STEP 3 ‚ïê‚ïê -->
  <div class="step-panel" id="panel-3">

    <div class="confirm-card">
      <div class="cc-head">
        <div class="cc-head-ico" id="c-ico">üåä</div>
        <div>
          <div class="cc-head-name" id="c-name">Wave</div>
          <div class="cc-head-sub" id="c-sub">Mobile Money</div>
        </div>
      </div>
      <div class="conf-row"><div class="conf-lbl">Montant brut</div><div class="conf-val" style="color:var(--green)" id="c-brut">‚Äî</div></div>
      <div class="conf-row"><div class="conf-lbl">Frais (10%)</div><div class="conf-val" style="color:var(--orange)" id="c-frais">‚Äî</div></div>
      <div class="conf-row" style="background:rgba(245,200,66,.04)">
        <div class="conf-lbl" style="color:var(--gold)">Vous recevez</div>
        <div class="conf-val" style="color:var(--gold);font-size:26px" id="c-net">‚Äî</div>
      </div>
      <div class="conf-row"><div class="conf-lbl">Compte destinataire</div><div class="conf-val" style="color:var(--text);font-size:14px;font-family:'Outfit',sans-serif;font-weight:600;word-break:break-all" id="c-acct">‚Äî</div></div>
      <div class="conf-row"><div class="conf-lbl">D√©lai de traitement</div><div class="conf-val" style="color:var(--amber);font-size:18px">SOUS 24 HEURES</div></div>
    </div>

    <div class="proc-badge">
      <div class="proc-ico">‚è±</div>
      <div>
        <div class="proc-title">Traitement garanti sous 24h</div>
        <div class="proc-sub">Votre retrait sera trait√© entre 8h et 18h. Une notification vous sera envoy√©e d√®s que le paiement est effectu√©.</div>
      </div>
    </div>

    <div class="err-box" id="err-box"></div>

    <div class="row-btns">
      <button class="back-step" onclick="goStep(2)">‚Üê Retour</button>
      <button class="submit-btn" style="margin:0" id="submit-btn" onclick="submitWithdraw()">üí∏ Envoyer la demande</button>
    </div>
  </div>

  <!-- RULES -->
  <div class="rules-card" style="margin-top:20px">
    <div class="rules-title">üìã R√®gles de retrait</div>
    <div class="rule"><span class="ri">üí∞</span><span>Minimum <strong>1 000 FCFA</strong>. Des frais de service de <strong>10%</strong> sont pr√©lev√©s sur chaque retrait.</span></div>
    <div class="rule"><span class="ri">‚è±</span><span>Traitement garanti sous <strong>24 heures</strong> apr√®s validation de la demande.</span></div>
    <div class="rule"><span class="ri">üì±</span><span><strong>Mobile Money</strong> : Wave, Orange Money, MTN MoMo, Moov Money. V√©rifiez votre num√©ro.</span></div>
    <div class="rule"><span class="ri">üí≥</span><span><strong>Carte bancaire</strong> : Visa, Mastercard ou virement bancaire (UBA, Ecobank, CBI). V√©rifiez votre RIB.</span></div>
    <div class="rule"><span class="ri">‚Çø</span><span><strong>Crypto</strong> : USDT TRC-20 et Bitcoin. V√©rifiez soigneusement votre adresse, les transactions crypto sont irr√©versibles.</span></div>
    <div class="rule"><span class="ri">üîí</span><span>Le bonus de bienvenue est retirable apr√®s avoir r√©alis√© un premier investissement.</span></div>
  </div>

  <div class="sec-title">Historique des retraits</div>
  <div class="hist-list" id="hist-list">
    <div style="text-align:center;padding:20px;color:var(--text3);font-size:13px">Chargement‚Ä¶</div>
  </div>

</div>

<nav class="bot-nav">
  <a href="dashboard.html" class="nav-item"><span class="nav-ico">üè†</span><span class="nav-lbl">Accueil</span></a>
  <a href="plan.html" class="nav-item"><span class="nav-ico">üöÄ</span><span class="nav-lbl">Plans</span></a>
  <a href="retrait.html" class="nav-item active"><span class="nav-ico">üí∏</span><span class="nav-lbl">Retrait</span></a>
  <a href="messages.html" class="nav-item"><span class="nav-ico">üí¨</span><span class="nav-lbl">Messages</span></a>
  <a href="profil.html" class="nav-item"><span class="nav-ico">üë§</span><span class="nav-lbl">Profil</span></a>
</nav>

<script>
const{createClient}=supabase;
const sb=createClient('https://fqiotqrraobmsrcyewsi.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZxaW90cXJyYW9ibXNyY3lld3NpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MjA3NzUsImV4cCI6MjA4NzM5Njc3NX0.pmvaQikEDEj705o7kBBWwkLwAoZ62D-GoxjFm5HEHNc');

const FEE=0.10, MIN=1000;

// ‚úÖ CORRIG√â : tableau sans doublons
const METHODS=[
  {id:'wave',  ico:'üåä', name:'Wave Money',        sub:'CI ¬∑ S√©n√©gal ¬∑ Mali'},
  {id:'orange',ico:'üü†', name:'Orange Money',      sub:'CI ¬∑ SN ¬∑ BF ¬∑ ML'},
  {id:'mtn',   ico:'üíõ', name:'MTN MoMo',          sub:'CI ¬∑ Ghana ¬∑ B√©nin'},
  {id:'moov',  ico:'üîµ', name:'Moov Money',        sub:'CI ¬∑ BJ ¬∑ TG ¬∑ ML'},
  {id:'visa',  ico:'üí≥', name:'Visa / Mastercard', sub:'Toutes banques'},
  {id:'bank',  ico:'üè¶', name:'Virement Bancaire', sub:'UBA ¬∑ Ecobank ¬∑ CBI'},
  {id:'usdt',  ico:'‚ÇÆ',  name:'USDT TRC-20',       sub:'Tether ¬∑ Tron Network'},
  {id:'btc',   ico:'‚Çø',  name:'Bitcoin (BTC)',      sub:'Bitcoin Network'},
];

let cu=null, userBalance=0, selM=METHODS[0];
let toastT2=null;

async function init(){
  const{data:{session}}=await sb.auth.getSession();
  if(!session){window.location.href='index.html';return;}
  cu=session.user;
  renderBanner();
  await Promise.allSettled([loadBalance(),loadHistory()]);
  document.getElementById('loader').classList.add('hide');
}

function renderBanner(){
  document.getElementById('window-banner').innerHTML=`
    <div class="window-banner wb-open">
      <div class="wb-row">
        <div class="wb-dot"></div>
        <div>
          <div class="wb-title">RETRAITS OUVERTS 24h/7j</div>
          <div class="wb-desc">Traitement sous 24h apr√®s validation de votre demande</div>
        </div>
      </div>
    </div>`;
}

async function loadBalance(){
  try{
    const{data,error}=await sb.rpc('get_solde',{p_user_id:cu.id});
    userBalance=error?0:Number(data)||0;
  }catch(e){userBalance=0;}

  let wd=0,pend=0,cnt=0;
  try{
    const{data}=await sb.from('retraits').select('montant_brut,statut').eq('user_id',cu.id);
    if(data){
      data.forEach(r=>{
        if(r.statut==='en_attente')pend+=Number(r.montant_brut);
        else if(r.statut==='valide'){wd+=Number(r.montant_brut);cnt++;}
      });
    }
  }catch(e){}

  document.getElementById('bal-display').textContent=fmt(userBalance);
  document.getElementById('s-wd').textContent=fmt(wd);
  document.getElementById('s-pend').textContent=fmt(pend);
  document.getElementById('s-cnt').textContent=cnt;
}

async function loadHistory(){
  const list=document.getElementById('hist-list');
  try{
    const{data}=await sb.from('retraits')
      .select('*').eq('user_id',cu.id)
      .order('created_at',{ascending:false}).limit(15);
    if(!data?.length){
      list.innerHTML='<div style="text-align:center;padding:20px;color:var(--text3);font-size:13px">üí∏ Aucun retrait effectu√©</div>';
      return;
    }
    list.innerHTML=data.map(t=>{
      const d=new Date(t.created_at);
      const ds=d.toLocaleDateString('fr-FR',{day:'2-digit',month:'short'})+' '+d.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});
      const stMap={'en_attente':'‚è≥ En attente','valide':'‚úì Trait√©','rejete':'‚úï Rejet√©'};
      const stCls=t.statut==='en_attente'?'st-pend':t.statut==='rejete'?'st-rej':'st-ok';
      const fraisStr=t.frais>0?` (frais: -${fmt(t.frais)}F)`:'';
      return `<div class="hi">
        <div class="hi-ico">üí∏</div>
        <div class="hi-info">
          <div class="hi-name">${t.methode} ‚Üí ${t.numero_compte}</div>
          <div class="hi-date">${ds}${fraisStr}</div>
          ${t.statut==='rejete'&&t.note_admin?`<div style="font-size:11px;color:var(--red);margin-top:3px">Motif: ${t.note_admin}</div>`:''}
        </div>
        <div class="hi-right">
          <div class="hi-amt" style="color:var(--red)">-${fmt(t.montant_brut)} F</div>
          <div class="hi-st ${stCls}">${stMap[t.statut]||t.statut}</div>
        </div>
      </div>`;
    }).join('');
  }catch(e){
    list.innerHTML='<div style="text-align:center;padding:16px;color:var(--text3)">Historique indisponible</div>';
  }
}

// ‚úÖ CORRIG√â : calcFee d√©finie
function calcFee(){
  const v=Number(document.getElementById('amount-inp').value)||0;
  const feeCard=document.getElementById('fee-card');
  if(v>=MIN){
    const frais=Math.round(v*FEE);
    const net=v-frais;
    const after=userBalance-v;
    document.getElementById('f-brut').textContent=fmt(v)+' FCFA';
    document.getElementById('f-frais').textContent='-'+fmt(frais)+' FCFA';
    document.getElementById('f-net').textContent=fmt(net)+' FCFA';
    document.getElementById('f-after').textContent=fmt(Math.max(0,after))+' FCFA';
    feeCard.style.display='block';
  }else{
    feeCard.style.display='none';
  }
  validateStep1();
}

// ‚úÖ CORRIG√â : setMax d√©finie
function setMax(){
  document.getElementById('amount-inp').value=userBalance;
  calcFee();
}

function setAmt(v){
  document.getElementById('amount-inp').value=v;
  calcFee();
}

// ‚úÖ CORRIG√â : validation sans r√©f√©rence √† #s1-err manquant
function validateStep1(){
  const v=Number(document.getElementById('amount-inp').value)||0;
  const btn=document.getElementById('btn-next1');
  btn.disabled=!(v>=MIN && v<=userBalance);
}

// ‚úÖ CORRIG√â : utilise le tableau d√©dupliqu√© + met √† jour placeholder
function selectMethod(id,el){
  selM=METHODS.find(m=>m.id===id)||METHODS[0];
  document.querySelectorAll('.method-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');

  const inp=document.getElementById('acct-inp');
  const hint=document.getElementById('acct-hint');
  const lbl=document.getElementById('acct-lbl');

  if(['wave','orange','mtn','moov'].includes(id)){
    lbl.textContent='Num√©ro de t√©l√©phone';
    inp.placeholder='+225 07 00 00 00 00';
    hint.textContent='Entrez le num√©ro enregistr√© sur '+selM.name;
  }else if(['visa','bank'].includes(id)){
    lbl.textContent='IBAN / RIB ou num√©ro de carte';
    inp.placeholder='FR76 3000 6000 0112 3456 7890 189';
    hint.textContent='Num√©ro de compte bancaire complet';
  }else if(['usdt','btc'].includes(id)){
    lbl.textContent='Adresse de portefeuille';
    inp.placeholder='TRC20: T... / BTC: 1...';
    hint.textContent='‚ö†Ô∏è V√©rifiez bien votre adresse ‚Äî transaction irr√©versible';
  }
}

// ‚úÖ CORRIG√â : validation via showToast, plus de #s1-err
function goStep(n){
  const amount=Number(document.getElementById('amount-inp').value)||0;
  const acct=document.getElementById('acct-inp')?.value.trim()||'';
  const frais=Math.round(amount*FEE);
  const net=amount-frais;

  if(n===2){
    if(amount<MIN){showToast('‚ö†Ô∏è Minimum '+fmt(MIN)+' FCFA requis',true);return;}
    if(amount>userBalance){showToast('‚ö†Ô∏è Solde insuffisant ('+fmt(userBalance)+' FCFA)',true);return;}
  }
  if(n===3){
    if(!acct||acct.length<5){showToast('‚ö†Ô∏è Entrez un compte valide (min 5 caract√®res)',true);return;}
    document.getElementById('c-ico').textContent=selM.ico;
    document.getElementById('c-name').textContent=selM.name;
    document.getElementById('c-sub').textContent=selM.sub||'';
    document.getElementById('c-brut').textContent=fmt(amount)+' FCFA';
    document.getElementById('c-frais').textContent='-'+fmt(frais)+' FCFA (10%)';
    document.getElementById('c-net').textContent=fmt(net)+' FCFA';
    document.getElementById('c-acct').textContent=acct;
    document.getElementById('err-box').style.display='none';
    document.getElementById('submit-btn').disabled=false;
    document.getElementById('submit-btn').innerHTML='üí∏ Envoyer la demande';
  }

  document.querySelectorAll('.step-panel').forEach((p,i)=>p.classList.toggle('active',i===n-1));
  document.querySelectorAll('.step-tab').forEach((t,i)=>t.classList.toggle('active',i===n-1));
  window.scrollTo({top:0,behavior:'smooth'});
}

async function submitWithdraw(){
  const amount=Number(document.getElementById('amount-inp').value)||0;
  const acct=document.getElementById('acct-inp').value.trim();
  const btn=document.getElementById('submit-btn');
  const errBox=document.getElementById('err-box');
  errBox.style.display='none';

  if(amount<MIN){errBox.style.display='block';errBox.textContent='Minimum '+fmt(MIN)+' FCFA';return;}
  if(amount>userBalance){errBox.style.display='block';errBox.textContent='Solde insuffisant. Disponible : '+fmt(userBalance)+' FCFA';return;}
  if(!acct||acct.length<5){errBox.style.display='block';errBox.textContent='Num√©ro de compte invalide';return;}

  btn.disabled=true;
  btn.innerHTML='<span class="ld"></span>Envoi en cours‚Ä¶';

  try{
    const{data,error}=await sb.rpc('demander_retrait',{
      p_user_id   :cu.id,
      p_montant   :amount,
      p_methode   :selM.name,
      p_numero    :acct,
      p_frais_pct :FEE
    });

    if(error||!data?.success) throw new Error(data?.error||error?.message||'Erreur inconnue');

    document.getElementById('suc-msg').textContent=
      fmt(data.montant_net)+' FCFA vers '+acct+' via '+selM.name+
      '. Frais : '+fmt(data.frais)+' FCFA. Solde restant : '+fmt(data.solde_restant)+' FCFA.';
    document.getElementById('suc-ref').textContent='REF: SYLLA-'+data.retrait_id.toString().substring(0,8).toUpperCase();
    document.getElementById('suc-overlay').classList.add('show');
    await Promise.allSettled([loadBalance(),loadHistory()]);

  }catch(err){
    btn.disabled=false;
    btn.innerHTML='üí∏ Envoyer la demande';
    errBox.style.display='block';
    errBox.textContent='‚ùå '+(err.message||'Erreur. R√©essayez.');
  }
}

function fmt(n){return Number(n).toLocaleString('fr-FR');}

function showToast(msg,isErr=false){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.style.background=isErr?'rgba(255,59,78,.92)':'rgba(0,209,102,.92)';
  t.classList.add('show');
  clearTimeout(toastT2);
  toastT2=setTimeout(()=>t.classList.remove('show'),3500);
}

// Horloge live
setInterval(()=>{
  const n=new Date();
  const el=document.getElementById('live-clock');
  if(el)el.textContent=String(n.getHours()).padStart(2,'0')+':'+String(n.getMinutes()).padStart(2,'0')+':'+String(n.getSeconds()).padStart(2,'0');
},1000);

init();
</script>
</body>
</html>
