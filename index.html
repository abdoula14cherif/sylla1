<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SYLLA – Plateforme d'Investissement</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --gold:       #C9A84C;
      --gold-light: #E8C97A;
      --gold-dark:  #9A7A2E;
      --deep:       #0D1117;
      --surface:    #141B24;
      --card:       #1C2732;
      --border:     rgba(201,168,76,0.18);
      --text:       #F0EBE1;
      --muted:      #8A9BAE;
      --success:    #3ECF8E;
      --error:      #E85D5D;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--deep);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ─── Background ─── */
    .bg-orbs {
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
    }
    .orb {
      position: absolute; border-radius: 50%;
      filter: blur(90px); opacity: 0.18;
      animation: drift 12s ease-in-out infinite alternate;
    }
    .orb-1 { width: 520px; height: 520px; background: radial-gradient(circle, #C9A84C, transparent); top: -120px; left: -100px; animation-delay: 0s; }
    .orb-2 { width: 400px; height: 400px; background: radial-gradient(circle, #1A6B8A, transparent); bottom: -80px; right: -60px; animation-delay: -5s; }
    .orb-3 { width: 300px; height: 300px; background: radial-gradient(circle, #4A2C8A, transparent); top: 50%; left: 60%; animation-delay: -3s; }
    @keyframes drift { from { transform: translate(0,0) scale(1); } to { transform: translate(30px, 20px) scale(1.08); } }

    /* ─── Grid overlay ─── */
    .grid-overlay {
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background-image:
        linear-gradient(rgba(201,168,76,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(201,168,76,0.04) 1px, transparent 1px);
      background-size: 60px 60px;
    }

    /* ─── Layout ─── */
    .page {
      position: relative; z-index: 1;
      display: grid;
      grid-template-columns: 1fr 1fr;
      min-height: 100vh;
    }

    /* ─── Left Hero ─── */
    .hero {
      display: flex; flex-direction: column; justify-content: center;
      padding: 60px 56px;
    }
    .logo {
      display: flex; align-items: center; gap: 14px; margin-bottom: 64px;
    }
    .logo-mark {
      width: 48px; height: 48px; border-radius: 14px;
      background: linear-gradient(135deg, var(--gold), var(--gold-dark));
      display: flex; align-items: center; justify-content: center;
      font-family: 'Cormorant Garamond', serif;
      font-size: 26px; font-weight: 700; color: var(--deep);
      box-shadow: 0 0 24px rgba(201,168,76,0.35);
    }
    .logo-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 28px; font-weight: 600; letter-spacing: 3px;
      background: linear-gradient(90deg, var(--gold-light), var(--gold));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    .hero-tag {
      display: inline-flex; align-items: center; gap: 8px;
      background: rgba(201,168,76,0.1); border: 1px solid var(--border);
      border-radius: 100px; padding: 6px 16px;
      font-size: 12px; font-weight: 500; color: var(--gold);
      letter-spacing: 1.5px; text-transform: uppercase;
      margin-bottom: 28px; width: fit-content;
    }
    .hero-tag::before { content: ''; width: 6px; height: 6px; border-radius: 50%; background: var(--gold); animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(1.4)} }

    .hero-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(36px, 4vw, 56px);
      font-weight: 300; line-height: 1.15;
      margin-bottom: 24px;
    }
    .hero-title em {
      font-style: italic;
      background: linear-gradient(135deg, var(--gold-light), var(--gold));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    .hero-sub {
      font-size: 15px; color: var(--muted); line-height: 1.7; max-width: 420px; margin-bottom: 48px;
    }

    .stats {
      display: grid; grid-template-columns: repeat(3,1fr); gap: 24px;
    }
    .stat-card {
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border);
      border-radius: 16px; padding: 20px;
      backdrop-filter: blur(10px);
    }
    .stat-val {
      font-family: 'Cormorant Garamond', serif;
      font-size: 28px; font-weight: 600; color: var(--gold);
    }
    .stat-lbl { font-size: 12px; color: var(--muted); margin-top: 4px; }

    /* ─── Right Form Panel ─── */
    .panel {
      display: flex; align-items: center; justify-content: center;
      padding: 40px 48px;
      border-left: 1px solid var(--border);
      background: linear-gradient(160deg, rgba(28,39,50,0.8), rgba(13,17,23,0.9));
      backdrop-filter: blur(20px);
    }

    .form-box { width: 100%; max-width: 420px; }

    .form-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 32px; font-weight: 600; margin-bottom: 6px;
    }
    .form-sub { font-size: 14px; color: var(--muted); margin-bottom: 36px; }

    .tabs {
      display: flex; background: var(--surface);
      border-radius: 14px; padding: 4px; margin-bottom: 28px;
      border: 1px solid var(--border);
    }
    .tab-btn {
      flex: 1; padding: 10px; border: none; background: transparent;
      color: var(--muted); font-family: 'DM Sans', sans-serif;
      font-size: 14px; font-weight: 500; cursor: pointer;
      border-radius: 10px; transition: all .3s;
    }
    .tab-btn.active {
      background: linear-gradient(135deg, var(--gold), var(--gold-dark));
      color: var(--deep); font-weight: 600;
      box-shadow: 0 4px 14px rgba(201,168,76,0.3);
    }

    .form-group { margin-bottom: 18px; }
    .form-label {
      display: block; font-size: 13px; font-weight: 500;
      color: var(--muted); margin-bottom: 8px; letter-spacing: .4px;
    }

    .input-wrap { position: relative; }
    .input-icon {
      position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
      color: var(--muted); pointer-events: none;
    }
    .form-input {
      width: 100%; padding: 13px 14px 13px 42px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px;
      outline: none; transition: border-color .25s, box-shadow .25s;
    }
    .form-input:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(201,168,76,0.12);
    }
    .form-input::placeholder { color: var(--muted); opacity: .6; }

    .refcode-wrap { display: flex; gap: 10px; }
    .refcode-wrap .form-input { flex: 1; }
    .check-btn {
      padding: 13px 16px; background: var(--card);
      border: 1px solid var(--border); border-radius: 12px;
      color: var(--gold); font-size: 12px; font-weight: 600;
      cursor: pointer; white-space: nowrap; transition: background .2s;
      font-family: 'DM Sans', sans-serif;
    }
    .check-btn:hover { background: rgba(201,168,76,0.1); }

    .ref-badge {
      display: none; align-items: center; gap: 8px;
      background: rgba(62,207,142,0.1); border: 1px solid rgba(62,207,142,0.25);
      border-radius: 10px; padding: 10px 14px; margin-top: 8px;
      font-size: 13px; color: var(--success);
    }
    .ref-badge.show { display: flex; }

    .terms-row {
      display: flex; align-items: flex-start; gap: 10px; margin-bottom: 22px;
    }
    .custom-check {
      width: 18px; height: 18px; min-width: 18px;
      border: 1.5px solid var(--border); border-radius: 5px;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      background: var(--surface); transition: border-color .2s;
    }
    .custom-check.checked { border-color: var(--gold); background: rgba(201,168,76,0.15); }
    .custom-check svg { display: none; }
    .custom-check.checked svg { display: block; }
    .terms-text { font-size: 12px; color: var(--muted); line-height: 1.6; }
    .terms-text a { color: var(--gold); text-decoration: none; }

    .submit-btn {
      width: 100%; padding: 15px;
      background: linear-gradient(135deg, var(--gold), var(--gold-dark));
      border: none; border-radius: 14px;
      color: var(--deep); font-family: 'DM Sans', sans-serif;
      font-size: 15px; font-weight: 700; letter-spacing: .4px;
      cursor: pointer; transition: all .3s;
      box-shadow: 0 6px 24px rgba(201,168,76,0.3);
      position: relative; overflow: hidden;
    }
    .submit-btn:hover { transform: translateY(-1px); box-shadow: 0 10px 32px rgba(201,168,76,0.4); }
    .submit-btn:active { transform: translateY(0); }
    .submit-btn:disabled { opacity: .6; cursor: not-allowed; transform: none; }
    .btn-shine {
      position: absolute; top: 0; left: -100%; width: 60%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: shine 3s infinite;
    }
    @keyframes shine { 0%{left:-100%} 60%,100%{left:150%} }

    .divider {
      display: flex; align-items: center; gap: 12px; margin: 20px 0;
      font-size: 12px; color: var(--muted);
    }
    .divider::before, .divider::after {
      content: ''; flex: 1; height: 1px; background: var(--border);
    }

    .social-login { display: flex; gap: 10px; }
    .social-btn {
      flex: 1; padding: 11px; background: var(--surface);
      border: 1px solid var(--border); border-radius: 12px;
      color: var(--text); font-family: 'DM Sans', sans-serif;
      font-size: 13px; cursor: pointer; display: flex; align-items: center;
      justify-content: center; gap: 8px; transition: border-color .2s, background .2s;
    }
    .social-btn:hover { border-color: var(--gold); background: rgba(201,168,76,0.05); }

    /* Toast */
    .toast {
      position: fixed; bottom: 30px; right: 30px; z-index: 9999;
      padding: 14px 22px; border-radius: 14px; font-size: 14px; font-weight: 500;
      backdrop-filter: blur(20px); transform: translateY(80px); opacity: 0;
      transition: all .35s cubic-bezier(.34,1.56,.64,1);
      display: flex; align-items: center; gap: 10px;
    }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.success { background: rgba(62,207,142,0.15); border: 1px solid rgba(62,207,142,0.35); color: var(--success); }
    .toast.error   { background: rgba(232,93,93,0.15);  border: 1px solid rgba(232,93,93,0.35);  color: var(--error); }

    /* Loader */
    .spinner {
      width: 18px; height: 18px; border: 2px solid var(--deep);
      border-top-color: transparent; border-radius: 50%;
      animation: spin .7s linear infinite; display: inline-block;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Responsive */
    @media (max-width: 900px) {
      .page { grid-template-columns: 1fr; }
      .hero { display: none; }
      .panel { border-left: none; min-height: 100vh; }
    }

    /* Password toggle */
    .eye-btn {
      position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
      background: none; border: none; color: var(--muted); cursor: pointer; padding: 0;
    }

    /* Hidden form sections */
    .form-section { display: none; }
    .form-section.active { display: block; }
  </style>
</head>
<body>

<div class="bg-orbs">
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="orb orb-3"></div>
</div>
<div class="grid-overlay"></div>

<div class="page">
  <!-- ── Hero Left ── -->
  <div class="hero">
    <div class="logo">
      <div class="logo-mark">S</div>
      <div class="logo-name">SYLLA</div>
    </div>

    <div class="hero-tag">
      <span></span> Plateforme certifiée
    </div>

    <h1 class="hero-title">
      Investissez dans<br/>
      votre <em>avenir</em><br/>
      avec confiance
    </h1>

    <p class="hero-sub">
      SYLLA vous offre un accès exclusif aux meilleures opportunités d'investissement. 
      Faites fructifier votre capital avec des rendements compétitifs et une gestion transparente.
    </p>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-val">12%</div>
        <div class="stat-lbl">Rendement annuel</div>
      </div>
      <div class="stat-card">
        <div class="stat-val">8K+</div>
        <div class="stat-lbl">Investisseurs</div>
      </div>
      <div class="stat-card">
        <div class="stat-val">99.9%</div>
        <div class="stat-lbl">Fiabilité</div>
      </div>
    </div>
  </div>

  <!-- ── Right Panel ── -->
  <div class="panel">
    <div class="form-box">
      <h2 class="form-title">Bienvenue</h2>
      <p class="form-sub">Rejoignez SYLLA et commencez à investir dès aujourd'hui</p>

      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('signup')">Inscription</button>
        <button class="tab-btn" onclick="switchTab('login')">Connexion</button>
      </div>

      <!-- ── SIGN UP ── -->
      <div id="signup" class="form-section active">
        <div class="form-group">
          <label class="form-label">Prénom & Nom</label>
          <div class="input-wrap">
            <span class="input-icon">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            </span>
            <input id="su-name" class="form-input" type="text" placeholder="Jean Dupont"/>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Adresse e-mail</label>
          <div class="input-wrap">
            <span class="input-icon">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
            </span>
            <input id="su-email" class="form-input" type="email" placeholder="jean@exemple.com"/>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Numéro de téléphone</label>
          <div class="input-wrap">
            <span class="input-icon">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.11 12a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 3 1.18h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.09 8.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 21 16l.92.92z"/></svg>
            </span>
            <input id="su-phone" class="form-input" type="tel" placeholder="+224 620 000 000"/>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Mot de passe</label>
          <div class="input-wrap">
            <span class="input-icon">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            </span>
            <input id="su-pass" class="form-input" type="password" placeholder="Minimum 8 caractères" style="padding-right:44px"/>
            <button class="eye-btn" onclick="togglePass('su-pass',this)" type="button">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>
        </div>

        <!-- Parrainage -->
        <div class="form-group">
          <label class="form-label">Code de parrainage <span style="color:var(--muted);font-weight:300">(optionnel)</span></label>
          <div class="refcode-wrap">
            <div class="input-wrap" style="flex:1">
              <span class="input-icon">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
              </span>
              <input id="su-ref" class="form-input" type="text" placeholder="EX: SYL-XXXXX" style="text-transform:uppercase"/>
            </div>
            <button class="check-btn" onclick="verifyRefCode()">Vérifier</button>
          </div>
          <div id="ref-badge" class="ref-badge">
            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
            <span id="ref-badge-text">Code validé</span>
          </div>
        </div>

        <div class="terms-row">
          <div class="custom-check" id="terms-check" onclick="toggleCheck()">
            <svg width="10" height="10" fill="none" stroke="#C9A84C" stroke-width="3" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <p class="terms-text">J'accepte les <a href="#">conditions d'utilisation</a> et la <a href="#">politique de confidentialité</a> de SYLLA</p>
        </div>

        <button class="submit-btn" id="signup-btn" onclick="handleSignup()">
          <span class="btn-shine"></span>
          <span id="signup-label">Créer mon compte</span>
        </button>

        <div class="divider">ou continuer avec</div>
        <div class="social-login">
          <button class="social-btn">
            <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
            Google
          </button>
          <button class="social-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="#1877F2"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
            Facebook
          </button>
        </div>
      </div>

      <!-- ── LOGIN ── -->
      <div id="login" class="form-section">
        <div class="form-group">
          <label class="form-label">Adresse e-mail</label>
          <div class="input-wrap">
            <span class="input-icon">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
            </span>
            <input id="li-email" class="form-input" type="email" placeholder="jean@exemple.com"/>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Mot de passe</label>
          <div class="input-wrap">
            <span class="input-icon">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            </span>
            <input id="li-pass" class="form-input" type="password" placeholder="••••••••" style="padding-right:44px"/>
            <button class="eye-btn" onclick="togglePass('li-pass',this)" type="button">
              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>
        </div>

        <div style="text-align:right; margin-bottom:22px">
          <a href="#" style="font-size:13px; color:var(--gold); text-decoration:none">Mot de passe oublié ?</a>
        </div>

        <button class="submit-btn" id="login-btn" onclick="handleLogin()">
          <span class="btn-shine"></span>
          <span id="login-label">Se connecter</span>
        </button>

        <div class="divider">ou continuer avec</div>
        <div class="social-login">
          <button class="social-btn">
            <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
            Google
          </button>
          <button class="social-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="#1877F2"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
            Facebook
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast">
  <span id="toast-icon"></span>
  <span id="toast-msg"></span>
</div>

<script>
  // ── Supabase init ──
  const { createClient } = supabase;
  const sb = createClient(
    'https://fqiotqrraobmsrcyewsi.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZxaW90cXJyYW9ibXNyY3lld3NpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MjA3NzUsImV4cCI6MjA4NzM5Njc3NX0.pmvaQikEDEj705o7kBBWwkLwAoZ62D-GoxjFm5HEHNc'
  );

  // ── Tab switch ──
  function switchTab(tab) {
    document.querySelectorAll('.tab-btn').forEach((b,i) => {
      b.classList.toggle('active', (i===0 && tab==='signup') || (i===1 && tab==='login'));
    });
    document.getElementById('signup').classList.toggle('active', tab==='signup');
    document.getElementById('login').classList.toggle('active', tab==='login');
  }

  // ── Toggle password visibility ──
  function togglePass(id, btn) {
    const inp = document.getElementById(id);
    const show = inp.type === 'password';
    inp.type = show ? 'text' : 'password';
    btn.innerHTML = show
      ? `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-10-7-10-7a18.45 18.45 0 0 1 2.06-3.06M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 10 7 10 7a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>`
      : `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"/><circle cx="12" cy="12" r="3"/></svg>`;
  }

  // ── Checkbox ──
  let termsChecked = false;
  function toggleCheck() {
    termsChecked = !termsChecked;
    document.getElementById('terms-check').classList.toggle('checked', termsChecked);
  }

  // ── Toast ──
  function showToast(msg, type='success') {
    const t = document.getElementById('toast');
    const icon = type === 'success'
      ? `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>`
      : `<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`;
    document.getElementById('toast-icon').innerHTML = icon;
    document.getElementById('toast-msg').textContent = msg;
    t.className = `toast ${type} show`;
    setTimeout(() => t.classList.remove('show'), 4000);
  }

  // ── Verify referral code ──
  async function verifyRefCode() {
    const code = document.getElementById('su-ref').value.trim().toUpperCase();
    if (!code) { showToast('Veuillez saisir un code de parrainage', 'error'); return; }
    try {
      const { data, error } = await sb
        .from('profiles')
        .select('full_name, referral_code')
        .eq('referral_code', code)
        .single();
      const badge = document.getElementById('ref-badge');
      if (data) {
        document.getElementById('ref-badge-text').textContent =
          `Parrainé par : ${data.full_name || 'Membre SYLLA'} ✓`;
        badge.classList.add('show');
        showToast('Code de parrainage validé !', 'success');
      } else {
        badge.classList.remove('show');
        showToast('Code de parrainage invalide', 'error');
      }
    } catch(e) {
      showToast('Erreur de vérification', 'error');
    }
  }

  // ── Sign Up ──
  async function handleSignup() {
    if (!termsChecked) { showToast('Veuillez accepter les conditions', 'error'); return; }
    const name  = document.getElementById('su-name').value.trim();
    const email = document.getElementById('su-email').value.trim();
    const phone = document.getElementById('su-phone').value.trim();
    const pass  = document.getElementById('su-pass').value;
    const ref   = document.getElementById('su-ref').value.trim().toUpperCase();

    if (!name || !email || !pass) { showToast('Veuillez remplir tous les champs obligatoires', 'error'); return; }
    if (pass.length < 8) { showToast('Le mot de passe doit contenir au moins 8 caractères', 'error'); return; }

    const btn = document.getElementById('signup-btn');
    btn.disabled = true;
    document.getElementById('signup-label').innerHTML = '<span class="spinner"></span>';

    try {
      // Generate referral code for new user
      const newRefCode = 'SYL-' + Math.random().toString(36).substring(2,8).toUpperCase();

      const { data, error } = await sb.auth.signUp({
        email, password: pass,
        options: {
          data: { full_name: name, phone, referral_code: newRefCode, referred_by: ref || null }
        }
      });

      if (error) throw error;

      // Also insert into profiles table
      if (data.user) {
        await sb.from('profiles').upsert({
          id: data.user.id,
          full_name: name,
          email,
          phone,
          referral_code: newRefCode,
          referred_by: ref || null,
          created_at: new Date().toISOString()
        });
      }

      showToast('Compte créé ! Vérifiez votre email pour confirmer.', 'success');
      setTimeout(() => switchTab('login'), 2500);
    } catch(e) {
      showToast(e.message || 'Erreur lors de l\'inscription', 'error');
    } finally {
      btn.disabled = false;
      document.getElementById('signup-label').textContent = 'Créer mon compte';
    }
  }

  // ── Login ──
  async function handleLogin() {
    const email = document.getElementById('li-email').value.trim();
    const pass  = document.getElementById('li-pass').value;
    if (!email || !pass) { showToast('Veuillez remplir tous les champs', 'error'); return; }

    const btn = document.getElementById('login-btn');
    btn.disabled = true;
    document.getElementById('login-label').innerHTML = '<span class="spinner"></span>';

    try {
      const { data, error } = await sb.auth.signInWithPassword({ email, password: pass });
      if (error) throw error;
      showToast('Connexion réussie ! Redirection...', 'success');
      setTimeout(() => { window.location.href = 'dashboard.html'; }, 1500);
    } catch(e) {
      showToast(e.message || 'Identifiants incorrects', 'error');
    } finally {
      btn.disabled = false;
      document.getElementById('login-label').textContent = 'Se connecter';
    }
  }

  // Auto-uppercase referral code
  document.getElementById('su-ref').addEventListener('input', function() {
    this.value = this.value.toUpperCase();
  });

  // Check if already logged in
  sb.auth.getSession().then(({ data }) => {
    if (data.session) window.location.href = 'dashboard.html';
  });
</script>
</body>
</html>

