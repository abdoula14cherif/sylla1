<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>SYLLA â€” Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@300;400;500;600;700&family=Outfit:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --teal:      #00C9C0;
  --teal-l:    #00EDDE;
  --teal-d:    #008E89;
  --orange:    #FF7A35;
  --amber:     #FFB830;
  --red:       #FF3B4E;
  --gold:      #F5C842;
  --bg:        #07100F;
  --bg2:       #0B1918;
  --bg3:       #0F2220;
  --card:      rgba(255,255,255,0.04);
  --card-b:    rgba(0,201,192,0.18);
  --text:      #E8FFFD;
  --text2:     #7EC8C4;
  --text3:     #3D7A77;
  --nav-h:     70px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{scroll-behavior:smooth;}
body{
  font-family:'Outfit',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
  padding-bottom:var(--nav-h);
}

/* â•â•â•â•â•â•â•â•â•â• BG â•â•â•â•â•â•â•â•â•â• */
.bg-mesh{
  position:fixed;inset:0;z-index:0;pointer-events:none;
  background:
    radial-gradient(ellipse 60% 50% at 80% 10%, rgba(0,237,222,.12) 0%,transparent 60%),
    radial-gradient(ellipse 50% 60% at 10% 80%, rgba(255,122,53,.08) 0%,transparent 55%),
    radial-gradient(ellipse 80% 80% at 50% 50%, rgba(0,201,192,.04) 0%,transparent 80%),
    linear-gradient(160deg,#07100F 0%,#0C1E1C 50%,#0A1715 100%);
}
.bg-grid{
  position:fixed;inset:0;z-index:0;pointer-events:none;
  background-image:
    linear-gradient(rgba(0,201,192,.04) 1px,transparent 1px),
    linear-gradient(90deg,rgba(0,201,192,.04) 1px,transparent 1px);
  background-size:50px 50px;
}

/* â•â•â•â•â•â•â•â•â•â• SKY / PLANES LAYER â•â•â•â•â•â•â•â•â•â• */
.sky-layer{
  position:fixed;top:0;left:0;right:0;
  height:220px;z-index:1;pointer-events:none;
  overflow:hidden;
}
.plane{
  position:absolute;
  font-size:22px;
  opacity:0;
  animation:flyPlane linear infinite;
  filter:drop-shadow(0 0 8px rgba(0,237,222,.6));
  white-space:nowrap;
}
.plane-trail{
  position:absolute;
  height:1.5px;
  background:linear-gradient(90deg,rgba(0,237,222,0),rgba(0,237,222,.5),rgba(255,184,48,.3),transparent);
  border-radius:2px;
  animation:flyTrail linear infinite;
  opacity:0;
}
@keyframes flyPlane{
  0%  {transform:translateX(-120px);opacity:0;}
  5%  {opacity:.9;}
  90% {opacity:.7;}
  100%{transform:translateX(calc(100vw + 140px));opacity:0;}
}
@keyframes flyTrail{
  0%  {transform:translateX(-200px);opacity:0;width:0;}
  5%  {opacity:.7;width:60px;}
  90% {opacity:.5;width:80px;}
  100%{transform:translateX(calc(100vw + 200px));opacity:0;}
}

/* â•â•â•â•â•â•â•â•â•â• SCROLLABLE CONTENT â•â•â•â•â•â•â•â•â•â• */
.page{position:relative;z-index:2;padding:0 16px 24px;}

/* â•â•â•â•â•â•â•â•â•â• HEADER CARD â•â•â•â•â•â•â•â•â•â• */
.header-card{
  margin:0 -16px;
  padding:52px 24px 30px;
  background:linear-gradient(160deg,rgba(0,201,192,.14) 0%,rgba(0,201,192,.05) 50%,transparent 100%);
  border-bottom:1px solid rgba(0,201,192,.12);
  position:relative;overflow:hidden;
}
.header-card::before{
  content:'';position:absolute;top:-60px;right:-60px;
  width:220px;height:220px;border-radius:50%;
  border:1px solid rgba(0,201,192,.1);
  animation:spin 20s linear infinite;
}
.header-card::after{
  content:'';position:absolute;top:-30px;right:-30px;
  width:140px;height:140px;border-radius:50%;
  border:1px solid rgba(255,122,53,.08);
  animation:spin 14s linear infinite reverse;
}

.top-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}

.user-info{display:flex;align-items:center;gap:12px;}
.avatar{
  width:46px;height:46px;border-radius:50%;
  background:linear-gradient(135deg,var(--teal-d),var(--teal));
  display:flex;align-items:center;justify-content:center;
  font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:1px;color:#fff;
  box-shadow:0 0 0 2px rgba(0,201,192,.3),0 0 20px rgba(0,201,192,.2);
  flex-shrink:0;
}
.user-greet{
  font-size:12px;font-weight:300;color:var(--text2);letter-spacing:.5px;
}
.user-name{
  font-family:'Rajdhani',sans-serif;
  font-size:18px;font-weight:700;letter-spacing:1.5px;
  color:var(--text);margin-top:1px;
}

.top-right{text-align:right;}
.clock{
  font-family:'Bebas Neue',cursive;
  font-size:26px;letter-spacing:3px;
  background:linear-gradient(135deg,var(--teal),var(--teal-l));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  line-height:1;
}
.date-txt{font-size:11px;font-weight:300;color:var(--text3);letter-spacing:.5px;margin-top:2px;}

/* Balance */
.balance-section{margin-top:4px;}
.bal-label{
  font-family:'Rajdhani',sans-serif;
  font-size:10px;font-weight:600;letter-spacing:3px;
  text-transform:uppercase;color:var(--text3);
  margin-bottom:6px;
}
.bal-amount{
  font-family:'Bebas Neue',cursive;
  font-size:52px;letter-spacing:3px;line-height:1;
  background:linear-gradient(135deg,#fff 0%,var(--teal-l) 50%,var(--teal) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  filter:drop-shadow(0 4px 20px rgba(0,201,192,.3));
}
.bal-currency{
  font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:500;
  color:var(--teal);margin-left:4px;vertical-align:bottom;
}
.bal-sub{
  display:flex;align-items:center;gap:16px;margin-top:10px;
}
.bal-sub-item{
  display:flex;align-items:center;gap:6px;
  font-size:12px;font-weight:300;color:var(--text2);
}
.bal-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
.d-teal{background:var(--teal);}
.d-orange{background:var(--orange);}
.d-gold{background:var(--gold);}

.bonus-badge{
  display:inline-flex;align-items:center;gap:8px;
  background:linear-gradient(135deg,rgba(245,200,66,.15),rgba(255,184,48,.08));
  border:1px solid rgba(245,200,66,.3);
  border-radius:100px;padding:7px 16px;
  font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;
  letter-spacing:2px;text-transform:uppercase;color:var(--gold);
  margin-top:14px;
  box-shadow:0 4px 20px rgba(245,200,66,.1);
  animation:glow 2.5s ease-in-out infinite;
}
@keyframes glow{
  0%,100%{box-shadow:0 4px 20px rgba(245,200,66,.1);}
  50%{box-shadow:0 4px 30px rgba(245,200,66,.25);}
}
.bonus-ico{font-size:14px;}

/* â•â•â•â•â•â•â•â•â•â• SECTION TITLES â•â•â•â•â•â•â•â•â•â• */
.sec-title{
  font-family:'Rajdhani',sans-serif;
  font-size:11px;font-weight:700;letter-spacing:3px;
  text-transform:uppercase;color:var(--text3);
  margin:24px 0 12px;
  display:flex;align-items:center;gap:10px;
}
.sec-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(0,201,192,.2),transparent);}

/* â•â•â•â•â•â•â•â•â•â• QUICK ACTIONS GRID â•â•â•â•â•â•â•â•â•â• */
.grid-actions{
  display:grid;grid-template-columns:repeat(3,1fr);
  gap:10px;
}

.act-btn{
  background:var(--card);
  border:1.5px solid var(--card-b);
  border-radius:20px;
  padding:18px 10px 16px;
  display:flex;flex-direction:column;align-items:center;gap:8px;
  cursor:pointer;
  text-decoration:none;
  transition:all .25s ease;
  position:relative;overflow:hidden;
  -webkit-tap-highlight-color:transparent;
}
.act-btn::before{
  content:'';
  position:absolute;inset:0;
  background:linear-gradient(135deg,var(--c1,rgba(0,201,192,.1)),var(--c2,rgba(0,201,192,.03)));
  opacity:0;transition:opacity .25s;
}
.act-btn:hover::before,.act-btn:active::before{opacity:1;}
.act-btn:active{transform:scale(.96);}

.act-btn.teal   {--c1:rgba(0,201,192,.18);--c2:rgba(0,237,222,.06);}
.act-btn.orange {--c1:rgba(255,122,53,.18);--c2:rgba(255,184,48,.06);border-color:rgba(255,122,53,.25);}
.act-btn.gold   {--c1:rgba(245,200,66,.18);--c2:rgba(255,184,48,.06);border-color:rgba(245,200,66,.25);}
.act-btn.red    {--c1:rgba(255,59,78,.18);--c2:rgba(255,59,78,.06);border-color:rgba(255,59,78,.25);}
.act-btn.purple {--c1:rgba(160,100,255,.18);--c2:rgba(160,100,255,.06);border-color:rgba(160,100,255,.25);}
.act-btn.sky    {--c1:rgba(56,189,248,.18);--c2:rgba(56,189,248,.06);border-color:rgba(56,189,248,.25);}

.act-ico{
  width:44px;height:44px;border-radius:14px;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;
  position:relative;z-index:1;
}
.ico-teal   {background:linear-gradient(135deg,rgba(0,201,192,.25),rgba(0,237,222,.1));box-shadow:0 4px 16px rgba(0,201,192,.2);}
.ico-orange {background:linear-gradient(135deg,rgba(255,122,53,.25),rgba(255,184,48,.1));box-shadow:0 4px 16px rgba(255,122,53,.2);}
.ico-gold   {background:linear-gradient(135deg,rgba(245,200,66,.25),rgba(255,184,48,.1));box-shadow:0 4px 16px rgba(245,200,66,.2);}
.ico-red    {background:linear-gradient(135deg,rgba(255,59,78,.25),rgba(255,100,100,.1));box-shadow:0 4px 16px rgba(255,59,78,.2);}
.ico-purple {background:linear-gradient(135deg,rgba(160,100,255,.25),rgba(160,100,255,.1));box-shadow:0 4px 16px rgba(160,100,255,.2);}
.ico-sky    {background:linear-gradient(135deg,rgba(56,189,248,.25),rgba(56,189,248,.1));box-shadow:0 4px 16px rgba(56,189,248,.2);}

.act-label{
  font-family:'Rajdhani',sans-serif;
  font-size:12px;font-weight:700;letter-spacing:1px;
  text-transform:uppercase;color:var(--text2);
  text-align:center;position:relative;z-index:1;
  line-height:1.2;
}

/* â•â•â•â•â•â•â•â•â•â• HISTORY â•â•â•â•â•â•â•â•â•â• */
.history-list{display:flex;flex-direction:column;gap:8px;}

.hist-item{
  background:var(--card);
  border:1px solid rgba(0,201,192,.1);
  border-radius:14px;
  padding:14px 16px;
  display:flex;align-items:center;gap:12px;
  transition:all .2s;
}
.hist-item:active{transform:scale(.99);}

.hist-ico-wrap{
  width:40px;height:40px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  font-size:18px;flex-shrink:0;
}
.hist-info{flex:1;min-width:0;}
.hist-type{
  font-family:'Rajdhani',sans-serif;
  font-size:13px;font-weight:700;letter-spacing:.5px;
  color:var(--text);
}
.hist-date{
  font-size:11px;font-weight:300;color:var(--text3);margin-top:2px;
}
.hist-amount{
  font-family:'Bebas Neue',cursive;
  font-size:20px;letter-spacing:1px;
  text-align:right;flex-shrink:0;
}
.h-green{color:#4ADE80;}
.h-orange{color:var(--orange);}
.h-gold{color:var(--gold);}
.h-red{color:var(--red);}
.h-teal{color:var(--teal);}

.hist-status{
  font-size:10px;font-weight:600;letter-spacing:1px;
  text-transform:uppercase;margin-top:2px;text-align:right;
}
.st-ok{color:rgba(74,222,128,.7);}
.st-pend{color:rgba(255,184,48,.7);}

.empty-hist{
  text-align:center;padding:36px 20px;
  color:var(--text3);font-size:14px;font-weight:300;
}
.empty-hist .e-ico{font-size:36px;margin-bottom:10px;}

/* â•â•â•â•â•â•â•â•â•â• BOTTOM NAV â•â•â•â•â•â•â•â•â•â• */
.bot-nav{
  position:fixed;bottom:0;left:0;right:0;z-index:100;
  height:var(--nav-h);
  background:rgba(7,16,15,.92);
  backdrop-filter:blur(24px);
  border-top:1px solid rgba(0,201,192,.15);
  display:grid;grid-template-columns:repeat(4,1fr);
  box-shadow:0 -8px 32px rgba(0,0,0,.4);
}
.nav-item{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:4px;cursor:pointer;text-decoration:none;
  transition:all .2s;padding:8px 4px;
  position:relative;
}
.nav-item::before{
  content:'';position:absolute;top:0;left:20%;right:20%;height:2px;
  border-radius:0 0 4px 4px;
  background:linear-gradient(90deg,var(--teal),var(--teal-l));
  transform:scaleX(0);transition:transform .3s;
}
.nav-item.active::before{transform:scaleX(1);}
.nav-item.active .nav-ico{color:var(--teal);}
.nav-item.active .nav-lbl{color:var(--teal);}
.nav-ico{font-size:20px;transition:color .2s;color:var(--text3);}
.nav-lbl{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);transition:color .2s;}

/* â•â•â•â•â•â•â•â•â•â• LOADING â•â•â•â•â•â•â•â•â•â• */
.loading-screen{
  position:fixed;inset:0;z-index:999;
  background:var(--bg);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:16px;
  transition:opacity .5s,visibility .5s;
}
.loading-screen.hide{opacity:0;visibility:hidden;}
.load-logo{
  font-family:'Bebas Neue',cursive;font-size:60px;letter-spacing:8px;
  background:linear-gradient(135deg,var(--teal),var(--orange));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  animation:pulse 1.5s ease-in-out infinite;
}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.5;}}
.load-bar{width:120px;height:2px;background:rgba(0,201,192,.15);border-radius:2px;overflow:hidden;}
.load-fill{height:100%;background:linear-gradient(90deg,var(--teal),var(--teal-l));border-radius:2px;animation:loadFill 1.5s ease-in-out infinite;}
@keyframes loadFill{0%{width:0%;margin-left:0;}50%{width:100%;margin-left:0;}100%{width:0%;margin-left:100%;}}

/* â•â•â•â•â•â•â•â•â•â• MISC â•â•â•â•â•â•â•â•â•â• */
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}

.page>*{animation:fadeUp .6s ease both;}
.header-card{animation-delay:.05s;}
.sec-title:nth-of-type(1){animation-delay:.15s;}
.grid-actions{animation-delay:.2s;}
.sec-title:nth-of-type(2){animation-delay:.3s;}
.history-list{animation-delay:.35s;}

/* scrollbar */
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:rgba(0,201,192,.3);border-radius:4px;}
</style>
</head>
<body>

<!-- Loading -->
<div class="loading-screen" id="loader">
  <div class="load-logo">SYLLA</div>
  <div class="load-bar"><div class="load-fill"></div></div>
</div>

<!-- BG -->
<div class="bg-mesh"></div>
<div class="bg-grid"></div>

<!-- Sky with animated planes -->
<div class="sky-layer" id="sky"></div>

<!-- PAGE -->
<div class="page">

  <!-- HEADER -->
  <div class="header-card">
    <div class="top-row">
      <div class="user-info">
        <div class="avatar" id="avatar">S</div>
        <div>
          <div class="user-greet" id="greet">Bon retour ğŸ‘‹</div>
          <div class="user-name" id="uname">Chargementâ€¦</div>
        </div>
      </div>
      <div class="top-right">
        <div class="clock" id="clock">00:00:00</div>
        <div class="date-txt" id="dateTxt">â€”</div>
      </div>
    </div>

    <div class="balance-section">
      <div class="bal-label">Solde total du compte</div>
      <div>
        <span class="bal-amount" id="bal-total">0</span>
        <span class="bal-currency">FCFA</span>
      </div>
      <div class="bal-sub">
        <div class="bal-sub-item"><div class="bal-dot d-teal"></div><span id="bal-invest">Investi : 0 FCFA</span></div>
        <div class="bal-sub-item"><div class="bal-dot d-gold"></div><span id="bal-bonus">Bonus : 1 000 FCFA</span></div>
      </div>
      <div class="bonus-badge">
        <span class="bonus-ico">ğŸ</span>
        Bonus de bienvenue : +1 000 FCFA
      </div>
    </div>
  </div>

  <!-- QUICK ACTIONS -->
  <div class="sec-title">AccÃ¨s rapide</div>
  <div class="grid-actions">
    <a href="recharge.html" class="act-btn green" style="--c1:rgba(0,209,102,.18);--c2:rgba(0,209,102,.06);border-color:rgba(0,209,102,.3)">
      <span class="ab-ico">ğŸ’³</span>
      <span class="ab-lbl">Recharge</span>
    </a>
    <a href="long-terme.html" class="act-btn teal">
      <div class="act-ico ico-teal">ğŸ“ˆ</div>
      <div class="act-label">Long<br>Terme</div>
    </a>
    <a href="court-terme.html" class="act-btn sky">
      <div class="act-ico ico-sky">âš¡</div>
      <div class="act-label">Court<br>Terme</div>
    </a>
    <a href="cofre.html" class="act-btn gold">
      <div class="act-ico ico-gold">ğŸ¦</div>
      <div class="act-label">Coffre</div>
    </a>
    <a href="retrait.html" class="act-btn orange">
      <div class="act-ico ico-orange">ğŸ’¸</div>
      <div class="act-label">Retrait</div>
    </a>
    <a href="profil.html" class="act-btn purple">
      <div class="act-ico ico-purple">ğŸ‘¤</div>
      <div class="act-label">Profil</div>
    </a>
    <a href="plan.html" class="act-btn red">
      <div class="act-ico ico-red">ğŸš€</div>
      <div class="act-label">Plans</div>
    </a>
    <a href="parrainage.html" class="act-btn" style="--c1:rgba(245,200,66,.18);--c2:rgba(255,122,53,.06);border-color:rgba(245,200,66,.3)">
      <div style="font-size:22px;margin-bottom:5px">ğŸ</div>
      <div class="act-label" style="color:#F5C842">Parrainage</div>
    </a>
  </div>

  <!-- HISTORY -->
  <div class="sec-title" style="margin-top:28px;">Historique des transactions</div>
  <div class="history-list" id="history-list">
    <div class="empty-hist"><div class="e-ico">ğŸ“‹</div>Chargement de l'historiqueâ€¦</div>
  </div>

  <div style="height:12px;"></div>
</div>

<!-- BOTTOM NAV -->
<nav class="bot-nav">
  <a href="dashboard.html" class="nav-item active">
    <span class="nav-ico">ğŸ </span>
    <span class="nav-lbl">Accueil</span>
  </a>
  <a href="plan.html" class="nav-item">
    <span class="nav-ico">ğŸš€</span>
    <span class="nav-lbl">Plans</span>
  </a>
  <a href="retrait.html" class="nav-item">
    <span class="nav-ico">ğŸ’¸</span>
    <span class="nav-lbl">Retrait</span>
  </a>
  <a href="profil.html" class="nav-item">
    <span class="nav-ico">ğŸ‘¤</span>
    <span class="nav-lbl">Profil</span>
  </a>
</nav>

<script>
/* â”€â”€ SUPABASE â”€â”€ */
const{createClient}=supabase;
const sb=createClient(
  'https://fqiotqrraobmsrcyewsi.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZxaW90cXJyYW9ibXNyY3lld3NpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MjA3NzUsImV4cCI6MjA4NzM5Njc3NX0.pmvaQikEDEj705o7kBBWwkLwAoZ62D-GoxjFm5HEHNc'
);

/* â”€â”€ AUTH CHECK â”€â”€ */
async function init(){
  const{data:{session}}=await sb.auth.getSession();
  if(!session){window.location.href='index.html';return;}
  await loadUser(session.user);
  await loadHistory(session.user.id);
  document.getElementById('loader').classList.add('hide');
  startClock();
  spawnPlanes();
}

/* â”€â”€ LOAD USER â”€â”€ */
async function loadUser(user){
  // Try profiles table first
  let name=user.user_metadata?.full_name||'';
  let phone=user.user_metadata?.phone||'';

  try{
    const{data}=await sb.from('profiles').select('*').eq('id',user.id).single();
    if(data){
      name=data.full_name||name;
      phone=data.phone||phone;
      // Ensure welcome bonus row exists
      await ensureBonus(user.id);
    }
  }catch(e){}

  const firstName=(name.split(' ')[0])||'Investisseur';
  const initial=firstName[0].toUpperCase();

  document.getElementById('uname').textContent=name||user.email;
  document.getElementById('avatar').textContent=initial;

  // Greeting based on hour
  const h=new Date().getHours();
  let greet='Bon retour ğŸ‘‹';
  if(h>=5&&h<12)greet='Bonjour â˜€ï¸';
  else if(h>=12&&h<17)greet='Bon aprÃ¨s-midi ğŸŒ¤';
  else if(h>=17&&h<21)greet='Bonsoir ğŸŒ†';
  else greet='Bonne nuit ğŸŒ™';
  document.getElementById('greet').textContent=greet+', '+firstName+' !';

  // Load balance
  await loadBalance(user.id);
}

/* â”€â”€ ENSURE BONUS â”€â”€ */
async function ensureBonus(uid){
  try{
    const{data:existing}=await sb.from('transactions')
      .select('id').eq('user_id',uid).eq('type','bonus_bienvenue').single();
    if(!existing){
      await sb.from('transactions').insert({
        user_id:uid,
        type:'bonus_bienvenue',
        label:'Bonus de bienvenue SYLLA',
        amount:1000,
        status:'credited',
        created_at:new Date().toISOString()
      });
    }
  }catch(e){
    // Table might not exist yet â€” graceful fail
  }
}

/* â”€â”€ LOAD BALANCE â”€â”€ */
async function loadBalance(uid){
  let total=1000; // default bonus
  let invested=0;
  try{
    const{data}=await sb.from('transactions').select('amount,type').eq('user_id',uid);
    if(data&&data.length){
      total=0;
      data.forEach(t=>{
        if(['bonus_bienvenue','depot','gain','referral'].includes(t.type)) total+=Number(t.amount);
        if(t.type==='retrait') total-=Number(t.amount);
        if(t.type==='investissement') invested+=Number(t.amount);
      });
    }
  }catch(e){}
  animCount('bal-total',total);
  document.getElementById('bal-invest').textContent=`Investi : ${fmt(invested)} FCFA`;
}

/* â”€â”€ LOAD HISTORY â”€â”€ */
async function loadHistory(uid){
  const list=document.getElementById('history-list');
  const typeMap={
    bonus_bienvenue:{ico:'ğŸ',label:'Bonus de bienvenue',cls:'h-gold',bg:'background:rgba(245,200,66,.12);border-color:rgba(245,200,66,.2);'},
    depot:{ico:'ğŸ’°',label:'DÃ©pÃ´t',cls:'h-green',bg:'background:rgba(74,222,128,.08);border-color:rgba(74,222,128,.15);'},
    investissement:{ico:'ğŸ“ˆ',label:'Investissement',cls:'h-teal',bg:'background:rgba(0,201,192,.08);border-color:rgba(0,201,192,.15);'},
    gain:{ico:'âœ¨',label:'Gain / Rendement',cls:'h-green',bg:'background:rgba(74,222,128,.08);border-color:rgba(74,222,128,.15);'},
    retrait:{ico:'ğŸ’¸',label:'Retrait',cls:'h-orange',bg:'background:rgba(255,122,53,.08);border-color:rgba(255,122,53,.15);'},
    referral:{ico:'ğŸ‘¥',label:'Bonus parrainage',cls:'h-teal',bg:'background:rgba(0,201,192,.08);border-color:rgba(0,201,192,.15);'},
  };

  try{
    const{data,error}=await sb.from('transactions')
      .select('*').eq('user_id',uid)
      .order('created_at',{ascending:false});

    if(error||!data||!data.length){
      // Show simulated bonus only
      list.innerHTML=makeFakeBonus();
      return;
    }

    list.innerHTML=data.map(t=>{
      const m=typeMap[t.type]||{ico:'ğŸ’¼',label:t.type,cls:'h-teal',bg:''};
      const isNeg=t.type==='retrait';
      const sign=isNeg?'-':'+';
      const d=new Date(t.created_at);
      const dateStr=d.toLocaleDateString('fr-FR',{day:'2-digit',month:'short',year:'numeric',hour:'2-digit',minute:'2-digit'});
      const stCls=t.status==='pending'?'st-pend':'st-ok';
      const stTxt=t.status==='pending'?'En attente':'ComplÃ©tÃ©';
      return `
        <div class="hist-item" style="${m.bg}">
          <div class="hist-ico-wrap" style="background:rgba(0,0,0,.15)">${m.ico}</div>
          <div class="hist-info">
            <div class="hist-type">${t.label||m.label}</div>
            <div class="hist-date">${dateStr}</div>
          </div>
          <div>
            <div class="hist-amount ${m.cls}">${sign}${fmt(t.amount)} <span style="font-size:12px">F</span></div>
            <div class="hist-status ${stCls}">${stTxt}</div>
          </div>
        </div>`;
    }).join('');

  }catch(e){
    list.innerHTML=makeFakeBonus();
  }
}

function makeFakeBonus(){
  const now=new Date().toLocaleDateString('fr-FR',{day:'2-digit',month:'short',year:'numeric',hour:'2-digit',minute:'2-digit'});
  return `
    <div class="hist-item" style="background:rgba(245,200,66,.1);border-color:rgba(245,200,66,.2);">
      <div class="hist-ico-wrap" style="background:rgba(0,0,0,.15)">ğŸ</div>
      <div class="hist-info">
        <div class="hist-type">Bonus de bienvenue SYLLA</div>
        <div class="hist-date">${now}</div>
      </div>
      <div>
        <div class="hist-amount h-gold">+1 000 <span style="font-size:12px">F</span></div>
        <div class="hist-status st-ok">CrÃ©ditÃ©</div>
      </div>
    </div>`;
}

/* â”€â”€ CLOCK â”€â”€ */
function startClock(){
  const days=['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
  const months=['Jan','FÃ©v','Mar','Avr','Mai','Jun','Jul','AoÃ»','Sep','Oct','Nov','DÃ©c'];
  function tick(){
    const n=new Date();
    const h=String(n.getHours()).padStart(2,'0');
    const m=String(n.getMinutes()).padStart(2,'0');
    const s=String(n.getSeconds()).padStart(2,'0');
    document.getElementById('clock').textContent=`${h}:${m}:${s}`;
    document.getElementById('dateTxt').textContent=`${days[n.getDay()]} ${n.getDate()} ${months[n.getMonth()]} ${n.getFullYear()}`;
  }
  tick();setInterval(tick,1000);
}

/* â”€â”€ PLANES â”€â”€ */
function spawnPlanes(){
  const sky=document.getElementById('sky');
  const planes=['âœˆï¸','âœˆï¸','ğŸ›©ï¸','âœˆï¸'];
  const lanes=[25,60,100,140,180];

  planes.forEach((emoji,i)=>{
    // Trail
    const trail=document.createElement('div');
    trail.className='plane-trail';
    const dur=18+i*7;
    const delay=i*5;
    const topT=lanes[i%lanes.length]-4;
    trail.style.cssText=`top:${topT}px;animation-duration:${dur}s;animation-delay:-${delay}s;`;
    sky.appendChild(trail);

    // Plane
    const p=document.createElement('div');
    p.className='plane';
    p.textContent=emoji;
    const top=lanes[i%lanes.length];
    p.style.cssText=`top:${top}px;animation-duration:${dur}s;animation-delay:-${delay}s;`;
    sky.appendChild(p);
  });

  // Extra plane
  const extra=document.createElement('div');
  extra.className='plane';
  extra.textContent='ğŸ›©ï¸';
  extra.style.cssText=`top:${lanes[4]}px;animation-duration:28s;animation-delay:-12s;font-size:16px;opacity:.6;`;
  sky.appendChild(extra);
}

/* â”€â”€ HELPERS â”€â”€ */
function fmt(n){return Number(n).toLocaleString('fr-FR');}

function animCount(id,target){
  const el=document.getElementById(id);
  if(!el)return;
  let cur=0;const dur=1200;const start=performance.now();
  function step(now){
    const p=Math.min((now-start)/dur,1);
    const ease=1-Math.pow(1-p,3);
    cur=Math.round(ease*target);
    el.textContent=fmt(cur);
    if(p<1)requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

/* â”€â”€ START â”€â”€ */
init();
</script>
</body>
</html>
