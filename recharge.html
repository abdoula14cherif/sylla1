<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>SYLLA ‚Äî Recharge du compte</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@300;400;500;600;700&family=Outfit:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{
  --green:#00D166;--green-l:#4ADE80;--green-d:#009948;
  --teal:#00C9C0;--teal-l:#00EDDE;
  --orange:#FF7A35;--gold:#F5C842;--red:#FF3B4E;--amber:#FFB830;
  --purple:#A064FF;
  --bg:#060E0A;
  --text:#F0FFF5;--text2:#6BA885;--text3:#2E5A40;
  --nav-h:70px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;padding-bottom:calc(var(--nav-h)+24px);}
.bg-mesh{position:fixed;inset:0;z-index:0;pointer-events:none;background:radial-gradient(ellipse 60% 55% at 20% 10%,rgba(0,209,102,.12) 0%,transparent 60%),radial-gradient(ellipse 50% 60% at 85% 80%,rgba(0,201,192,.08) 0%,transparent 55%),linear-gradient(160deg,#060E0A 0%,#0A1A10 55%,#081209 100%);}
.bg-grid{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:linear-gradient(rgba(0,209,102,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(0,209,102,.04) 1px,transparent 1px);background-size:50px 50px;}

.loading-screen{position:fixed;inset:0;z-index:999;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;transition:opacity .5s,visibility .5s;}
.loading-screen.hide{opacity:0;visibility:hidden;pointer-events:none;}
.load-logo{font-family:'Bebas Neue',cursive;font-size:52px;letter-spacing:8px;background:linear-gradient(135deg,var(--green),var(--teal-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:pulse 1.5s ease-in-out infinite;}
.load-bar{width:120px;height:2px;background:rgba(0,209,102,.15);border-radius:2px;overflow:hidden;}
.load-fill{height:100%;background:linear-gradient(90deg,var(--green-d),var(--green));border-radius:2px;animation:lf 1.5s ease-in-out infinite;}
@keyframes lf{0%{width:0%;margin-left:0}50%{width:100%;margin-left:0}100%{width:0%;margin-left:100%}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
@keyframes bounceIn{0%{transform:scale(0);opacity:0}60%{transform:scale(1.15)}100%{transform:scale(1);opacity:1}}

.page{position:relative;z-index:2;padding:0 16px 20px;}

/* TOPBAR */
.topbar{display:flex;align-items:center;justify-content:space-between;padding:14px 16px 12px;position:sticky;top:0;z-index:50;background:rgba(6,14,10,.94);backdrop-filter:blur(20px);border-bottom:1px solid rgba(0,209,102,.1);margin:0 -16px 20px;}
.back-btn{font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--green);text-decoration:none;padding:8px 14px;border:1px solid rgba(0,209,102,.3);border-radius:20px;}
.page-title{font-family:'Bebas Neue',cursive;font-size:22px;letter-spacing:4px;background:linear-gradient(135deg,var(--green),var(--teal-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.bal-pill{font-family:'Bebas Neue',cursive;font-size:14px;letter-spacing:2px;color:var(--green);background:rgba(0,209,102,.08);border:1px solid rgba(0,209,102,.2);border-radius:20px;padding:7px 12px;}

/* HERO */
.hero-card{background:linear-gradient(135deg,rgba(0,209,102,.1),rgba(0,201,192,.05));border:1.5px solid rgba(0,209,102,.2);border-radius:22px;padding:22px 20px;margin-bottom:20px;text-align:center;animation:fadeUp .4s ease both;position:relative;overflow:hidden;}
.hero-card::before{content:'üí≥';position:absolute;right:-10px;top:-10px;font-size:90px;opacity:.06;}
.hc-label{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:rgba(0,209,102,.55);margin-bottom:6px;}
.hc-title{font-family:'Bebas Neue',cursive;font-size:36px;letter-spacing:3px;background:linear-gradient(135deg,#fff,var(--green-l),var(--teal));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hc-desc{font-size:13px;font-weight:300;color:var(--text2);margin-top:6px;line-height:1.6;}
.hc-badges{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin-top:14px;}
.hb{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;padding:6px 12px;border-radius:8px;border:1px solid;}

/* STEPS */
.steps-bar{display:flex;gap:0;background:rgba(0,0,0,.25);border-radius:14px;padding:4px;margin-bottom:20px;border:1px solid rgba(255,255,255,.05);animation:fadeUp .4s .05s ease both;}
.step-tab{flex:1;padding:10px 4px;border-radius:10px;text-align:center;transition:all .25s;}
.step-tab.active{background:rgba(0,209,102,.12);border:1px solid rgba(0,209,102,.25);}
.step-num{font-family:'Bebas Neue',cursive;font-size:18px;letter-spacing:1px;}
.step-tab.active .step-num{color:var(--green);}
.step-tab:not(.active) .step-num{color:var(--text3);}
.step-lbl{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-top:2px;}
.step-tab.active .step-lbl{color:var(--green);}

/* PANELS */
.step-panel{display:none;animation:fadeUp .3s ease both;}
.step-panel.active{display:block;}

/* AMOUNT */
.card{background:rgba(255,255,255,.03);border:1px solid rgba(0,209,102,.1);border-radius:20px;padding:18px;margin-bottom:14px;}
.field-lbl{display:block;font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:rgba(0,209,102,.65);margin-bottom:8px;}
.amount-wrap{position:relative;margin-bottom:10px;}
.amount-inp{width:100%;background:rgba(0,209,102,.04);border:1.5px solid rgba(0,209,102,.18);border-radius:14px;padding:16px 80px 16px 18px;font-family:'Bebas Neue',cursive;font-size:34px;letter-spacing:2px;color:var(--green);outline:none;transition:all .25s;}
.amount-inp::placeholder{color:rgba(0,209,102,.18);font-size:26px;}
.amount-inp:focus{border-color:var(--green);background:rgba(0,209,102,.08);box-shadow:0 0 0 4px rgba(0,209,102,.07);}
.cur-tag{position:absolute;right:18px;top:50%;transform:translateY(-50%);font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;letter-spacing:2px;color:rgba(0,209,102,.35);}
.min-hint{font-size:11px;font-weight:300;color:var(--text3);margin-bottom:12px;}
.quick-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:4px;}
.qb{padding:9px 13px;border-radius:10px;border:1px solid rgba(0,209,102,.18);background:rgba(0,209,102,.04);color:var(--green);font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;letter-spacing:1.5px;cursor:pointer;transition:all .2s;}
.qb:hover{background:rgba(0,209,102,.12);border-color:var(--green);}

.next-btn{width:100%;padding:15px;border:none;border-radius:14px;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:4px;text-transform:uppercase;color:#fff;background:linear-gradient(135deg,var(--green-d),var(--green));box-shadow:0 8px 28px rgba(0,209,102,.3);cursor:pointer;transition:all .3s;position:relative;overflow:hidden;}
.next-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s;}
.next-btn:hover::before{left:100%;}
.next-btn:hover{transform:translateY(-2px);}
.next-btn:disabled{opacity:.4;cursor:not-allowed;transform:none;box-shadow:none;}

/* METHOD */
.cat-title{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin:14px 0 10px;display:flex;align-items:center;gap:8px;}
.method-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:4px;}
.method-opt{background:rgba(255,255,255,.03);border:1.5px solid rgba(255,255,255,.07);border-radius:16px;padding:16px 10px;cursor:pointer;text-align:center;transition:all .25s;position:relative;}
.method-opt:hover{border-color:rgba(0,209,102,.3);background:rgba(0,209,102,.04);transform:translateY(-2px);}
.method-opt.selected{border-color:var(--green);background:rgba(0,209,102,.08);box-shadow:0 4px 20px rgba(0,209,102,.12);}
.method-opt.selected::before{content:'‚úì';position:absolute;top:7px;right:10px;font-size:11px;color:var(--green);font-weight:900;}
.mo-ico{font-size:28px;margin-bottom:6px;}
.mo-name{font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;color:var(--text);}
.mo-tag{display:inline-block;margin-top:5px;font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;padding:3px 8px;border-radius:5px;}
.tag-i{background:rgba(0,209,102,.1);color:var(--green);}
.tag-c{background:rgba(160,100,255,.1);color:var(--purple);}

.row-btns{display:grid;grid-template-columns:1fr 1.6fr;gap:10px;margin-top:4px;}
.back-step{padding:14px;border-radius:14px;border:1.5px solid rgba(255,255,255,.1);background:transparent;color:var(--text3);cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:2px;text-transform:uppercase;}

/* PAYMENT INSTRUCTIONS */
.payment-instr{background:rgba(0,0,0,.3);border:1px solid rgba(0,209,102,.15);border-radius:18px;overflow:hidden;margin-bottom:16px;}
.pi-header{background:linear-gradient(135deg,rgba(0,209,102,.12),rgba(0,201,192,.06));padding:16px 18px;border-bottom:1px solid rgba(0,209,102,.1);}
.pi-method-name{font-family:'Bebas Neue',cursive;font-size:22px;letter-spacing:2px;color:var(--green);}
.pi-step{display:flex;align-items:flex-start;gap:12px;padding:13px 18px;border-bottom:1px solid rgba(255,255,255,.04);}
.pi-step:last-child{border-bottom:none;}
.pi-num{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--green-d),var(--green));display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',cursive;font-size:13px;color:#fff;flex-shrink:0;margin-top:1px;}
.pi-text{font-size:13px;font-weight:300;color:var(--text2);line-height:1.55;}
.pi-text strong{color:var(--text);font-weight:600;}
.pi-copy-row{display:flex;align-items:center;gap:8px;background:rgba(0,209,102,.06);border-radius:10px;padding:10px 14px;margin-top:6px;border:1px solid rgba(0,209,102,.15);}
.pi-copy-val{font-family:'Bebas Neue',cursive;font-size:18px;letter-spacing:2px;color:var(--green);flex:1;}
.pi-copy-btn{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--green);background:transparent;border:1px solid rgba(0,209,102,.3);border-radius:8px;padding:6px 12px;cursor:pointer;}

/* CONFIRM FORM */
.confirm-card{background:rgba(0,0,0,.3);border:1px solid rgba(0,209,102,.12);border-radius:20px;overflow:hidden;margin-bottom:16px;}
.conf-row{display:flex;justify-content:space-between;align-items:center;padding:13px 18px;border-bottom:1px solid rgba(255,255,255,.04);}
.conf-row:last-child{border-bottom:none;}
.conf-lbl{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);}
.conf-val{font-family:'Bebas Neue',cursive;font-size:20px;letter-spacing:1px;}

.ref-inp{width:100%;background:rgba(0,209,102,.04);border:1.5px solid rgba(0,209,102,.14);border-radius:13px;padding:14px 16px;font-family:'Outfit',sans-serif;font-size:15px;font-weight:300;color:var(--text);outline:none;transition:all .25s;margin-bottom:6px;}
.ref-inp::placeholder{color:rgba(107,168,133,.3);font-size:13px;}
.ref-inp:focus{border-color:var(--green);background:rgba(0,209,102,.07);box-shadow:0 0 0 4px rgba(0,209,102,.07);}

.pending-banner{display:flex;align-items:center;gap:12px;background:rgba(255,184,48,.07);border:1px solid rgba(255,184,48,.2);border-radius:14px;padding:14px;margin-bottom:16px;}
.pb-txt h4{font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:1px;color:var(--amber);}
.pb-txt p{font-size:12px;font-weight:300;color:rgba(255,200,100,.65);margin-top:3px;line-height:1.5;}

.submit-btn{width:100%;padding:16px;border:none;border-radius:14px;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:4px;text-transform:uppercase;color:#fff;background:linear-gradient(135deg,var(--green-d),var(--green));box-shadow:0 8px 30px rgba(0,209,102,.32);cursor:pointer;transition:all .3s;position:relative;overflow:hidden;}
.submit-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s;}
.submit-btn:hover::before{left:100%;}
.submit-btn:hover{transform:translateY(-2px);}
.submit-btn:disabled{opacity:.45;cursor:not-allowed;transform:none;box-shadow:none;}
.ld{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;vertical-align:middle;margin-right:8px;}

.err-box{display:none;background:rgba(255,59,78,.08);border:1px solid rgba(255,59,78,.25);border-radius:12px;padding:12px 14px;margin-bottom:14px;font-size:13px;color:#FF6B7A;}

/* HISTORY */
.sec-title{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--text3);margin:4px 0 12px;display:flex;align-items:center;gap:10px;}
.sec-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(0,209,102,.2),transparent);}
.hist-list{display:flex;flex-direction:column;gap:8px;}
.hi{display:flex;align-items:center;gap:12px;background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.05);border-radius:14px;padding:13px 14px;}
.hi-ico{width:38px;height:38px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.hi-info{flex:1;min-width:0;}
.hi-name{font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;color:var(--text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.hi-date{font-size:10px;font-weight:300;color:var(--text3);margin-top:2px;}
.hi-right{text-align:right;flex-shrink:0;}
.hi-amt{font-family:'Bebas Neue',cursive;font-size:19px;letter-spacing:1px;color:var(--green);}
.hi-st{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-top:2px;}
.st-ok{color:var(--green-l);}
.st-pend{color:var(--amber);}

/* SUCCESS */
.suc-overlay{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.94);backdrop-filter:blur(20px);display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .4s;padding:28px;text-align:center;}
.suc-overlay.show{opacity:1;pointer-events:all;}
.suc-ico{font-size:80px;margin-bottom:20px;animation:bounceIn .6s ease both .1s;}
.suc-title{font-family:'Bebas Neue',cursive;font-size:40px;letter-spacing:4px;background:linear-gradient(135deg,var(--green-l),var(--teal-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:10px;}
.suc-msg{font-size:13px;font-weight:300;color:var(--text2);line-height:1.7;max-width:320px;margin-bottom:24px;}
.suc-btn{padding:15px 40px;border-radius:14px;border:none;cursor:pointer;background:linear-gradient(135deg,var(--green-d),var(--green));font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:#fff;box-shadow:0 8px 24px rgba(0,209,102,.3);}

.toast{position:fixed;top:80px;left:50%;transform:translateX(-50%) translateY(-20px);background:rgba(0,209,102,.9);backdrop-filter:blur(12px);color:#fff;padding:10px 22px;border-radius:100px;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:1.5px;z-index:500;opacity:0;transition:all .3s;pointer-events:none;white-space:nowrap;max-width:90vw;text-align:center;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
.toast.err{background:rgba(255,59,78,.9);}

.bot-nav{position:fixed;bottom:0;left:0;right:0;z-index:100;height:var(--nav-h);background:rgba(6,14,10,.96);backdrop-filter:blur(24px);border-top:1px solid rgba(0,209,102,.1);display:grid;grid-template-columns:repeat(4,1fr);box-shadow:0 -8px 32px rgba(0,0,0,.5);}
.nav-item{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;cursor:pointer;text-decoration:none;padding:8px 4px;position:relative;}
.nav-item::before{content:'';position:absolute;top:0;left:20%;right:20%;height:2px;border-radius:0 0 4px 4px;background:linear-gradient(90deg,var(--green),var(--teal));transform:scaleX(0);transition:transform .3s;}
.nav-item.active::before{transform:scaleX(1);}
.nav-item.active .nav-ico,.nav-item.active .nav-lbl{color:var(--green);}
.nav-ico{font-size:20px;color:var(--text3);}
.nav-lbl{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);}
</style>
</head>
<body>

<div class="loading-screen" id="loader">
  <div class="load-logo">üí≥ RECHARGE</div>
  <div class="load-bar"><div class="load-fill"></div></div>
</div>
<div class="bg-mesh"></div><div class="bg-grid"></div>
<div class="toast" id="toast"></div>

<!-- SUCCESS -->
<div class="suc-overlay" id="suc-overlay">
  <div class="suc-ico">üéâ</div>
  <div class="suc-title">Demande envoy√©e !</div>
  <div class="suc-msg" id="suc-msg">Votre demande de recharge a √©t√© enregistr√©e. Votre solde sera cr√©dit√© apr√®s v√©rification du paiement.</div>
  <button class="suc-btn" onclick="window.location.href='dashboard.html'">Retour au Dashboard ‚Üí</button>
</div>

<div class="page">

  <div class="topbar">
    <a href="dashboard.html" class="back-btn">‚Üê Accueil</a>
    <div class="page-title">üí≥ RECHARGE</div>
    <div class="bal-pill">üí∞ <span id="bal-display">‚Ä¶</span> F</div>
  </div>

  <!-- HERO -->
  <div class="hero-card">
    <div class="hc-label">Cr√©diter votre compte SYLLA</div>
    <div class="hc-title">RECHARGER MON COMPTE</div>
    <div class="hc-desc">D√©posez des fonds pour commencer √† investir. Votre solde est cr√©dit√© en moins de <strong>2 heures</strong> apr√®s confirmation du paiement.</div>
    <div class="hc-badges">
      <div class="hb" style="border-color:rgba(0,209,102,.3);color:var(--green);background:rgba(0,209,102,.08)">üì± Mobile Money</div>
      <div class="hb" style="border-color:rgba(255,184,48,.3);color:var(--amber);background:rgba(255,184,48,.08)">üí≥ Carte bancaire</div>
      <div class="hb" style="border-color:rgba(160,100,255,.3);color:var(--purple);background:rgba(160,100,255,.08)">‚Çø Crypto</div>
    </div>
  </div>

  <!-- STEPS -->
  <div class="steps-bar">
    <div class="step-tab active" id="tab-1"><div class="step-num">1</div><div class="step-lbl">Montant</div></div>
    <div class="step-tab" id="tab-2"><div class="step-num">2</div><div class="step-lbl">M√©thode</div></div>
    <div class="step-tab" id="tab-3"><div class="step-num">3</div><div class="step-lbl">Paiement</div></div>
  </div>

  <!-- ‚ïê‚ïê STEP 1 ‚Äî AMOUNT ‚ïê‚ïê -->
  <div class="step-panel active" id="panel-1">
    <div class="card">
      <label class="field-lbl">Montant √† recharger</label>
      <div class="amount-wrap">
        <input class="amount-inp" type="number" id="amount-inp" placeholder="5 000" min="1000" oninput="validateAmt()">
        <span class="cur-tag">FCFA</span>
      </div>
      <div class="min-hint">‚ö° Minimum <strong style="color:var(--green)">1 000 FCFA</strong> ¬∑ Aucun frais de d√©p√¥t</div>
      <div class="quick-row">
        <button class="qb" onclick="setAmt(2000)">2 000</button>
        <button class="qb" onclick="setAmt(5000)">5 000</button>
        <button class="qb" onclick="setAmt(10000)">10 000</button>
        <button class="qb" onclick="setAmt(25000)">25 000</button>
        <button class="qb" onclick="setAmt(50000)">50 000</button>
      </div>
    </div>
    <button class="next-btn" id="btn-next1" onclick="goStep(2)" disabled>Choisir la m√©thode ‚Üí</button>
  </div>

  <!-- ‚ïê‚ïê STEP 2 ‚Äî METHOD ‚ïê‚ïê -->
  <div class="step-panel" id="panel-2">

    <div class="cat-title"><span>üì±</span> Mobile Money</div>
    <div class="method-grid">
      <div class="method-opt selected" onclick="selectM('orange',this,'üü†','Orange Money','Cameroun')">
        <div class="mo-ico">üü†</div><div class="mo-name">Orange Money</div><div class="mo-tag tag-i">Instantan√©</div>
      </div>
      <div class="method-opt" onclick="selectM('mtn',this,'üíõ','MTN MoMo','Cameroun')">
        <div class="mo-ico">üíõ</div><div class="mo-name">MTN MoMo</div><div class="mo-tag tag-i">Instantan√©</div>
      </div>
      <div class="method-opt" onclick="selectM('usdt',this,'üíé','USDT BEP-20','BSC ¬∑ Monde entier')">
        <div class="mo-ico">üíé</div><div class="mo-name">USDT BSC</div><div class="mo-tag" style="background:rgba(240,185,11,.15);color:#F0B90B;border-color:rgba(240,185,11,.3)">BEP-20</div>
      </div>
      <div class="method-opt" onclick="selectM('sol',this,'üü£','SOL / USDC','Solana ¬∑ Monde entier')">
        <div class="mo-ico">üü£</div><div class="mo-name">Solana</div><div class="mo-tag" style="background:rgba(153,69,255,.15);color:#9945FF;border-color:rgba(153,69,255,.3)">SOL</div
      </div>
      </div>
    </div>

    <div class="cat-title" style="margin-top:14px"><span>üí≥</span> Carte Bancaire</div>
    <div class="method-grid">
      </div>
      </div>
    </div>

    <div class="cat-title" style="margin-top:14px"><span>‚Çø</span> Crypto-monnaie</div>
    <div class="method-grid">
      </div>
      </div>
    </div>

    <div class="row-btns" style="margin-top:18px">
      <button class="back-step" onclick="goStep(1)">‚Üê Retour</button>
      <button class="next-btn" style="margin:0" onclick="goStep(3)">Voir instructions ‚Üí</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê STEP 3 ‚Äî PAYMENT INSTRUCTIONS ‚ïê‚ïê -->
  <div class="step-panel" id="panel-3">

    <!-- Dynamic payment instructions -->
    <div class="payment-instr" id="payment-instr"></div>

    <!-- Confirm form -->
    <div class="card">
      <label class="field-lbl">Num√©ro / R√©f√©rence du paiement effectu√©</label>
      <input class="ref-inp" type="text" id="payment-ref" placeholder="Ex: TXN123456 ou num√©ro d'envoi">
      <div style="font-size:11px;font-weight:300;color:var(--text3);margin-bottom:16px">Entrez la r√©f√©rence de transaction re√ßue apr√®s votre paiement</div>
    </div>

    <div class="confirm-card">
      <div class="conf-row"><div class="conf-lbl">Montant recharg√©</div><div class="conf-val" style="color:var(--green)" id="c-amount">‚Äî</div></div>
      <div class="conf-row"><div class="conf-lbl">M√©thode</div><div class="conf-val" style="color:var(--teal)" id="c-method">‚Äî</div></div>
      <div class="conf-row"><div class="conf-lbl">Frais de d√©p√¥t</div><div class="conf-val" style="color:var(--green-l)">GRATUIT üéâ</div></div>
      <div class="conf-row"><div class="conf-lbl">D√©lai de cr√©dit</div><div class="conf-val" style="color:var(--amber);font-size:18px">MOINS DE 2H</div></div>
    </div>

    <div class="pending-banner">
      <span style="font-size:24px">‚è≥</span>
      <div class="pb-txt">
        <h4>Traitement manuel rapide</h4>
        <p>Notre √©quipe v√©rifie votre paiement et cr√©dite votre compte dans les 2 heures. Vous serez notifi√©.</p>
      </div>
    </div>

    <div class="err-box" id="err-box"></div>

    <div class="row-btns">
      <button class="back-step" onclick="goStep(2)">‚Üê Retour</button>
      <button class="submit-btn" style="margin:0" id="submit-btn" onclick="submitRecharge()">‚úÖ Confirmer le d√©p√¥t</button>
    </div>
  </div>

  <!-- HISTORY -->
  <div class="sec-title" style="margin-top:20px">Historique des recharges</div>
  <div class="hist-list" id="hist-list">
    <div style="text-align:center;padding:20px;color:var(--text3);font-size:13px">Chargement‚Ä¶</div>
  </div>

</div>

<nav class="bot-nav">
  <a href="dashboard.html" class="nav-item active"><span class="nav-ico">üè†</span><span class="nav-lbl">Accueil</span></a>
  <a href="plan.html" class="nav-item"><span class="nav-ico">üöÄ</span><span class="nav-lbl">Plans</span></a>
  <a href="retrait.html" class="nav-item"><span class="nav-ico">üí∏</span><span class="nav-lbl">Retrait</span></a>
  <a href="messages.html" class="nav-item"><span class="nav-ico">üí¨</span><span class="nav-lbl">Messages</span></a>
  <a href="profil.html" class="nav-item"><span class="nav-ico">üë§</span><span class="nav-lbl">Profil</span></a>
</nav>

<script>
const{createClient}=supabase;
const sb=createClient('https://fqiotqrraobmsrcyewsi.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZxaW90cXJyYW9ibXNyY3lld3NpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MjA3NzUsImV4cCI6MjA4NzM5Njc3NX0.pmvaQikEDEj705o7kBBWwkLwAoZ62D-GoxjFm5HEHNc');

const PAYMENT_INFO={
  orange:{number:'658033690',name:'Alirou Moun',steps:[
    {t:'Ouvrez <strong>Orange Money</strong> ou composez <strong>#150#</strong>',d:''},
    {t:'S√©lectionnez <strong>Transfert d\'argent</strong>',d:''},
    {t:'Entrez le num√©ro Orange Money SYLLA',d:'',copy:'658033690'},
    {t:'B√©n√©ficiaire : <strong>Alirou Moun</strong>',d:''},
    {t:'Entrez le montant exact et confirmez avec votre PIN',d:''},
    {t:'Notez la <strong>r√©f√©rence de transaction</strong> re√ßue par SMS',d:'Vous en aurez besoin √† l\'√©tape suivante'},
  ]},
  mtn:{number:'651461777',name:'Jean Jacques Rousseau',steps:[
    {t:'Ouvrez <strong>MTN Mobile Money</strong> ou composez <strong>*126#</strong>',d:''},
    {t:'S√©lectionnez <strong>Transfert d\'argent</strong>',d:''},
    {t:'Entrez le num√©ro MTN MoMo SYLLA',d:'',copy:'651461777'},
    {t:'B√©n√©ficiaire : <strong>Jean Jacques Rousseau</strong>',d:''},
    {t:'Entrez le montant exact et confirmez avec votre PIN',d:''},
    {t:'Notez la <strong>r√©f√©rence de transaction</strong> re√ßue par SMS',d:'Vous en aurez besoin √† l\'√©tape suivante'},
  ]},
  usdt:{number:'0x44C9170272c7eA2c99f5dC28d955AdFE8b4AA3CB',name:'SYLLA BSC Wallet',steps:[
    {t:'‚ö†Ô∏è R√©seau <strong>BSC (BEP-20)</strong> uniquement ‚Äî pas ERC-20 !',d:'Tout envoi sur mauvais r√©seau sera perdu'},
    {t:'Ouvrez votre wallet : Trust Wallet, MetaMask, Binance...',d:''},
    {t:'S√©lectionnez <strong>USDT r√©seau BEP-20 / BSC</strong>',d:''},
    {t:'Envoyez vers l\'adresse SYLLA',d:'',copy:'0x44C9170272c7eA2c99f5dC28d955AdFE8b4AA3CB'},
    {t:'Attendez <strong>1-3 confirmations</strong> r√©seau',d:'G√©n√©ralement moins de 2 minutes'},
    {t:'Copiez le <strong>hash de transaction (TXID)</strong>',d:'Visible dans votre wallet apr√®s envoi'},
    {t:'Collez le TXID comme r√©f√©rence √† l\'√©tape suivante',d:'Cr√©dit converti en FCFA selon taux du jour'},
  ]},
  sol:{number:'JBe5kePCCj3tG5RciCaNCEaJjtziycdrtKwz64Csx2VJ',name:'SYLLA Solana Wallet',steps:[
    {t:'‚ö†Ô∏è R√©seau <strong>Solana</strong> uniquement',d:'V√©rifiez bien le r√©seau avant d\'envoyer'},
    {t:'Ouvrez votre wallet : Phantom, Solflare, Backpack...',d:''},
    {t:'S√©lectionnez <strong>SOL ou USDC</strong> sur r√©seau Solana',d:''},
    {t:'Envoyez vers l\'adresse SYLLA Solana',d:'',copy:'JBe5kePCCj3tG5RciCaNCEaJjtziycdrtKwz64Csx2VJ'},
    {t:'Attendez <strong>la confirmation</strong> r√©seau',d:'Solana confirme en quelques secondes'},
    {t:'Copiez le <strong>hash de transaction (Signature)</strong>',d:'Visible dans votre wallet ou sur Solscan'},
    {t:'Collez la signature comme r√©f√©rence √† l\'√©tape suivante',d:'Cr√©dit converti en FCFA selon taux du jour'},
  ]},
};

let cu=null,userBalance=0,selM={id:'orange',ico:'üü†',name:'Orange Money'};
let toastT=null;

async function init(){
  const{data:{session}}=await sb.auth.getSession();
  if(!session){window.location.href='index.html';return;}
  cu=session.user;
  await Promise.allSettled([loadBalance(),loadHistory()]);
  document.getElementById('loader').classList.add('hide');
}

async function loadBalance(){
  try{
    // Utiliser la function SQL s√©curis√©e pour le solde r√©el
    const{data,error}=await sb.rpc('get_solde',{p_user_id:cu.id});
    userBalance=error?0:Number(data)||0;
  }catch(e){userBalance=0;}
  document.getElementById('bal-display').textContent=fmt(userBalance);
}

async function loadHistory(){
  const list=document.getElementById('hist-list');
  try{
    // Chercher dans la table recharges (plus pr√©cis que transactions)
    const{data:recs}=await sb.from('recharges')
      .select('*').eq('user_id',cu.id)
      .order('created_at',{ascending:false}).limit(15);

    if(!recs?.length){
      list.innerHTML='<div style="text-align:center;padding:20px;color:var(--text3);font-size:13px">üí≥ Aucune recharge effectu√©e</div>';
      return;
    }
    list.innerHTML=recs.map(r=>{
      const d=new Date(r.created_at);
      const ds=d.toLocaleDateString('fr-FR',{day:'2-digit',month:'short'})+' '+d.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});
      const stMap={
        'en_attente':'‚è≥ En v√©rification',
        'valide':'‚úÖ Cr√©dit√©',
        'rejete':'‚ùå Rejet√©'
      };
      const stCls=r.statut==='valide'?'st-ok':r.statut==='rejete'?'st-rej':'st-pend';
      const stTxt=stMap[r.statut]||r.statut;
      const refTxt=r.reference_paiement?` ‚Äî R√©f: ${r.reference_paiement}`:'';
      return `<div class="hi">
        <div class="hi-ico" style="background:rgba(0,209,102,.08)">üí≥</div>
        <div class="hi-info">
          <div class="hi-name">${r.methode}${refTxt}</div>
          <div class="hi-date">${ds}</div>
          ${r.statut==='rejete'&&r.note_admin?`<div style="font-size:11px;color:var(--red);margin-top:3px">Motif: ${r.note_admin}</div>`:''}
        </div>
        <div class="hi-right">
          <div class="hi-amt">+${fmt(r.montant)} F</div>
          <div class="hi-st ${stCls}">${stTxt}</div>
        </div>
      </div>`;
    }).join('');
  }catch(e){
    list.innerHTML='<div style="text-align:center;padding:16px;color:var(--text3)">Historique indisponible</div>';
  }
}

function setAmt(v){document.getElementById('amount-inp').value=v;validateAmt();}
function validateAmt(){
  const v=Number(document.getElementById('amount-inp').value)||0;
  document.getElementById('btn-next1').disabled=v<1000;
}

function selectM(id,el,ico,name,sub){
  selM={id,ico,name,sub};
  document.querySelectorAll('.method-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');
}

function buildPaymentInstr(amount){
  const info=PAYMENT_INFO[selM.id]||PAYMENT_INFO.orange;
  const stepsHtml=info.steps.map((s,i)=>{
    let html=`<div class="pi-step"><div class="pi-num">${i+1}</div><div class="pi-text"><span>${s.t.replace('‚Äî',fmt(amount)+' FCFA')}</span>`;
    if(s.d)html+=`<br><span style="font-size:11px;color:var(--text3)">${s.d}</span>`;
    if(s.copy)html+=`<div class="pi-copy-row"><div class="pi-copy-val">${s.copy}</div><button class="pi-copy-btn" onclick="copyText('${s.copy}')">üìã Copier</button></div>`;
    html+=`</div></div>`;
    return html;
  }).join('');
  return `<div class="pi-header"><div class="pi-method-name">${selM.ico} ${selM.name}</div></div>${stepsHtml}`;
}

function copyText(txt){navigator.clipboard.writeText(txt).then(()=>showToast('‚úì Copi√© !'));}

function goStep(n){
  if(n===3){
    const amount=Number(document.getElementById('amount-inp').value)||0;
    if(amount<2000){showToast('Minimum 2 000 FCFA',true);return;}
    document.getElementById('payment-instr').innerHTML=buildPaymentInstr(amount);
    document.getElementById('c-amount').textContent=fmt(amount)+' FCFA';
    document.getElementById('c-method').textContent=selM.ico+' '+selM.name;
    document.getElementById('err-box').style.display='none';
    document.getElementById('submit-btn').disabled=false;
    document.getElementById('submit-btn').innerHTML='‚úÖ Confirmer le d√©p√¥t';
  }
  document.querySelectorAll('.step-panel').forEach((p,i)=>p.classList.toggle('active',i===n-1));
  document.querySelectorAll('.step-tab').forEach((t,i)=>t.classList.toggle('active',i===n-1));
  window.scrollTo({top:0,behavior:'smooth'});
}

async function submitRecharge(){
  const amount=Number(document.getElementById('amount-inp').value)||0;
  const ref=document.getElementById('payment-ref').value.trim();
  const btn=document.getElementById('submit-btn');
  const errBox=document.getElementById('err-box');
  errBox.style.display='none';

  // ‚îÄ‚îÄ Validations strictes ‚îÄ‚îÄ
  if(amount<1000){errBox.style.display='block';errBox.textContent='Montant minimum 1 000 FCFA.';return;}
  if(!ref||ref.length<3){errBox.style.display='block';errBox.textContent='R√©f√©rence de paiement requise (minimum 3 caract√®res).';return;}
  if(!selM.id){errBox.style.display='block';errBox.textContent='S√©lectionnez une m√©thode de paiement.';return;}

  btn.disabled=true;btn.innerHTML='<span class="ld"></span>Envoi en cours‚Ä¶';

  try{
    // ‚îÄ‚îÄ Appel via function s√©curis√©e ‚îÄ‚îÄ
    const{data,error}=await sb.rpc('demander_recharge',{
      p_user_id   : cu.id,
      p_montant   : amount,
      p_methode   : selM.name,
      p_reference : ref
    });

    if(error||!data?.success){
      throw new Error(data?.error||error?.message||'Erreur inconnue');
    }

    // ‚îÄ‚îÄ Succ√®s ‚îÄ‚îÄ
    document.getElementById('suc-msg').textContent=
      `Votre demande de ${fmt(amount)} FCFA via ${selM.name} a √©t√© enregistr√©e (R√©f: ${ref}). ` +
      `Votre solde sera cr√©dit√© apr√®s validation par notre √©quipe (d√©lai max 2h).`;
    document.getElementById('suc-overlay').classList.add('show');
    await loadHistory();

  }catch(err){
    btn.disabled=false;btn.innerHTML='‚úÖ Confirmer le d√©p√¥t';
    errBox.style.display='block';
    errBox.textContent='‚ùå '+(err.message||'Erreur. R√©essayez.');
  }
}

function fmt(n){return Number(n).toLocaleString('fr-FR');}
function showToast(msg,err=false){
  const t=document.getElementById('toast');t.textContent=msg;
  err?t.classList.add('err'):t.classList.remove('err');
  t.classList.add('show');clearTimeout(toastT);
  toastT=setTimeout(()=>t.classList.remove('show'),3000);
}

init();
</script>
</body>
</html>